[{"id":"8abcb9c4.969e58","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"18e0d651.2db41a","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"49f88b4f.625b74","type":"tab","label":"Flow 3","disabled":false,"info":""},{"id":"acf47a97.8e7978","type":"tab","label":"Flow 4","disabled":false,"info":""},{"id":"b4dd18b0.7a5358","type":"tab","label":"Flow 5","disabled":false,"info":""},{"id":"740b003f.0a2b","type":"tab","label":"Flow 6","disabled":false,"info":""},{"id":"15c9eaa7.3c0665","type":"tab","label":"Flow 7","disabled":false,"info":""},{"id":"f4c13dae.1fd7a","type":"tab","label":"Flow 8","disabled":false,"info":""},{"id":"740c75b5.a1e69c","type":"tab","label":"zigbee2mqtt","disabled":true,"info":""},{"id":"c4829f93.87cba","type":"tab","label":"Flow 10","disabled":false,"info":""},{"id":"4bc40f.33b24bf","type":"tab","label":"myhome","disabled":false,"info":""},{"id":"af357553.2f0528","type":"tab","label":"Flow 9","disabled":true,"info":""},{"id":"8ef08a2b.a563a8","type":"tab","label":"Flow 12","disabled":false,"info":""},{"id":"954fa096.15be2","type":"tab","label":"Button Enable flow","disabled":true,"info":""},{"id":"dfb681c3.814b5","type":"tab","label":"Flow 11","disabled":true,"info":""},{"id":"edd42ef7.16d9c","type":"tab","label":"Flow 13","disabled":true,"info":""},{"id":"1635ef5e.c89941","type":"tab","label":"Flow 14","disabled":false,"info":""},{"id":"7d67720.8972e9","type":"tab","label":"Flow 15","disabled":true,"info":""},{"id":"84e1670a.31e198","type":"tab","label":"Flow 16","disabled":true,"info":""},{"id":"a8befc30.c457","type":"tab","label":"Flow 17","disabled":false,"info":""},{"id":"67731296.6f183c","type":"tab","label":"Flow 18","disabled":false,"info":""},{"id":"6378da21.c9a314","type":"tab","label":"Flow 19","disabled":false,"info":""},{"id":"cd14cf16.4492f","type":"subflow","name":"Periferico_In","info":"","category":"IoT Gemini","in":[{"x":240,"y":140,"wires":[{"id":"dccd95e8.92be68"},{"id":"1297b6f1.fddfd9"},{"id":"955b9539.3d10d8"}]}],"out":[{"x":720,"y":140,"wires":[{"id":"dccd95e8.92be68","port":0}]}]},{"id":"3878b8f7.1c3218","type":"subflow","name":"IotG_Read","info":"Read information from the Iot Gemini demone\n\nInput: Polling clock (minimum 0.1 s)\n\nOutput1: json status \n\nOutput2: string error ","category":"IoT Gemini","in":[{"x":140,"y":160,"wires":[{"id":"7f9f1df1.275cd4"}]}],"out":[{"x":700,"y":160,"wires":[{"id":"b34178b3.57c888","port":0}]},{"x":700,"y":240,"wires":[{"id":"b62714f6.3c08c8","port":0}]},{"x":702.0000019073486,"y":310,"wires":[{"id":"7f9f1df1.275cd4","port":0}]}]},{"id":"47939922.b824d8","type":"subflow","name":"Periferico_Out","info":"","category":"IoT Gemini","in":[{"x":60,"y":160,"wires":[{"id":"9c0b5132.2249a"}]}],"out":[{"x":1120,"y":240,"wires":[{"id":"d9fa8e71.2b0a8","port":0},{"id":"575f68a5.1aad88","port":0}]}]},{"id":"1b3418b8.8a5b07","type":"subflow","name":"IotG_Diagno","info":"","category":"IoT Gemini","in":[{"x":40,"y":200,"wires":[{"id":"71baa958.bda0b8"}]}],"out":[{"x":540,"y":220,"wires":[{"id":"28d7f8cb.72b7f8","port":0}]}]},{"id":"d790ae81.b58ba","type":"ui_tab","z":"","name":"Home","icon":"home","order":1},{"id":"8b7266fe.98fd18","type":"ui_group","z":"","name":"Default","tab":"d790ae81.b58ba","order":1,"disp":true,"width":"6"},{"id":"6da4d19d.40ede","type":"ui_group","z":"","name":"Default","tab":"a25780ea.1df36","order":1,"disp":true,"width":"6"},{"id":"a25780ea.1df36","type":"ui_tab","z":"","name":"Home","icon":"home","order":1},{"id":"8d3bbffb.1bda5","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"3c076744.c6a638","type":"ui_spacer","name":"spacer","group":"8b7266fe.98fd18","order":1,"width":1,"height":1},{"id":"672ff1be.ce75d","type":"websocket-client","z":"","path":"wss://echo.websocket.org","tls":"","wholemsg":"false"},{"id":"32def38f.02e0cc","type":"samsung-tv","z":"","name":"SamsungTV","address":"192.168.1.15"},{"id":"37c9237b.db7dbc","type":"ui_group","z":"","name":"GPS tracking","tab":"a1d5e355.d80fd","order":2,"disp":true,"width":"20","collapse":false},{"id":"a1d5e355.d80fd","type":"ui_tab","z":"","name":"Map","icon":"dashboard","order":7,"disabled":false,"hidden":false},{"id":"6d7b1f79.2cc08","type":"ui_group","z":"","name":"GPS tracking","tab":"","order":2,"disp":true,"width":"20","collapse":false},{"id":"ff16eac5.f73e88","type":"ui_tab","z":"","name":"COLOR","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"6dbdd2f.236602c","type":"ui_group","z":"","name":"circule","tab":"ff16eac5.f73e88","order":1,"disp":true,"width":"6","collapse":false},{"id":"299502c0.c3cdae","type":"mqtt-broker","z":"","name":"MQTT-localhost","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"e4cc180c.e22528","type":"ui_group","z":"","name":"1-line 24h on/off chart","tab":"26567699.af4cba","disp":true,"width":"6","collapse":false},{"id":"26567699.af4cba","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"faa404cf.51c898","type":"ui_group","z":"","name":"Default","tab":"a99ae12b.9432e","disp":true,"width":"6"},{"id":"a99ae12b.9432e","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"13f378c3.149687","type":"ui_group","z":"","name":"Group 1","tab":"a80916b8.fd5778","order":1,"disp":true,"width":"9","collapse":false},{"id":"a80916b8.fd5778","type":"ui_tab","z":"","name":"Master Control prototype","icon":"dashboard","order":39,"disabled":false,"hidden":false},{"id":"a556504d.417f6","type":"pushbullet-config","z":"","name":"main"},{"id":"8c00412c.036b5","type":"pushbullet-config","z":"","name":"main"},{"id":"d837e845.a0bc08","type":"darksky-credentials","z":"","key_identifier":"pogoda"},{"id":"bb198d2d.45c49","type":"telegram bot","z":"edd42ef7.16d9c","botname":"HeinzBot"},{"id":"ab7e128b.884e3","type":"telegram bot","z":"edd42ef7.16d9c","botname":"HeinzBot","usernames":"","chatids":""},{"id":"c914528f.2793c","type":"ui_group","z":"","name":"Stat","tab":"995608af.8f3ec8","disp":false,"width":"6"},{"id":"995608af.8f3ec8","type":"ui_tab","z":"","name":"Stat","icon":"dashboard"},{"id":"e24986b9.6965d8","type":"ui_group","z":"","name":"Stat","tab":"fb1da33b.6fc62","disp":false,"width":"6"},{"id":"fb1da33b.6fc62","type":"ui_tab","z":"","name":"Stat","icon":"dashboard"},{"id":"bc8a2f4a.f44d4","type":"ui_group","z":"","name":"Control Panel","tab":"81251d0c.6806b","order":2,"disp":true,"width":"8"},{"id":"81251d0c.6806b","type":"ui_tab","z":"","name":"Button Panel","icon":"dashboard"},{"id":"71ca3875.78c3d8","type":"ui_group","z":"","name":"Control Panel","tab":"8628e086.f0a53","order":2,"disp":true,"width":"8"},{"id":"8628e086.f0a53","type":"ui_tab","z":"","name":"Button Panel","icon":"dashboard"},{"id":"eb7f92d0.0d7fc","type":"ui_group","z":"a8befc30.c457","name":"Коридор","tab":"ce04ac9d.c7a88","order":1,"disp":true,"width":"12","collapse":false},{"id":"ce04ac9d.c7a88","type":"ui_tab","z":"a8befc30.c457","name":"Cameras","icon":"camera_alt","order":2},{"id":"cbcc290d.35bc58","type":"ui_group","z":"","name":"Frame Grab","tab":"","order":1,"disp":true,"width":"6"},{"id":"a248598c.e91b58","type":"ui_group","z":"","name":"Frame Grab","tab":"","order":1,"disp":true,"width":"6"},{"id":"5e64b6ac.f4e408","type":"ui_group","z":"","name":"Temperature","tab":"d384ca60.239528","disp":true,"width":"6","collapse":false},{"id":"d384ca60.239528","type":"ui_tab","z":"","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"94f04632.8c07b8","type":"ui_group","z":"","name":"RFPI","tab":"f683ab63.f78578","disp":true,"width":"6","collapse":false},{"id":"f683ab63.f78578","type":"ui_tab","z":"","name":"RFPI","icon":"dashboard","disabled":false,"hidden":false},{"id":"49e44ce.d692eb4","type":"mqtt-broker","z":"","name":"","broker":"192.168.2.2","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"d1976a47.446258","type":"ui_group","z":"","name":"Temperature","tab":"fdd2a87c.a8ee38","disp":true,"width":"6","collapse":false},{"id":"1216c38f.2cf89c","type":"ui_group","z":"","name":"Umidity","tab":"fdd2a87c.a8ee38","disp":true,"width":"6","collapse":false},{"id":"fdd2a87c.a8ee38","type":"ui_tab","z":"","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"617c651e.0f75fc","type":"ui_group","z":"","name":"Col1","tab":"cd838ac0.3f1ee8","order":1,"disp":false,"width":"6"},{"id":"22b55d7d.150742","type":"ui_group","z":"","name":"Actions","tab":"cd838ac0.3f1ee8","order":4,"disp":true,"width":"6"},{"id":"4e54b61b.ed0a68","type":"ui_group","z":"","name":"Col2","tab":"cd838ac0.3f1ee8","order":2,"disp":false,"width":"6"},{"id":"e3d13b1e.7dfaf8","type":"ui_group","z":"","name":"Col3","tab":"cd838ac0.3f1ee8","order":3,"disp":false,"width":"6"},{"id":"cd838ac0.3f1ee8","type":"ui_tab","z":"","name":"RPi Control","icon":"dashboard","order":1},{"id":"f90c51ae.c4e28","type":"ui_group","z":"","name":"Temperature","tab":"f0298cc8.99d66","disp":true,"width":"6","collapse":false},{"id":"6d6168b4.6ff1d8","type":"ui_group","z":"","name":"Umidity","tab":"f0298cc8.99d66","disp":true,"width":"6","collapse":false},{"id":"f0298cc8.99d66","type":"ui_tab","z":"","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"6f51b5e4.c2ec4c","type":"mqtt-broker","z":"","name":"","broker":"192.168.2.2","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"9194821e.4854a","type":"ui_tab","z":"","name":"Castello","icon":"dashboard","disabled":false,"hidden":false},{"id":"ad02dca7.e2255","type":"ui_group","z":"","name":"Sala del Melograno","tab":"9194821e.4854a","order":2,"disp":true,"width":"6","collapse":false},{"id":"9a228d4d.cf789","type":"ui_group","z":"","name":"Sala del Trono","tab":"9194821e.4854a","order":1,"disp":true,"width":"6","collapse":false},{"id":"83499569.5074c8","type":"ui_group","z":"","name":"Dynamic table example","tab":"9194821e.4854a","order":3,"disp":true,"width":"1","collapse":false},{"id":"5a379887.5ee0c8","type":"ui_group","z":"","name":"Sala del Pesco","tab":"9194821e.4854a","disp":true,"width":"6","collapse":false},{"id":"896390a0.b2803","type":"ui_group","z":"","name":"Sala del Ciliegio","tab":"9194821e.4854a","disp":true,"width":"6","collapse":false},{"id":"3ba005d2.ad28ea","type":"ui_group","z":"","name":"Chiesa","tab":"9194821e.4854a","disp":true,"width":"6","collapse":false},{"id":"f7605e8b.4fc4c","type":"mqtt-broker","z":"","name":"","broker":"farmer.cloudmqtt.com","port":"16966","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"1fcaadae.f2e2a2","type":"ui_tab","z":"","name":"Castello","icon":"dashboard","disabled":false,"hidden":false},{"id":"92681d64.705a1","type":"ui_group","z":"","name":"Sala del Melograno","tab":"1fcaadae.f2e2a2","order":2,"disp":true,"width":"6","collapse":false},{"id":"633a8ddd.cdbd34","type":"ui_group","z":"","name":"Sala del Trono","tab":"1fcaadae.f2e2a2","order":1,"disp":true,"width":"6","collapse":false},{"id":"477aa16d.09182","type":"ui_group","z":"","name":"Dynamic table example","tab":"1fcaadae.f2e2a2","order":3,"disp":true,"width":"1","collapse":false},{"id":"25e8b804.2b2448","type":"ui_group","z":"","name":"Sala del Pesco","tab":"1fcaadae.f2e2a2","disp":true,"width":"6","collapse":false},{"id":"eb707b13.d935f8","type":"ui_group","z":"","name":"Sala del Ciliegio","tab":"1fcaadae.f2e2a2","disp":true,"width":"6","collapse":false},{"id":"5074273e.889288","type":"ui_group","z":"","name":"Chiesa","tab":"1fcaadae.f2e2a2","disp":true,"width":"6","collapse":false},{"id":"2763fb39.a89104","type":"mqtt-broker","z":"","name":"","broker":"farmer.cloudmqtt.com","port":"16966","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"d3a80f5.4d945f","type":"ui_group","z":"","name":"Sonoro","tab":"1fcaadae.f2e2a2","disp":true,"width":"6","collapse":false},{"id":"a71c3d00.520a9","type":"tcp in","z":"8abcb9c4.969e58","name":"listen5555","server":"server","host":"","port":"5555","datamode":"stream","datatype":"buffer","newline":"","topic":"listen5555","base64":false,"x":116,"y":103,"wires":[["b0fd09bb.a35178","cebe805.57b888"]]},{"id":"cebe805.57b888","type":"debug","z":"8abcb9c4.969e58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":321,"y":92,"wires":[]},{"id":"c29416ea.c14a28","type":"tcp out","z":"8abcb9c4.969e58","host":"127.0.0.1","port":"5555","beserver":"client","base64":false,"end":true,"name":"5555","x":428,"y":167,"wires":[]},{"id":"b0fd09bb.a35178","type":"function","z":"8abcb9c4.969e58","name":"","func":"msg.payload = 255;\n// Return the message so it can be sent on\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":143,"wires":[["c29416ea.c14a28"]]},{"id":"8488390.6f21cc8","type":"inject","z":"18e0d651.2db41a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":154,"y":238,"wires":[["e81acc84.231b","4a850f56.63db8"]]},{"id":"e81acc84.231b","type":"ui_template","z":"18e0d651.2db41a","group":"6da4d19d.40ede","name":"Dynamic img src request","order":1,"width":"6","height":"4","format":"<script> \nvar xhr = new XMLHttpRequest();\n\n// 2. Конфигурируем его: GET-запрос на URL 'phones.json'\nxhr.open('POST', 'http://demo5.traccar.org/api/session?token=7iHFLJysPzhqj5jt5FVXRTWYlvE0JKn9', false);\n\n// 3. Отсылаем запрос\nxhr.send();\n\n// 4. Если код ответа сервера не 200, то это ошибка\n  // вывести результат\nmsg.payload = xhr.responseText;\nreturn msg// responseText -- текст ответа.\n\n</script>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":464,"y":358,"wires":[["d96efaf8.0961f8"]]},{"id":"4a850f56.63db8","type":"function","z":"18e0d651.2db41a","name":"POST request","func":"// 1. Создаём новый объект XMLHttpRequest\n//var XMLHttpRequest = require(\"xmlhttprequest\").XMLHttpRequest;\n//include(\"XMLHttpRequest.js\"); \n//var xhr = new XMLHttpRequest();\nvar xhr = new XMLHttpRequest();\n\n// 2. Конфигурируем его: GET-запрос на URL 'phones.json'\nxhr.open('POST', 'http://demo5.traccar.org/api/session?token=7iHFLJysPzhqj5jt5FVXRTWYlvE0JKn9', false);\n\n// 3. Отсылаем запрос\nxhr.send();\n\n// 4. Если код ответа сервера не 200, то это ошибка\n\n  // вывести результат\n  msg.payload = xhr.responseText;\n  return msg// responseText -- текст ответа\n","outputs":1,"noerr":0,"x":474,"y":318,"wires":[["d96efaf8.0961f8"]]},{"id":"d96efaf8.0961f8","type":"debug","z":"18e0d651.2db41a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":704,"y":238,"wires":[]},{"id":"31f3047c.3c6c3c","type":"inject","z":"49f88b4f.625b74","name":"make request","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":205,"y":264,"wires":[["82b08dee.7b79a"]]},{"id":"82b08dee.7b79a","type":"http request","z":"49f88b4f.625b74","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"https://сатвика.рф","tls":"","proxy":"","x":369.5,"y":264,"wires":[["1fe6e0b9.affd9f"]]},{"id":"c131bee5.23ac2","type":"debug","z":"49f88b4f.625b74","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":810,"y":264,"wires":[]},{"id":"1fe6e0b9.affd9f","type":"html","z":"49f88b4f.625b74","name":"","property":"","outproperty":"","tag":".elementor-post__excerpt","ret":"text","as":"single","x":576.5,"y":264,"wires":[["c131bee5.23ac2"]]},{"id":"cd1b375a.9f0468","type":"http request","z":"acf47a97.8e7978","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"http://demo5.traccar.org/api/session?token=Jo1QgtmiLocCWBJbvCgc4ArEkLN86Lb5","tls":"","proxy":"","authType":"basic","x":400,"y":459,"wires":[["a3b0c07c.6c816"]]},{"id":"ece7cde6.f536","type":"websocket in","z":"8abcb9c4.969e58","name":"wss://echo.websocket.org","server":"","client":"672ff1be.ce75d","x":133,"y":205,"wires":[["9bf8b9b6.660158"]]},{"id":"efb184dc.1a1c88","type":"websocket out","z":"8abcb9c4.969e58","name":"wss://echo.websocket.org","server":"","client":"672ff1be.ce75d","x":471,"y":333,"wires":[]},{"id":"acfffb5f.a667e8","type":"debug","z":"8abcb9c4.969e58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":523,"y":272,"wires":[]},{"id":"a08e086.23b75f8","type":"inject","z":"8abcb9c4.969e58","name":"","topic":"","payload":"Hello World!","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":143,"y":272,"wires":[["efb184dc.1a1c88"]]},{"id":"9bf8b9b6.660158","type":"function","z":"8abcb9c4.969e58","name":"","func":"msg.payload = \"My Answer: '\" + msg.payload;\n// Return the message so it can be sent on\nreturn msg;","outputs":1,"noerr":0,"x":352,"y":247,"wires":[["acfffb5f.a667e8"]]},{"id":"fc49d80f.935c88","type":"debug","z":"8abcb9c4.969e58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":346,"y":436,"wires":[]},{"id":"776980b3.a9ff2","type":"inject","z":"8abcb9c4.969e58","name":"","topic":"","payload":"254","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":117,"y":377,"wires":[["fc49d80f.935c88"]]},{"id":"21b5b35c.ef055c","type":"debug","z":"8abcb9c4.969e58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":861,"y":512,"wires":[]},{"id":"23b34802.d201f8","type":"http in","z":"8abcb9c4.969e58","name":"","url":"/hello","method":"get","upload":false,"swaggerDoc":"","x":407,"y":615,"wires":[["b448af0a.cc778"]]},{"id":"b448af0a.cc778","type":"template","z":"8abcb9c4.969e58","name":"page","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<html>100</html>","x":629,"y":546,"wires":[["2264b56c.1bceaa","21b5b35c.ef055c"]]},{"id":"2264b56c.1bceaa","type":"http response","z":"8abcb9c4.969e58","name":"","statusCode":"","headers":{},"x":846,"y":362,"wires":[]},{"id":"d8ea3270.44c73","type":"samsung-tv-send","z":"b4dd18b0.7a5358","device":"32def38f.02e0cc","name":"Vol+","key":"KEY_VOLUP","x":510,"y":301,"wires":[]},{"id":"12213a1e.373a36","type":"samsung-tv-send","z":"b4dd18b0.7a5358","device":"32def38f.02e0cc","name":"Vol-","key":"KEY_VOLDOWN","x":511,"y":357,"wires":[]},{"id":"fc7b2cc9.b491d","type":"inject","z":"b4dd18b0.7a5358","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":301,"wires":[["d8ea3270.44c73"]]},{"id":"cc3a229b.96858","type":"inject","z":"b4dd18b0.7a5358","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":296,"y":358,"wires":[["12213a1e.373a36"]]},{"id":"15c2a5c5.0c904a","type":"samsung-tv-send","z":"b4dd18b0.7a5358","device":"32def38f.02e0cc","name":"Канал+","key":"KEY_CHUP","x":524,"y":428,"wires":[]},{"id":"97870158.c5d3b","type":"samsung-tv-send","z":"b4dd18b0.7a5358","device":"32def38f.02e0cc","name":"Канал-","key":"KEY_CHDOWN","x":527,"y":499,"wires":[]},{"id":"be8675ab.31b9f8","type":"inject","z":"b4dd18b0.7a5358","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":299,"y":511,"wires":[["97870158.c5d3b"]]},{"id":"ba9c40ba.d95c2","type":"inject","z":"b4dd18b0.7a5358","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":278,"y":424,"wires":[["15c2a5c5.0c904a"]]},{"id":"1620f66a.26e67a","type":"samsung-tv-send","z":"b4dd18b0.7a5358","device":"32def38f.02e0cc","name":"OFF","key":"KEY_POWEROFF","x":514,"y":578,"wires":[]},{"id":"b7d50b6c.29ae18","type":"samsung-tv-send","z":"b4dd18b0.7a5358","device":"32def38f.02e0cc","name":"ON","key":"KEY_POWERON","x":504,"y":238,"wires":[]},{"id":"b442be29.60c15","type":"inject","z":"b4dd18b0.7a5358","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":269,"y":159,"wires":[["c5112ac0.b8d8b8"]]},{"id":"c7e1793a.9a3b18","type":"inject","z":"b4dd18b0.7a5358","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":267,"y":584,"wires":[["1620f66a.26e67a"]]},{"id":"c5112ac0.b8d8b8","type":"wake on lan","z":"b4dd18b0.7a5358","mac":"78:AB:BB:FF:7D:4B","host":"192.168.1.124","name":"SamsungTV","x":508,"y":163,"wires":[]},{"id":"bc008ba7.cbce38","type":"inject","z":"b4dd18b0.7a5358","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":259,"y":236,"wires":[["b7d50b6c.29ae18"]]},{"id":"34d855b4.f0161a","type":"http response","z":"740b003f.0a2b","name":"","statusCode":"","headers":{},"x":573,"y":132,"wires":[]},{"id":"861a9e50.81778","type":"template","z":"740b003f.0a2b","name":"page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n    <head></head>\n    <body>\n        <h1>Hello {{req.params.name}}!</h1>\n    </body>\n</html>","x":420,"y":137,"wires":[["34d855b4.f0161a","a60054a6.5032b8"]]},{"id":"8e071679.fd0298","type":"http in","z":"740b003f.0a2b","name":"","url":"/rnd","method":"get","upload":false,"swaggerDoc":"","x":218,"y":108,"wires":[["861a9e50.81778","b4c91869.d20a48"]]},{"id":"a60054a6.5032b8","type":"debug","z":"740b003f.0a2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":705,"y":251,"wires":[]},{"id":"d9ef4eb.6ed3cb","type":"template","z":"740b003f.0a2b","name":"page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n    <head></head>\n    <body>\n        <h1>Hello {{req.query.name}}</h1>\n        <h1>Color {{req.query.color}}</h1>\n    </body>\n</html>","x":454,"y":417,"wires":[["dc78e7bd.d02e48","fdc3e7fc.a0cb68"]]},{"id":"f30419a.bda5be8","type":"http in","z":"740b003f.0a2b","name":"","url":"/hello-query","method":"get","upload":false,"swaggerDoc":"","x":236,"y":414,"wires":[["d9ef4eb.6ed3cb"]]},{"id":"dc78e7bd.d02e48","type":"http response","z":"740b003f.0a2b","name":"","statusCode":"","headers":{},"x":695,"y":417,"wires":[]},{"id":"fdc3e7fc.a0cb68","type":"debug","z":"740b003f.0a2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":686,"y":522,"wires":[]},{"id":"b4c91869.d20a48","type":"debug","z":"740b003f.0a2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":44,"wires":[]},{"id":"4ec5c163.5b939","type":"switch","z":"15c9eaa7.3c0665","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":712,"y":345,"wires":[["ba8839aa.725c28","7a73e685.4b1ed8"],["ba8839aa.725c28","5662ee3a.fcc9d"],["ba8839aa.725c28","1768ecd.5859e13"],["ba8839aa.725c28","a7567be0.dd0ab8"]]},{"id":"8433ce41.da17f","type":"delay","z":"15c9eaa7.3c0665","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":414,"y":235,"wires":[["40ae3a88.297854","e5bcabdc.c879c8"]]},{"id":"8fab048b.2b32d8","type":"inject","z":"15c9eaa7.3c0665","name":"start","topic":"","payload":"START","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":124,"y":312,"wires":[["4fac443b.45c78c","e5bcabdc.c879c8"]]},{"id":"ba8839aa.725c28","type":"debug","z":"15c9eaa7.3c0665","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":941,"y":393,"wires":[]},{"id":"40ae3a88.297854","type":"function","z":"15c9eaa7.3c0665","name":"for 1-4","func":"msg.payload = msg.payload + 1\nif (msg.payload == 5) {\n    msg.payload = 1\n}\nreturn msg;","outputs":1,"noerr":0,"x":406,"y":94,"wires":[["1b4a6897.97d7d7","8433ce41.da17f"]]},{"id":"12d39206.2c9e5e","type":"debug","z":"15c9eaa7.3c0665","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1030,"y":89,"wires":[]},{"id":"7a73e685.4b1ed8","type":"http request","z":"15c9eaa7.3c0665","name":"green","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.1.127/green","tls":"","proxy":"","authType":"basic","x":777,"y":80,"wires":[[]]},{"id":"3138bb74.040714","type":"html","z":"15c9eaa7.3c0665","name":"","property":"","outproperty":"","tag":"html","ret":"text","as":"single","x":953,"y":231,"wires":[["12d39206.2c9e5e"]]},{"id":"5662ee3a.fcc9d","type":"http request","z":"15c9eaa7.3c0665","name":"red","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.1.127/ON","tls":"","proxy":"","authType":"basic","x":778,"y":126,"wires":[[]]},{"id":"1768ecd.5859e13","type":"http request","z":"15c9eaa7.3c0665","name":"blue","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.1.127/blue","tls":"","proxy":"","authType":"basic","x":776,"y":174,"wires":[[]]},{"id":"a7567be0.dd0ab8","type":"http request","z":"15c9eaa7.3c0665","name":"rnd","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.1.127/rnd","tls":"","proxy":"","authType":"basic","x":782,"y":220,"wires":[["3138bb74.040714"]]},{"id":"c4b503a1.b163a","type":"inject","z":"15c9eaa7.3c0665","name":"stop","topic":"","payload":"STOP","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":121,"y":406,"wires":[["e5bcabdc.c879c8"]]},{"id":"4fac443b.45c78c","type":"function","z":"15c9eaa7.3c0665","name":"set 0","func":"msg.payload = 0\nreturn msg;","outputs":1,"noerr":0,"x":173,"y":22,"wires":[["40ae3a88.297854","1b4a6897.97d7d7"]]},{"id":"1b4a6897.97d7d7","type":"debug","z":"15c9eaa7.3c0665","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":634,"y":20,"wires":[]},{"id":"227bdd8.520df22","type":"debug","z":"15c9eaa7.3c0665","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":795,"y":617,"wires":[]},{"id":"e5bcabdc.c879c8","type":"traffic","z":"15c9eaa7.3c0665","name":"","property_allow":"payload","filter_allow":"START","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"STOP","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":504,"y":347,"wires":[["227bdd8.520df22","4ec5c163.5b939","d0d52611.e8cb08"]]},{"id":"74bb04bb.111b0c","type":"function","z":"15c9eaa7.3c0665","name":"> 45?","func":"newmsg = Object();\nif (msg.payload > 0.44) {\n newmsg.payload = \"STOP\";\n} else {\n newmsg.payload = \"Not Yet\";\n}\nreturn newmsg;","outputs":1,"noerr":0,"x":270,"y":641,"wires":[[]]},{"id":"d0d52611.e8cb08","type":"ui_numeric","z":"15c9eaa7.3c0665","name":"","label":"numeric","tooltip":"","group":"8b7266fe.98fd18","order":1,"width":0,"height":0,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":10,"step":1,"x":612,"y":235,"wires":[["4ec5c163.5b939"]]},{"id":"e4389dd9.4e244","type":"ui_button","z":"acf47a97.8e7978","name":"","group":"37c9237b.db7dbc","order":0,"width":0,"height":0,"passthru":false,"label":"Найти","tooltip":"","color":"","bgcolor":"","icon":"fa-male","payload":"","payloadType":"str","topic":"","x":173,"y":282,"wires":[["fead66fe.9f7978"]]},{"id":"fead66fe.9f7978","type":"template","z":"acf47a97.8e7978","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"","x":414,"y":360,"wires":[["804cb336.323e1"]]},{"id":"804cb336.323e1","type":"ui_template","z":"acf47a97.8e7978","group":"37c9237b.db7dbc","name":"","order":1,"width":"20","height":"12","format":"","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":634,"y":360,"wires":[[]]},{"id":"70c90c1c.e103f4","type":"ui_button","z":"acf47a97.8e7978","name":"","group":"37c9237b.db7dbc","order":2,"width":0,"height":0,"passthru":false,"label":"Стереть трек","tooltip":"","color":"","bgcolor":"","icon":"fa-male","payload":"{\"name\":\"HOMTOM\",\"deleted\":true}","payloadType":"json","topic":"","x":454,"y":400,"wires":[["622af3cb.c0503c"]]},{"id":"9ce498d9.25dab8","type":"http request","z":"acf47a97.8e7978","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"http://demo5.traccar.org/api/positions","tls":"","proxy":"","authType":"basic","x":404,"y":256,"wires":[[]]},{"id":"245c3591.bf528a","type":"inject","z":"acf47a97.8e7978","name":"","topic":"","payload":"","payloadType":"date","repeat":"15","crontab":"","once":false,"onceDelay":0.1,"x":164,"y":460,"wires":[["fead66fe.9f7978"]]},{"id":"a3e7b837.1aaa98","type":"function","z":"acf47a97.8e7978","name":"Adaptation","func":"var latitude = msg.payload[0].latitude;\nvar longitude = msg.payload[0].longitude;\nmsg.payload = {\"name\":\"HOMTOM\", \"lat\":latitude, \"lon\":longitude}; \nmsg.payload.layer = \"SensorData\";\nreturn msg;","outputs":1,"noerr":0,"x":613,"y":458,"wires":[["622af3cb.c0503c","550c812a.2e47d","e9748a97.cfac48"]]},{"id":"622af3cb.c0503c","type":"worldmap-tracks","z":"acf47a97.8e7978","name":"","depth":"250","layer":"combined","x":824,"y":420,"wires":[["550c812a.2e47d"]]},{"id":"550c812a.2e47d","type":"worldmap","z":"acf47a97.8e7978","name":"","lat":"","lon":"","zoom":"18","layer":"OSM grey","cluster":"","maxage":"12000","usermenu":"show","layers":"show","panit":"true","panlock":"false","zoomlock":"false","hiderightclick":"false","coords":"deg","path":"/worldmap","x":1014,"y":460,"wires":[]},{"id":"a3b0c07c.6c816","type":"debug","z":"acf47a97.8e7978","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":725,"y":662,"wires":[]},{"id":"e9748a97.cfac48","type":"debug","z":"acf47a97.8e7978","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1007,"y":549,"wires":[]},{"id":"5d2f9620.501298","type":"ui_colour_picker","z":"f4c13dae.1fd7a","name":"","label":"picker","group":"6dbdd2f.236602c","format":"hex","outformat":"string","showSwatch":true,"showPicker":false,"showValue":false,"showHue":false,"showAlpha":false,"showLightness":true,"dynOutput":"false","order":0,"width":0,"height":0,"passthru":true,"topic":"","x":463,"y":191,"wires":[["300b91b7.b8597e"]]},{"id":"300b91b7.b8597e","type":"debug","z":"f4c13dae.1fd7a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":667,"y":185,"wires":[]},{"id":"14279721.73d9e9","type":"inject","z":"f4c13dae.1fd7a","name":"","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":245,"y":329,"wires":[["60930c1.6e743f4"]]},{"id":"7214aa5a.b75504","type":"inject","z":"f4c13dae.1fd7a","name":"","topic":"","payload":"2","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":245,"y":389,"wires":[["60930c1.6e743f4"]]},{"id":"60930c1.6e743f4","type":"join","z":"f4c13dae.1fd7a","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":485,"y":349,"wires":[["a1d129ab.f74148"]]},{"id":"a1d129ab.f74148","type":"debug","z":"f4c13dae.1fd7a","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":695,"y":369,"wires":[]},{"id":"46a14e01.58295","type":"function","z":"f4c13dae.1fd7a","name":"IN ZONE","func":"var msg1 = {};\nvar msg2 = {};\nvar msg3 = {};\nvar msg4 = {};\nif (msg.location.inarea === true) {\n    msg1.payload = 1;\n    msg2.payload = msg.location.isat[0]\n    msg3.payload = msg.location.distances.work\n    msg4.payload = \"Вы находитесь на расстоянии \" + msg.location.distances.work + \"м от работы \"\n} \nelse {\n    msg1.payload = 0;\n    msg2.payload = \"вне зоны\"\n    msg3.payload = msg.location.distances.work\n    msg4.payload = \"Вы находитесь на расстоянии \" + msg.location.distances.work + \"м от работы \" \n}\n//msg.location.distances[msg.location.isat[0]]\nreturn [msg1,msg2,msg3,msg4]","outputs":4,"noerr":0,"x":448,"y":459,"wires":[[],[],[],[]]},{"id":"92b23f72.fef87","type":"mqtt in","z":"740c75b5.a1e69c","name":"zigbee2mqtt","topic":"zigbee2mqtt/#","qos":"2","broker":"299502c0.c3cdae","x":135,"y":119,"wires":[["47b19992.896228","f0015a64.e1e5e8"]]},{"id":"3dda1d0e.bd20c2","type":"inject","z":"740c75b5.a1e69c","name":"MotionHall_OFF","topic":"","payload":"{ \"idx\" : 18, \"nvalue\" : 0}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":667,"y":320,"wires":[["d58af45.545c508"]]},{"id":"d58af45.545c508","type":"mqtt out","z":"740c75b5.a1e69c","name":"domoticz/in","topic":"domoticz/in","qos":"2","retain":"","broker":"299502c0.c3cdae","x":919,"y":413,"wires":[]},{"id":"49ea9af3.867754","type":"inject","z":"740c75b5.a1e69c","name":"MotionHall_ON","topic":"","payload":"{ \"idx\" : 18, \"nvalue\" : 1}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":699,"y":233,"wires":[["d58af45.545c508"]]},{"id":"91e991ab.25231","type":"function","z":"740c75b5.a1e69c","name":"GetStatus","func":"if (msg.topic == \"zigbee2mqtt/bridge/state\" && msg.payload == \"offline\") {\n    msg.idx = null;\n    node.status({text: \"zigbee2mqtt state OFFLINE\"});\n    return msg;\n}\n\n// -----------------------------------------------------------------------------\n\nif(msg.DeviceType == \"Button\") {\n    \n    node.status({text: \"Button msg.payload: \" + msg.payload.click});\n    \n    if (msg.payload.click == \"single\") {\n        node.status({text: \"Кнопка: одиночный клик; idx=\" + msg.idx});\n        return {payload:{command: \"switchlight\", idx: msg.idx, switchcmd: \"Set Level\", level:10}};\n    }\n    else if (msg.payload.click == \"double\") {\n        node.status({text: \"Кнопка: двойной клик; idx=\" + msg.idx});\n        return {payload:{command: \"switchlight\", idx: msg.idx, switchcmd: \"Set Level\", level:20}};\n    }\n    else if (msg.payload.click == \"long\") {\n        node.status({text: \"Кнопка: длинный клик; idx=\" + msg.idx});\n        return {payload:{command: \"switchlight\", idx: msg.idx, switchcmd: \"Set Level\", level:30}};\n    }\n    else if (msg.payload.click == \"long_release\") {\n        node.status({text: \"Кнопка: отпущен длинный клик; idx=\" + msg.idx});\n        return {payload:{command: \"switchlight\", idx: msg.idx, switchcmd: \"Set Level\", level:40}};\n    }\n}\n\n// -----------------------------------------------------------------------------\n\nif(msg.DeviceType == \"Motion\") {\n    \n    isNewValue = false;\n    \n    if (typeof context.occupancy === 'undefined') {\n        context.occupancy = [];\n        context.occupancy[msg.idx] = -1;\n    }\n    \n    if (typeof msg.payload.occupancy !== 'undefined') {\n        if(msg.payload.occupancy) {\n            if (context.occupancy[msg.idx] != 1) {\n                context.occupancy[msg.idx] = 1;\n                isNewValue = true;\n            }\n        }\n        else if(!msg.payload.occupancy) {\n            if (context.occupancy[msg.idx] !== 0) {\n                context.occupancy[msg.idx] = 0;\n                isNewValue = true;\n            }\n        }\n    }\n        \n    if (isNewValue) {\n        node.status({text: \"Наличие движения: \" + context.occupancy[msg.idx] + \"; idx=\" + msg.idx});\n        return {payload:{ idx: msg.idx , nvalue:context.occupancy[msg.idx]}};\n    }\n}\n\n// -----------------------------------------------------------------------------\n\nif(msg.DeviceType == \"Door\") {\n    \n    if(msg.payload.contact) {\n        node.status({text: \"Дверь: открыта; idx=\" + msg.idx});\n        return {payload:{ idx: msg.idx , nvalue:0}};\n    }\n    else {\n        node.status({text: \"Дверь: закрыта; idx=\" + msg.idx});\n        return {payload:{ idx: msg.idx , nvalue:1}};\n    }\n}\n\n// -----------------------------------------------------------------------------\n\nif(msg.DeviceType == \"Temp\") {\n    \n    //isNewValue = false;\n    \n    if (typeof context.temperature === 'undefined') {\n        context.temperature = [];\n        context.temperature[msg.idx] = 0;\n    }\n    \n    if (typeof context.humidity === 'undefined') {\n        context.humidity = [];\n        context.humidity[msg.idx] = 0;\n    }\n    \n    if (typeof msg.payload.temperature !== 'undefined') {\n        context.temperature[msg.idx] = msg.payload.temperature;\n        isNewValue = true;\n    }\n    if (typeof msg.payload.humidity !== 'undefined') {\n        context.humidity[msg.idx] = msg.payload.humidity;\n        isNewValue = true;\n    }\n    \n    if (isNewValue && context.temperature[msg.idx] !== 0 && context.humidity[msg.idx] !== 0) \n    {\n        node.status({text: \"температура: \" + context.temperature[msg.idx] + \"°С, влажность: \" +  context.humidity[msg.idx] + \"%; idx=\" + msg.idx});\n        return {payload:{ idx: msg.idx , nvalue:0, svalue:context.temperature[msg.idx] +\";\"+ context.humidity[msg.idx] +\";1\"}};\n    }\n}\n\n// -----------------------------------------------------------------------------\n\nmsg.idx = null;\nnode.status(\"Сообщение не обработано\");\nreturn msg;","outputs":1,"noerr":0,"x":589,"y":453,"wires":[["9eb67c8d.cb816"]]},{"id":"9eb67c8d.cb816","type":"switch","z":"740c75b5.a1e69c","name":"IsIdxFound","property":"payload.idx","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":759,"y":453,"wires":[["d58af45.545c508"],["a59cde61.0d2ec"]]},{"id":"b32c5379.34475","type":"switch","z":"740c75b5.a1e69c","name":"","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"0x00158d0001","vt":"str"},{"t":"cont","v":"0x00158d0002","vt":"str"},{"t":"cont","v":"0x00158d0003","vt":"str"},{"t":"cont","v":"0x00158d0004","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":5,"x":239,"y":433,"wires":[["8b1544b.4e295b8"],["2875b73.317bb48"],["bd31c56e.526cc8"],["86c65e63.66c65"],["f0e84826.16d578"]]},{"id":"8b1544b.4e295b8","type":"change","z":"740c75b5.a1e69c","name":"MotionHall","rules":[{"t":"set","p":"idx","pt":"msg","to":"18","tot":"num"},{"t":"set","p":"DeviceType","pt":"msg","to":"Motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":413,"y":285,"wires":[["91e991ab.25231"]]},{"id":"2875b73.317bb48","type":"change","z":"740c75b5.a1e69c","name":"TempHall","rules":[{"t":"set","p":"idx","pt":"msg","to":"21","tot":"num"},{"t":"set","p":"DeviceType","pt":"msg","to":"Temp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":416,"y":349,"wires":[["91e991ab.25231"]]},{"id":"bd31c56e.526cc8","type":"change","z":"740c75b5.a1e69c","name":"ButtonHall","rules":[{"t":"set","p":"idx","pt":"msg","to":"13","tot":"num"},{"t":"set","p":"DeviceType","pt":"msg","to":"Button","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":408,"y":405,"wires":[["91e991ab.25231"]]},{"id":"7f580d82.5e40c4","type":"json","z":"740c75b5.a1e69c","name":"","property":"payload","action":"","pretty":false,"x":135,"y":346,"wires":[["b32c5379.34475"]]},{"id":"f0015a64.e1e5e8","type":"debug","z":"740c75b5.a1e69c","name":"Input","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":329,"y":75,"wires":[]},{"id":"47b19992.896228","type":"switch","z":"740c75b5.a1e69c","name":"IsJson","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"{","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":298,"y":168,"wires":[["7f580d82.5e40c4"]]},{"id":"86c65e63.66c65","type":"change","z":"740c75b5.a1e69c","name":"Door","rules":[{"t":"set","p":"idx","pt":"msg","to":"10","tot":"num"},{"t":"set","p":"DeviceType","pt":"msg","to":"Door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":416,"y":466,"wires":[["91e991ab.25231"]]},{"id":"652db949.4f0e88","type":"inject","z":"740c75b5.a1e69c","name":"","topic":"zigbee2mqtt/0x00158d0006","payload":"{\"battery\":\"100.00\",\"voltage\":3025,\"temperature\":24.22,\"humidity\":42.96}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":113,"y":209,"wires":[["47b19992.896228"]]},{"id":"f0e84826.16d578","type":"debug","z":"740c75b5.a1e69c","name":"ID not found","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":399,"y":533,"wires":[]},{"id":"a59cde61.0d2ec","type":"debug","z":"740c75b5.a1e69c","name":"GetStatus error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":929,"y":493,"wires":[]},{"id":"9da0e9ef.e8bfc8","type":"debug","z":"c4829f93.87cba","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":950,"y":260,"wires":[]},{"id":"857d8563.065f38","type":"inject","z":"c4829f93.87cba","name":"start","topic":"","payload":"test1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":180,"wires":[["29c813ed.ce439c"]]},{"id":"79cac4fc.d163ac","type":"inject","z":"c4829f93.87cba","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":280,"y":320,"wires":[["906e8c72.7ee2e"]]},{"id":"19f86868.fc7538","type":"change","z":"c4829f93.87cba","name":"setOn","rules":[{"t":"set","p":"lamp1","pt":"flow","to":"true","tot":"bool"},{"t":"set","p":"lamp2","pt":"flow","to":"Сработало","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":120,"wires":[[]]},{"id":"538acebb.7f9e4","type":"function","z":"c4829f93.87cba","name":"","func":"msg.payload = \"сработало\"\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":220,"wires":[["9da0e9ef.e8bfc8"]]},{"id":"906e8c72.7ee2e","type":"switch","z":"c4829f93.87cba","name":"","property":"lamp1","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":550,"y":320,"wires":[["538acebb.7f9e4"],["d7aa192f.056dd8"]]},{"id":"d7aa192f.056dd8","type":"function","z":"c4829f93.87cba","name":"","func":"msg.payload = \"нет\"\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":300,"wires":[["9da0e9ef.e8bfc8"]]},{"id":"4e8860bd.57c8","type":"inject","z":"c4829f93.87cba","name":"","topic":"","payload":"test","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":120,"wires":[["19f86868.fc7538"]]},{"id":"29c813ed.ce439c","type":"change","z":"c4829f93.87cba","name":"setOff","rules":[{"t":"set","p":"lamp1","pt":"flow","to":"false","tot":"bool"},{"t":"set","p":"lamp2","pt":"flow","to":"Нет","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":180,"wires":[[]]},{"id":"6046281.73eded8","type":"http in","z":"4bc40f.33b24bf","name":"","url":"/myhome","method":"post","upload":false,"swaggerDoc":"","x":100,"y":200,"wires":[["1f73ccbe.ea7183"]]},{"id":"1f73ccbe.ea7183","type":"switch","z":"4bc40f.33b24bf","name":"not ping","property":"payload.request.command","propertyType":"msg","rules":[{"t":"neq","v":"ping","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":300,"y":260,"wires":[["b4e19d69.36618","2c0e30fb.0fb79"]]},{"id":"1fe7f00e.00bd2","type":"debug","z":"4bc40f.33b24bf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":360,"wires":[]},{"id":"b4e19d69.36618","type":"template","z":"4bc40f.33b24bf","name":"page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"User agent: {{req.headers.user-agent}}","x":410,"y":360,"wires":[["1fe7f00e.00bd2"]]},{"id":"e93f8a84.8a2508","type":"http response","z":"4bc40f.33b24bf","name":"","statusCode":"","headers":{},"x":1970,"y":300,"wires":[]},{"id":"bccb15c2.6d8ed8","type":"debug","z":"4bc40f.33b24bf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":180,"wires":[]},{"id":"fc566d53.495b1","type":"switch","z":"4bc40f.33b24bf","name":"user","property":"payload.session.user_id","propertyType":"msg","rules":[{"t":"eq","v":"myhome.userId[0]","vt":"flow"},{"t":"eq","v":"myhome.userId[1]","vt":"flow"},{"t":"eq","v":"myhome.userId[2]","vt":"flow"},{"t":"else"}],"checkall":"true","repair":false,"outputs":4,"x":710,"y":260,"wires":[["8cf4a925.47afd8"],["8cf4a925.47afd8"],["8cf4a925.47afd8"],["e2c89944.c8baa8","af1b25ef.46fff8"]]},{"id":"e2c89944.c8baa8","type":"template","z":"4bc40f.33b24bf","name":"go away","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"response\": {\n    \"text\": \"{{payload.const.intruderText}}\",\n    \"end_session\": false\n        },\n    \"session\": {\n        \"session_id\": \"{{payload.session.session_id}}\",\n        \"message_id\": 4,\n        \"user_id\": \"{{payload.session.user_id}}\"\n        },\n    \"version\": \"1.0\"\n}","output":"json","x":1500,"y":320,"wires":[["e93f8a84.8a2508"]]},{"id":"8cf4a925.47afd8","type":"switch","z":"4bc40f.33b24bf","name":"entity","property":"payload.request.command","propertyType":"msg","rules":[{"t":"cont","v":"myhome.entities.Lamp","vt":"flow"},{"t":"empty"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":910,"y":180,"wires":[["aa196ca.308189"],["ac5a7f6d.c079c","456b58e2.4c4e58"],["e95a8079.83a7","1d0b5cad.a83d53"]]},{"id":"aa196ca.308189","type":"switch","z":"4bc40f.33b24bf","name":"turn on/off","property":"payload.request.command","propertyType":"msg","rules":[{"t":"cont","v":"включ","vt":"str"},{"t":"cont","v":"выключ","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1080,"y":100,"wires":[["3ba11b5b.8fb894","184fa964.1f0a67"],["e0285b1.db5aca8","746a89f5.6faa78"]]},{"id":"df4dfcb2.51b2e","type":"template","z":"4bc40f.33b24bf","name":"turn on","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"response\": {\n    \"text\": \"{{payload.const.turnOnText}}\",\n    \"end_session\": false\n        },\n    \"session\": {\n        \"session_id\": \"{{payload.session.session_id}}\",\n        \"message_id\": 4,\n        \"user_id\": \"{{payload.session.user_id}}\"\n        },\n    \"version\": \"1.0\"\n}","output":"json","x":1720,"y":80,"wires":[["e93f8a84.8a2508"]]},{"id":"e95a8079.83a7","type":"template","z":"4bc40f.33b24bf","name":"not found","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"response\": {\n    \"text\": \"{{payload.const.notFoundText}}\",\n    \"end_session\": false\n        },\n    \"session\": {\n        \"session_id\": \"{{payload.session.session_id}}\",\n        \"message_id\": 4,\n        \"user_id\": \"{{payload.session.user_id}}\"\n        },\n    \"version\": \"1.0\"\n}","output":"json","x":1500,"y":280,"wires":[["e93f8a84.8a2508"]]},{"id":"c1c8c9ef.fd9358","type":"template","z":"4bc40f.33b24bf","name":"turn off","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"response\": {\n    \"text\": \"{{payload.const.turnOffText}}\",\n    \"end_session\": false\n        },\n    \"session\": {\n        \"session_id\": \"{{payload.session.session_id}}\",\n        \"message_id\": 4,\n        \"user_id\": \"{{payload.session.user_id}}\"\n        },\n    \"version\": \"1.0\"\n}","output":"json","x":1710,"y":140,"wires":[["e93f8a84.8a2508"]]},{"id":"db24d1e7.91f34","type":"template","z":"4bc40f.33b24bf","name":"Settings object","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"helloWord\": \"Здравствуйте, дом приветствует вас!\",\n    \"intruderText\": \"Что-то не похож ты на моего хозяина. А ну-ка вон отсюда!\",\n    \"notFoundText\": \"Устройство не найдено!\",\n    \"userId\": [\"00023C4E21BEB515A93DC99824FDE96B59F2A7FD69F40E4BCC645E7D8FB37CFD\",\n               \"95F6936A770A9DD5DC4A1DC3BA63049E7DA4FC1AD90E2DB77DA108B1D8CBF6E5\",\n               \"673E752B3F689338D0DBCCF6425D9187A3CFD4CD072CA4C0639FF80AAEB45AA1\"],\n    \"turnOnText\": \"Включаю\",\n    \"turnOffText\": \"Выключаю\",\n    \"turnOnTooText\": \"Уже включен\",\n    \"turnOffTooText\": \"Уже выключен\",\n    \"entities\": {\n        \"Lamp\": \"свет\"\n    }\n}\n","output":"json","x":440,"y":120,"wires":[["82e181fb.1092f"]]},{"id":"ac5a7f6d.c079c","type":"template","z":"4bc40f.33b24bf","name":"hello word","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"response\": {\n    \"text\": \"{{payload.const.helloWord}}\",\n    \"end_session\": false\n        },\n    \"session\": {\n        \"session_id\": \"{{payload.session.session_id}}\",\n        \"message_id\": 4,\n        \"user_id\": \"{{payload.session.user_id}}\"\n        },\n    \"version\": \"1.0\"\n}","output":"json","x":1510,"y":240,"wires":[["e93f8a84.8a2508"]]},{"id":"d3f27b49.45ea28","type":"inject","z":"4bc40f.33b24bf","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"10","x":250,"y":120,"wires":[["db24d1e7.91f34","6cf756a.b7da9a8","27d57469.0df47c"]]},{"id":"82e181fb.1092f","type":"function","z":"4bc40f.33b24bf","name":"Settings myhome","func":"flow.set(\"myhome\", msg.payload)","outputs":1,"noerr":0,"x":650,"y":120,"wires":[[]]},{"id":"2c0e30fb.0fb79","type":"function","z":"4bc40f.33b24bf","name":"Settings const","func":"msg.payload.const = flow.get(\"myhome\")\nreturn msg","outputs":1,"noerr":0,"x":500,"y":260,"wires":[["bccb15c2.6d8ed8","fc566d53.495b1"]]},{"id":"7b13a7ac.7d6ff8","type":"comment","z":"4bc40f.33b24bf","name":"Задаем наши статичные параметры (не забываем после изменения нажимать на синюю кнопку timestamp)","info":"","x":460,"y":80,"wires":[]},{"id":"edd75b75.a7f808","type":"debug","z":"4bc40f.33b24bf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1990,"y":460,"wires":[]},{"id":"3ba11b5b.8fb894","type":"template","z":"4bc40f.33b24bf","name":"Включить","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Включить","output":"str","x":1500,"y":380,"wires":[["edd75b75.a7f808"]]},{"id":"e0285b1.db5aca8","type":"template","z":"4bc40f.33b24bf","name":"Выключить","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Выключить","output":"str","x":1510,"y":420,"wires":[["edd75b75.a7f808"]]},{"id":"456b58e2.4c4e58","type":"template","z":"4bc40f.33b24bf","name":"Привет","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Привет","output":"str","x":1500,"y":460,"wires":[["edd75b75.a7f808"]]},{"id":"1d0b5cad.a83d53","type":"template","z":"4bc40f.33b24bf","name":"не найдено","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"не найдено","output":"str","x":1510,"y":500,"wires":[["edd75b75.a7f808"]]},{"id":"af1b25ef.46fff8","type":"template","z":"4bc40f.33b24bf","name":"Прощай","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Прощай","output":"str","x":1500,"y":540,"wires":[["edd75b75.a7f808"]]},{"id":"6cf756a.b7da9a8","type":"debug","z":"4bc40f.33b24bf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":490,"y":200,"wires":[]},{"id":"184fa964.1f0a67","type":"switch","z":"4bc40f.33b24bf","name":"Lamp is on/off","property":"lamp","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1280,"y":60,"wires":[["b3774d5c.3bc4d"],["9d65f7ac.ee7c48"]]},{"id":"b3774d5c.3bc4d","type":"template","z":"4bc40f.33b24bf","name":"turn on too","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"response\": {\n    \"text\": \"{{payload.const.turnOnTooText}}\",\n    \"end_session\": false\n        },\n    \"session\": {\n        \"session_id\": \"{{payload.session.session_id}}\",\n        \"message_id\": 4,\n        \"user_id\": \"{{payload.session.user_id}}\"\n        },\n    \"version\": \"1.0\"\n}","output":"json","x":1510,"y":40,"wires":[["e93f8a84.8a2508"]]},{"id":"3d6f892d.7101b6","type":"template","z":"4bc40f.33b24bf","name":"turn off too","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"response\": {\n    \"text\": \"{{payload.const.turnOffTooText}}\",\n    \"end_session\": false\n        },\n    \"session\": {\n        \"session_id\": \"{{payload.session.session_id}}\",\n        \"message_id\": 4,\n        \"user_id\": \"{{payload.session.user_id}}\"\n        },\n    \"version\": \"1.0\"\n}","output":"json","x":1510,"y":200,"wires":[["e93f8a84.8a2508"]]},{"id":"746a89f5.6faa78","type":"switch","z":"4bc40f.33b24bf","name":"Lamp is on/off","property":"lamp","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1280,"y":160,"wires":[["1fd096ae.8b9539"],["3d6f892d.7101b6"]]},{"id":"1fd096ae.8b9539","type":"change","z":"4bc40f.33b24bf","name":"Lamp set Off","rules":[{"t":"set","p":"lamp","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1510,"y":140,"wires":[["c1c8c9ef.fd9358"]]},{"id":"9d65f7ac.ee7c48","type":"change","z":"4bc40f.33b24bf","name":"Lamp set On","rules":[{"t":"set","p":"lamp","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1510,"y":80,"wires":[["df4dfcb2.51b2e"]]},{"id":"22983a5f.867896","type":"debug","z":"4bc40f.33b24bf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1490,"y":640,"wires":[]},{"id":"342b2d18.7952f2","type":"inject","z":"4bc40f.33b24bf","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":860,"y":640,"wires":[["c0d2fa61.3bfa68"]]},{"id":"c487c9a4.a523a8","type":"function","z":"4bc40f.33b24bf","name":"","func":"msg.payload = \"сработало\"\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":660,"wires":[["22983a5f.867896"]]},{"id":"c0d2fa61.3bfa68","type":"switch","z":"4bc40f.33b24bf","name":"","property":"lamp","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1090,"y":700,"wires":[["c487c9a4.a523a8"],["cbfea12.c8f7a6"]]},{"id":"cbfea12.c8f7a6","type":"function","z":"4bc40f.33b24bf","name":"","func":"msg.payload = \"нет\"\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":740,"wires":[["22983a5f.867896"]]},{"id":"65472752.ef5af8","type":"change","z":"4bc40f.33b24bf","name":"setOn","rules":[{"t":"set","p":"lamp","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1090,"y":560,"wires":[[]]},{"id":"7688be3f.6a067","type":"inject","z":"4bc40f.33b24bf","name":"","topic":"","payload":"test","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":830,"y":560,"wires":[["65472752.ef5af8"]]},{"id":"27d57469.0df47c","type":"change","z":"4bc40f.33b24bf","name":"Lamp setOff","rules":[{"t":"set","p":"lamp","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":40,"wires":[[]]},{"id":"1dda1ebb.767ff1","type":"switch","z":"c4829f93.87cba","name":"","property":"lamp2","propertyType":"flow","rules":[{"t":"cont","v":"Сработало","vt":"str"},{"t":"cont","v":"Нет","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":550,"y":240,"wires":[["538acebb.7f9e4"],["d7aa192f.056dd8"]]},{"id":"e812e652.9305e8","type":"inject","z":"c4829f93.87cba","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":280,"y":240,"wires":[["1dda1ebb.767ff1"]]},{"id":"85b56b86.e69e68","type":"http in","z":"c4829f93.87cba","name":"lamp","url":"/lamp","method":"get","upload":false,"swaggerDoc":"","x":190,"y":520,"wires":[["83e8d41.7f89928","488d7b62.f8f134","dfff0986.d679d8"]]},{"id":"844c3fcc.019bf","type":"debug","z":"c4829f93.87cba","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1110,"y":420,"wires":[]},{"id":"69cc421a.5de9dc","type":"inject","z":"c4829f93.87cba","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":640,"wires":[["8c58e3a6.b995d"]]},{"id":"b2163995.c61188","type":"debug","z":"c4829f93.87cba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":980,"y":640,"wires":[]},{"id":"8c58e3a6.b995d","type":"change","z":"c4829f93.87cba","name":"LampON","rules":[{"t":"set","p":"url","pt":"msg","to":"http://192.168.1.71/gpio?st=1&pin=15","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":640,"wires":[["6fac80bb.5ebb"]]},{"id":"6fac80bb.5ebb","type":"http request","z":"c4829f93.87cba","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","tls":"","proxy":"","x":770,"y":640,"wires":[["b2163995.c61188"]]},{"id":"4f654a8a.fbe014","type":"inject","z":"c4829f93.87cba","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"5","x":360,"y":700,"wires":[["b66e0e9.0fb34f"]]},{"id":"9efe2ed1.f5c1f","type":"function","z":"c4829f93.87cba","name":"ESP_Get to JSON Check and Save","func":"if(typeof(msg.payload) == \"string\" && msg.payload[0] != \"{\"){\n    msg.payload = \"{\\\"\" + msg.payload + \"\\\"}\"; \n    return [msg, null];\n    \n}\nelse if(typeof(msg.payload) == \"object\"){\n    if(msg.payload.userhost == \"dfghbf\"){\n        if(msg.payload.bmet < -40 || msg.payload.bmet > 55){\n            msg.payload.bmet = -555;\n        }\n        if(msg.payload.bmeh < 0 || msg.payload.bmeh > 100){\n            msg.payload.bmeh = -555;\n        }\n        if(msg.payload.bmep < 650 || msg.payload.bmep > 800){\n            msg.payload.bmep = -555;\n        }\n        if(msg.payload.bh < 0 || msg.payload.bh > 36600){\n            msg.payoad.bh = -555;\n        }\n    }\n    msg.payload.time = getTime();\n    return [null, msg];\n}\nelse if(typeof(msg.payload) == \"string\" && msg.payload[0] == \"{\"){\n    context.global.ulica2 = msg.payload;\n}","outputs":2,"noerr":0,"x":440,"y":960,"wires":[["367e4851.813cd8"],["1f97b56f.0f778b"]]},{"id":"367e4851.813cd8","type":"change","z":"c4829f93.87cba","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":":","fromt":"str","to":"\":\"","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":";","fromt":"str","to":"\",\"","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":",\"\"","fromt":"str","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":840,"wires":[["30d1b633.3fee3a"]]},{"id":"1f97b56f.0f778b","type":"json","z":"c4829f93.87cba","name":"","property":"payload","action":"","pretty":false,"x":450,"y":1100,"wires":[["9efe2ed1.f5c1f"]]},{"id":"30d1b633.3fee3a","type":"json","z":"c4829f93.87cba","name":"","property":"payload","action":"","pretty":false,"x":570,"y":840,"wires":[["9efe2ed1.f5c1f"]]},{"id":"83e8d41.7f89928","type":"function","z":"c4829f93.87cba","name":"get pin15","func":"msg.payload = msg.payload.gpiout15\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":520,"wires":[["1018f0d1.da23af"]]},{"id":"be3c7951.9cc7c8","type":"inject","z":"c4829f93.87cba","name":"make request","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":310,"y":760,"wires":[["f960974.da17268"]]},{"id":"f960974.da17268","type":"http request","z":"c4829f93.87cba","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.1.71/readjson","tls":"","proxy":"","x":550,"y":760,"wires":[["f7157d58.7db4f"]]},{"id":"8b344075.b19cc","type":"debug","z":"c4829f93.87cba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1090,"y":760,"wires":[]},{"id":"4f7e4fe8.221e1","type":"change","z":"c4829f93.87cba","name":"","rules":[{"t":"set","p":"test","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":420,"wires":[["7694abc6.ff4484"]]},{"id":"1018f0d1.da23af","type":"switch","z":"c4829f93.87cba","name":"on - off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":510,"y":520,"wires":[["4f7e4fe8.221e1"],["574679e2.18cd18"]]},{"id":"574679e2.18cd18","type":"change","z":"c4829f93.87cba","name":"","rules":[{"t":"set","p":"test","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":460,"wires":[["7694abc6.ff4484"]]},{"id":"7694abc6.ff4484","type":"change","z":"c4829f93.87cba","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"test","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":440,"wires":[["844c3fcc.019bf"]]},{"id":"68a8ec5e.a77bd4","type":"http in","z":"c4829f93.87cba","name":"lamp1","url":"/lamp1","method":"get","upload":false,"swaggerDoc":"","x":190,"y":440,"wires":[["2d6079d8.3f5a96","dfff0986.d679d8","488d7b62.f8f134"]]},{"id":"2d6079d8.3f5a96","type":"switch","z":"c4829f93.87cba","name":"","property":"payload.lamp","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":440,"wires":[["4f7e4fe8.221e1"],["574679e2.18cd18"]]},{"id":"b66e0e9.0fb34f","type":"change","z":"c4829f93.87cba","name":"LampOff","rules":[{"t":"set","p":"url","pt":"msg","to":"http://192.168.1.71/gpio?st=0&pin=15","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":700,"wires":[["6fac80bb.5ebb"]]},{"id":"43bbe178.9ded1","type":"debug","z":"c4829f93.87cba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":790,"y":540,"wires":[]},{"id":"62c6bd00.896814","type":"inject","z":"f4c13dae.1fd7a","name":"inject","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":210,"y":680,"wires":[["89c51e44.8e449"]]},{"id":"89c51e44.8e449","type":"template","z":"f4c13dae.1fd7a","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"one;two;three;four;five","x":340,"y":680,"wires":[["560b217a.bbe1a"]]},{"id":"560b217a.bbe1a","type":"split","z":"f4c13dae.1fd7a","name":"","splt":";","spltType":"str","arraySplt":"1","arraySpltType":"len","stream":false,"addname":"","x":290,"y":740,"wires":[["67c93570.a7023c","719eb1a3.ac0e7"]]},{"id":"67c93570.a7023c","type":"change","z":"f4c13dae.1fd7a","name":"Prepend line number","rules":[{"t":"set","p":"payload","pt":"msg","to":"(parts.index+1) & \": \" & payload","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":740,"wires":[["72eb15ef.b67b4c","3f60fdc1.706dc2"]]},{"id":"72eb15ef.b67b4c","type":"join","z":"f4c13dae.1fd7a","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","timeout":"","count":"","x":650,"y":660,"wires":[["3c3841ad.0b9c9e"]]},{"id":"3c3841ad.0b9c9e","type":"debug","z":"f4c13dae.1fd7a","name":"debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":750,"y":740,"wires":[]},{"id":"719eb1a3.ac0e7","type":"debug","z":"f4c13dae.1fd7a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":560,"y":940,"wires":[]},{"id":"3f60fdc1.706dc2","type":"debug","z":"f4c13dae.1fd7a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":800,"y":940,"wires":[]},{"id":"f7157d58.7db4f","type":"json","z":"c4829f93.87cba","name":"","property":"payload","action":"","pretty":false,"x":730,"y":760,"wires":[["3e3596a.6dd7b6a"]]},{"id":"3e3596a.6dd7b6a","type":"function","z":"c4829f93.87cba","name":"Pin15 status","func":"var value = msg.payload.gpio[\"15\"];\nmsg.payload = value;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":760,"wires":[["8b344075.b19cc"]]},{"id":"488d7b62.f8f134","type":"template","z":"c4829f93.87cba","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"This is the payload: {{payload}} !","output":"str","x":400,"y":580,"wires":[["43bbe178.9ded1","469e84cd.43403c"]]},{"id":"469e84cd.43403c","type":"http response","z":"c4829f93.87cba","name":"","statusCode":"","headers":{},"x":700,"y":600,"wires":[]},{"id":"dfff0986.d679d8","type":"debug","z":"c4829f93.87cba","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":400,"y":400,"wires":[]},{"id":"bec9b13d.a859f","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"0,36,48,60,72,84,90,120,240,600","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":40,"wires":[["cdaad243.66727","f7e2edcc.4197f"]]},{"id":"cdaad243.66727","type":"split","z":"af357553.2f0528","name":"","splt":",","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":270,"y":60,"wires":[["7d0ce3c.862e01c"]]},{"id":"9e4a9f66.be3fe","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":350,"y":620,"wires":[]},{"id":"f2efe5f7.236468","type":"switch","z":"af357553.2f0528","name":"<14","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"14","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":260,"wires":[["4047e4d6.ced48c"],["d1912fa7.3ae3e"]]},{"id":"4047e4d6.ced48c","type":"change","z":"af357553.2f0528","name":"+28","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload + 28","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":230,"y":320,"wires":[["5985cc84.fa7814"]]},{"id":"5985cc84.fa7814","type":"change","z":"af357553.2f0528","name":"*4","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload * 4","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":230,"y":400,"wires":[["35a85221.47118e"]]},{"id":"7d0ce3c.862e01c","type":"change","z":"af357553.2f0528","name":"number","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":100,"wires":[["fa9c9c0.3e0e868"]]},{"id":"fa9c9c0.3e0e868","type":"change","z":"af357553.2f0528","name":"/6","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload / 6","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":180,"wires":[["f2efe5f7.236468"]]},{"id":"d1912fa7.3ae3e","type":"change","z":"af357553.2f0528","name":"-8","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload - 8","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":320,"wires":[["f7e1050.7b840f8"]]},{"id":"f7e1050.7b840f8","type":"change","z":"af357553.2f0528","name":"*9","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload * 9","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":400,"wires":[["35a85221.47118e"]]},{"id":"35a85221.47118e","type":"join","z":"af357553.2f0528","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":"false","timeout":"","count":"","reduceRight":false,"x":450,"y":500,"wires":[["9e4a9f66.be3fe"]]},{"id":"f7e2edcc.4197f","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":130,"y":120,"wires":[]},{"id":"b694653d.e163d8","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":960,"wires":[["a725682f.417928"]]},{"id":"a725682f.417928","type":"function","z":"af357553.2f0528","name":"","func":"var par0 = Object();\npar0 = {items:[{id: 456, \n                owner_id: -123\n                },\n            ]}\nmsg.payload = par0; \nreturn msg;","outputs":1,"noerr":0,"x":580,"y":980,"wires":[["538d97b5.05a7c8","10179250.67ed8e"]]},{"id":"10179250.67ed8e","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":980,"wires":[]},{"id":"538d97b5.05a7c8","type":"function","z":"af357553.2f0528","name":"","func":"par0 = msg.payload.items[0].owner_id;\nmsg.payload = par0; \nreturn msg;","outputs":1,"noerr":0,"x":610,"y":1080,"wires":[["66b2215d.777e4"]]},{"id":"66b2215d.777e4","type":"change","z":"af357553.2f0528","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$abs(payload)\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":1080,"wires":[["10179250.67ed8e"]]},{"id":"e7f8fa44.75d158","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"123","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":860,"wires":[["eb744e5.1b14cb"]]},{"id":"eb744e5.1b14cb","type":"function","z":"af357553.2f0528","name":"","func":"msg.payload = JSON.stringify({\"param\": msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":860,"wires":[["7ea45df4.d8df74"]]},{"id":"7ea45df4.d8df74","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":710,"y":860,"wires":[]},{"id":"ece92b0b.4fb168","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":360,"y":1200,"wires":[["e074632.a155ba"]]},{"id":"e074632.a155ba","type":"delay","z":"af357553.2f0528","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":1200,"wires":[["fd40cb2d.c80c38"]]},{"id":"830f44c4.3fa1c8","type":"status","z":"af357553.2f0528","name":"","scope":["e074632.a155ba","fd40cb2d.c80c38"],"x":360,"y":1280,"wires":[["f376909c.46947","c9fe8a9f.f472d8"]],"info":"# Status"},{"id":"f376909c.46947","type":"function","z":"af357553.2f0528","name":"check status","func":"msg.payload = msg.status\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":1280,"wires":[["6c7bb8f.c2fac48"]]},{"id":"fd40cb2d.c80c38","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":830,"y":1200,"wires":[]},{"id":"f6ea331f.1e798","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":790,"y":1360,"wires":[]},{"id":"c9fe8a9f.f472d8","type":"function","z":"af357553.2f0528","name":"check status","func":"if (msg.status.fill === \"blue\")\n{msg.payload = 'delaying'}\nelse\n{msg.payload = 'not delaying'}\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":1360,"wires":[["f6ea331f.1e798"]]},{"id":"6c7bb8f.c2fac48","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810,"y":1280,"wires":[]},{"id":"a543ec02.13979","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1700,"wires":[["53e0f522.20534c"]]},{"id":"10f265df.d57c8a","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1760,"wires":[["53e0f522.20534c"]]},{"id":"91317c.026f5e88","type":"catch","z":"af357553.2f0528","name":"","scope":["22f5bdb7.ae4af2","e6ab54af.a7ca98"],"uncaught":false,"x":150,"y":1460,"wires":[["8a833ad9.e7d518"]]},{"id":"e6ab54af.a7ca98","type":"function","z":"af357553.2f0528","name":"Throw Error","func":"node.error(\"an example error\", msg);   ","outputs":1,"noerr":0,"x":330,"y":1400,"wires":[[]]},{"id":"8a833ad9.e7d518","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"error","targetType":"msg","x":320,"y":1460,"wires":[]},{"id":"84d5b9d2.76ed68","type":"inject","z":"af357553.2f0528","name":"Trigger error","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":1400,"wires":[["e6ab54af.a7ca98"]]},{"id":"53e0f522.20534c","type":"function","z":"af357553.2f0528","name":"setInterval/clearInterval","func":"var timerId = context.get(\"timerId\") || 0;\n\nfunction start() {\n    if (timerId) stop();// clear the timer if it is already running\n    timerId = setInterval(function() {\n        node.warn(\"Attention\");\n        context.set(\"timerId\", timerId);\n}, 2000);}\n\nfunction stop() {\n    node.warn(\"stop\");\n    clearInterval(timerId);\n    context.set(\"timerId\", 0)\n}\n\nif(msg.payload && timerId === 0){start();}\nif(!msg.payload){stop();}\n\n// setTimeout(function() {\n//   stop();\n//   node.warn(\"off\");\n// }, 20000);\n\n","outputs":1,"noerr":0,"x":390,"y":1720,"wires":[[]]},{"id":"cf1c1c1b.3d0b7","type":"function","z":"8ef08a2b.a563a8","name":"Generate","func":"var v;\nvar values = [];\nvar states = [];\nvar hours = [];\nfunction pretty(num){\n    return num < 10 ? \"0\" + num : num;\n}\n\nfor(var i=0; i<24; i++){\n    v = parseFloat(((Math.random()*100)).toFixed(2));\n    values.push(v);\n    states.push(v > 80);\n    hours.push(pretty(i));\n}\n\nmsg.values = values;\nmsg.hours = hours;\nmsg.min = Math.min(...values);\nmsg.max = Math.max(...values);\nmsg.states = states;\nmsg.hour = new Date().getHours();\nmsg.unique = 1;\nmsg.shiftup = Math.floor(msg.max/10);\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":100,"wires":[["273fd283.e40efe"]]},{"id":"a9a65a82.2ee2c8","type":"inject","z":"8ef08a2b.a563a8","name":"","topic":"","payload":"","payloadType":"date","repeat":"4","crontab":"","once":true,"onceDelay":"","x":150,"y":100,"wires":[["cf1c1c1b.3d0b7"]]},{"id":"273fd283.e40efe","type":"ui_template","z":"8ef08a2b.a563a8","group":"e4cc180c.e22528","name":"Chart","order":0,"width":"6","height":"2","format":"<script>\nfunction adjustBar(bar,size,color){\n    $(bar).height(size+\"%\");\n    $(bar).css('background-color', color);\n}\n\n(function(scope) {\n    scope.$watch('msg', function(msg) {\n    if(msg == null){\n        return;\n    }\n    var total = msg.max - msg.min + msg.shiftup;\n    for (var i = 0; i < 24; i++) {\n        var p =  (msg.values[i] - (msg.min - msg.shiftup)) * 100 / total;\n        var green = (msg.hour == i) ? \"chartreuse\" : \"green\";\n        var grey = (msg.hour == i) ?  \"darkgrey\" : \"dimgrey\";\n        var c = (msg.states[i] == true) ? grey : green;\n        var b = \"#bar_\"+msg.unique+i;\n        adjustBar(b,p,c);\n    }\n  })\n})(scope);\n\n</script>\n\n<table layout=\"row\" layout-align=\"space-around center\">\n    <tr>\n        <td class=\"pillar\" ng-repeat=\"obj in msg.values track by $index\">\n            <div id=\"bar_{{msg.unique}}{{$index}}\" class=\"blocks\"></div>\n        </td>\n    </tr>\n    <tr>\n        <td ng-repeat=\"obj in msg.values track by $index\" class=\"stripe\"></td>\n    </tr>\n    <tr>\n        <td class=\"hours\" ng-repeat=\"obj in msg.hours track by $index\">{{obj}}</td>\n    </tr>\n</table>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":430,"y":100,"wires":[[]]},{"id":"7044714.340c59","type":"ui_template","z":"8ef08a2b.a563a8","group":"e4cc180c.e22528","name":"Style","order":0,"width":0,"height":0,"format":"<style>\n    .pillar {vertical-align:bottom; height:70px;}\n    .stripe {background-color:#121212; height:1px;}\n    .blocks {width:100%; height:0%}\n    .hours {text-align:center; font-size:50%; font-family:\"Arial Narrow\", Arial, sans-serif; }\n</style>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":430,"y":60,"wires":[[]]},{"id":"25a8fcb1.8bdc74","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":650,"y":1700,"wires":[["bf3c43ed.d47ce"]]},{"id":"6c5d472e.40f6a8","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":650,"y":1740,"wires":[["bf3c43ed.d47ce"]]},{"id":"bf3c43ed.d47ce","type":"function","z":"af357553.2f0528","name":"setInterval/clearInterval","func":"var timerId = 0;\n\nfunction start() {\nthis.timerId = setInterval(function() {\n  node.warn(\"Attention\");\n}, 2000);}\n\nfunction stop() {\n    node.warn(\"stop\");\n  clearInterval(this.timerId);}\n\nif(msg.payload && timerId === 0){start();}\nif(!msg.payload){stop();}\n\n// setTimeout(function() {\n//   stop();\n//   node.warn(\"off\");\n// }, 20000);\n\n","outputs":1,"noerr":0,"x":890,"y":1720,"wires":[[]]},{"id":"7746d61b.538218","type":"function","z":"af357553.2f0528","name":"flow keys","func":"// flow.set(\"foo\", \"bar\");\n// //msg.payload = flow.keys();\nmsg.payload = flow.get(flow.keys());\nnode.log(\"Something happened\");\nreturn msg;\n\n\n// var outputMsgs = [];\n// var words =  flow.get(flow.keys());\n// for (var w in words) {\n//     outputMsgs.push({payload:words[w]});\n// }\n// return [ outputMsgs ];","outputs":1,"noerr":0,"x":700,"y":1880,"wires":[["80024546.7b0f18"]]},{"id":"80024546.7b0f18","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":1880,"wires":[]},{"id":"bf629b98.5a6088","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":500,"y":1880,"wires":[["7746d61b.538218"]]},{"id":"de7e0aa6.834638","type":"function","z":"af357553.2f0528","name":"count in context","func":"// initialise the counter to 0 if it doesn't exist already\nvar count = context.get('count')||0;\ncount += 1;\n// store the value back\ncontext.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":1960,"wires":[["80024546.7b0f18","89eb4fbe.54a3a"]]},{"id":"c1b4709d.c6372","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":500,"y":1960,"wires":[["de7e0aa6.834638"]]},{"id":"44064b20.ffb5e4","type":"function","z":"af357553.2f0528","name":"context keys","func":"context.set(\"foo\", \"bar\");\ncontext.set(\"foo1\", \"bar1\");\nmsg.payload = context.keys();\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":2060,"wires":[["80024546.7b0f18"]]},{"id":"ced6389c.6e5ed8","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":480,"y":2060,"wires":[["44064b20.ffb5e4"]]},{"id":"1e78949b.6e38fb","type":"ui_switch","z":"af357553.2f0528","name":"","label":"switch","tooltip":"","group":"faa404cf.51c898","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"gate","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":290,"y":2200,"wires":[["2fa2d331.52580c"]]},{"id":"2fa2d331.52580c","type":"function","z":"af357553.2f0528","name":"control","func":"if (msg.topic === \"gate\") {\n    context.pass = (msg.payload) ? true : false;\n    return null;  // exit out early as it's just the control\n}\nif (context.pass) {\n    return msg; // if enabled pass msg\n}\nreturn null; // or drop it","outputs":1,"noerr":0,"x":478,"y":2220,"wires":[["3321fdff.8754d2"]]},{"id":"e3de73a4.247b6","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":302.5,"y":2262,"wires":[["2fa2d331.52580c"]]},{"id":"3321fdff.8754d2","type":"debug","z":"af357553.2f0528","name":"","active":true,"console":"false","complete":"payload","x":688.5,"y":2221,"wires":[]},{"id":"135ecf52.369b21","type":"debug","z":"954fa096.15be2","name":"Action","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1030,"y":260,"wires":[]},{"id":"e91f80a4.a6ea4","type":"ui_template","z":"954fa096.15be2","group":"13f378c3.149687","name":"Status","order":3,"width":"2","height":"2","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1050,"y":300,"wires":[[]]},{"id":"683c0125.922b9","type":"ui_template","z":"954fa096.15be2","group":"13f378c3.149687","name":"Enable/Disable","order":1,"width":"3","height":"1","format":"<md-button class=\"vibrate filled touched font rounded\" style=\"background-color:#333333\" ng-click=\"send({payload: msg.payload })\"> \n\n<svg  width=\"80px\" height=\"40px\" version=\"1.1\" viewBox=\"0 0 380 160\">\n <g id=\"Button_Long\">\n  \n  <rect fill=\"#333333\" width=\"300\" height=\"100\"/>\n  <g ng-style=\"{fill: (msg.payload || 0) ? 'lime' : 'red'}\">\n    <rect width=\"380\" height=\"160\" rx=\"80\" ry=\"80\"/>\n  </g>\n  <rect fill=\"#333333\" x=\"11\" y=\"10\" width=\"358\" height=\"140\" rx=\"90\" ry=\"90\"/>\n  <g ng-style=\"{fill: (msg.payload || 0) ? 'lime' : 'red'}\">\n      \n    <text x=\"200\" y=\"95\" style=\"text-anchor:middle\"  font-weight=\"bold\" font-size=\"50\" font-family=\"Arial\">{{(msg.payload||0)? \"ENABLED \" : \"DISABLED\"}} </text>\n    </g>\n  </g>\n</svg>\n</md-button>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":150,"y":270,"wires":[["62dc7ff2.5eb4"]]},{"id":"62dc7ff2.5eb4","type":"function","z":"954fa096.15be2","name":"Function","func":"msg.payload =!msg.payload; \nreturn msg;\n","outputs":1,"noerr":0,"x":140,"y":320,"wires":[["683c0125.922b9","a8f7211f.61822","6c863fba.36241"]]},{"id":"fba3030a.4fcb8","type":"inject","z":"954fa096.15be2","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":"2","x":250,"y":200,"wires":[["683c0125.922b9"]]},{"id":"4bf431a5.ca0f8","type":"trigger","z":"954fa096.15be2","op1":"","op2":"false","op1type":"nul","op2type":"bool","duration":"5","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":120,"y":480,"wires":[["683c0125.922b9"]]},{"id":"6c863fba.36241","type":"switch","z":"954fa096.15be2","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":130,"y":360,"wires":[["4bf431a5.ca0f8"]]},{"id":"a8f7211f.61822","type":"switch","z":"954fa096.15be2","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":280,"wires":[["cdef5c13.6e51e"]]},{"id":"cdef5c13.6e51e","type":"trigger","z":"954fa096.15be2","op1":"GO","op2":"STOP","op1type":"str","op2type":"str","duration":"3","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":320,"y":360,"wires":[["139b14ed.f31b9b","95840e98.4ace9"]]},{"id":"139b14ed.f31b9b","type":"change","z":"954fa096.15be2","name":"CTL","rules":[{"t":"set","p":"topic","pt":"msg","to":"CONTROL","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":340,"wires":[["1759666f.c0b05a","65d74ced.68a224"]]},{"id":"95840e98.4ace9","type":"switch","z":"954fa096.15be2","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"GO","vt":"str"},{"t":"eq","v":"STOP","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":440,"wires":[["4d22ae3c.e74c5"],["c6bcbe81.8112e"]]},{"id":"c6bcbe81.8112e","type":"change","z":"954fa096.15be2","name":"Colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"red","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":420,"wires":[["d1ecc8b5.134ed8","24dc6d70.ffaee2"]]},{"id":"4d22ae3c.e74c5","type":"change","z":"954fa096.15be2","name":"Colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"lime","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":380,"wires":[["d1ecc8b5.134ed8","24dc6d70.ffaee2"]]},{"id":"d1ecc8b5.134ed8","type":"ui_button","z":"954fa096.15be2","name":"","group":"13f378c3.149687","order":2,"width":"2","height":"1","passthru":false,"label":"OFF","tooltip":"","color":"black","bgcolor":"{{msg.colour}}","icon":"","payload":"DEACTIVATE","payloadType":"str","topic":"RESET","x":630,"y":460,"wires":[["4e91fe4.ae984","1759666f.c0b05a"]]},{"id":"24dc6d70.ffaee2","type":"ui_button","z":"954fa096.15be2","name":"","group":"13f378c3.149687","order":2,"width":"2","height":"1","passthru":false,"label":"ON","tooltip":"","color":"black","bgcolor":"{{msg.colour}}","icon":"","payload":"ACTIVATE","payloadType":"str","topic":"RESET","x":630,"y":560,"wires":[["4e91fe4.ae984","1759666f.c0b05a"]]},{"id":"4e91fe4.ae984","type":"debug","z":"954fa096.15be2","name":"De/Activate","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":950,"y":600,"wires":[]},{"id":"1759666f.c0b05a","type":"function","z":"954fa096.15be2","name":"WIP","func":"//  2019 06 02 15:00\n//  block = 1 - allow.\n//          0 - block.\n//\n//  topics:     CONTROL  GO/!GO   Allow editing of state\n//              SETUP   Messages sent for states of \"off\" and \"on\" condition.\nvar msg1;\nvar msg2;\nvar off_message;        //  Not needed?\nvar on_message;         //  Not needed?\nif (msg.topic == \"CONTROL\")\n{\n    if (msg.payload == \"GO\")\n    {\n        //\n        //  Allow things to pass.\n        //\n        context.set(\"BLOCK\",1);\n        node.status({fill: \"green\",text:\"Not Blocking\"});\n    } else\n    {\n        //\n        //  Don't allow things to pass.\n        //\n        context.set(\"BLOCK\",0);\n        node.status({fill: \"red\",text:\"Blocking\"});\n    }\n}\nif (msg.topic == \"SETUP\")\n{\n    //\n    //  Set up messages for \"on\" and \"off\" conditions to be sent.\n    //\n    //node.warn(\"Setting On/Off messages\");\n    //node.warn(msg.on_message);\n    //node.warn(msg.off_message);\n    context.set(\"ON_MESSAGE\", msg.on_message);\n    context.set(\"OFF_MESSAGE\",msg.off_message);\n    return;\n}\nvar block = context.get(\"BLOCK\") || 0;\nif (block == 1)\n{\n    //\n//    node.warn(\"Passing messages\");\n    if (msg.payload == \"ACTIVATE\")\n    {\n        //\n        //  All good.\n        //\n        //msg = context.get(\"ON_MESSAGE\");\n        msg = {payload: \"ENABLED\"};\n        msg1 = {payload: '<font color = \"lime\" <i class=\"fa fa-bullseye fa-2x\"></i>'};\n        msg2 = {colour:\"red\"};\n        return [msg, msg1,msg2];\n    } else\n    if (msg.payload == \"DEACTIVATE\")\n    {\n        //\n        //  All good\n        //\n        //msg = context.get(\"OFF_MESSAGE\");\n        msg = {payload: \"DISABLED\"};\n        msg1 = {payload: '<font color = \"red\" <i class=\"fa fa-bullseye fa-2x\"></i>'};\n        msg2 = {colour:\"red\"};\n        return [msg, msg1,msg2];\n    }\n}","outputs":3,"noerr":0,"x":810,"y":340,"wires":[["135ecf52.369b21"],["e91f80a4.a6ea4"],["24dc6d70.ffaee2","d1ecc8b5.134ed8","a21f68f1.71c028"]]},{"id":"65d74ced.68a224","type":"debug","z":"954fa096.15be2","name":"Go/Stop","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":620,"y":300,"wires":[]},{"id":"f279b501.fcd3f8","type":"link out","z":"954fa096.15be2","name":"","links":["28ef5f7f.5aeb9"],"x":875,"y":140,"wires":[]},{"id":"28ef5f7f.5aeb9","type":"link in","z":"954fa096.15be2","name":"","links":["f279b501.fcd3f8"],"x":215,"y":100,"wires":[["683c0125.922b9"]]},{"id":"a21f68f1.71c028","type":"change","z":"954fa096.15be2","name":"Colour","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":520,"wires":[["f279b501.fcd3f8"]]},{"id":"d4116abd.ee1f58","type":"comment","z":"954fa096.15be2","name":"Enable button press","info":"","x":470,"y":190,"wires":[]},{"id":"6d623c37.6aa854","type":"inject","z":"954fa096.15be2","name":"","topic":"","payload":"blah","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"2","x":470,"y":240,"wires":[["c6bcbe81.8112e","c3779af4.45aa18"]]},{"id":"c3779af4.45aa18","type":"change","z":"954fa096.15be2","name":"Setup","rules":[{"t":"set","p":"topic","pt":"msg","to":"SETUP","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"null","tot":"jsonata"},{"t":"set","p":"on_message","pt":"msg","to":"On Message","tot":"str"},{"t":"set","p":"off_message","pt":"msg","to":"Off Message","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":240,"wires":[["1759666f.c0b05a"]]},{"id":"709bab8b.622794","type":"function","z":"af357553.2f0528","name":"","func":"msg.values = \"values\";\nmsg.hours = \"hours\";\nmsg.min = 1;\nmsg.max = 10;\nmsg.states = \"states\";\n//msg.hour = new Date().getHours();\nmsg.unique = 1;\nmsg.shiftup = Math.floor(msg.max/10);\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":2380,"wires":[["a4a79052.d9dd8"]]},{"id":"9b533f96.32969","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":2380,"wires":[["709bab8b.622794"]]},{"id":"a4a79052.d9dd8","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":2380,"wires":[]},{"id":"891a673e.b4cb18","type":"inject","z":"af357553.2f0528","name":"","topic":"","payload":"5","payloadType":"str","repeat":"","crontab":"","once":false,"x":390,"y":2560,"wires":[["11d2cb8d.8dfd24"]]},{"id":"11d2cb8d.8dfd24","type":"function","z":"af357553.2f0528","name":"BLINK n","func":"var o = false;\nfor (var i=0; i<(msg.payload*2); i++) {\n    node.send( {payload:+(o=!o)} )\n}\n\nreturn null;","outputs":1,"noerr":0,"x":547,"y":2592,"wires":[["80011832.13f0a8"]]},{"id":"80011832.13f0a8","type":"delay","z":"af357553.2f0528","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":678,"y":2541,"wires":[["bcd2ba5a.456f98"]]},{"id":"bcd2ba5a.456f98","type":"debug","z":"af357553.2f0528","name":"","active":true,"console":"false","complete":"false","x":830,"y":2596,"wires":[]},{"id":"89eb4fbe.54a3a","type":"link out","z":"af357553.2f0528","name":"","links":["69be5f4e.fbead"],"x":940,"y":2040,"wires":[]},{"id":"69be5f4e.fbead","type":"link in","z":"8ef08a2b.a563a8","name":"","links":["89eb4fbe.54a3a"],"x":195,"y":180,"wires":[["22d1bc08.46a554"]]},{"id":"22d1bc08.46a554","type":"debug","z":"8ef08a2b.a563a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":355,"y":180,"wires":[]},{"id":"2807cebd.38be02","type":"catch","z":"af357553.2f0528","name":"","scope":["22f5bdb7.ae4af2"],"uncaught":false,"x":150,"y":1520,"wires":[["deac528c.5ea54"]]},{"id":"deac528c.5ea54","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"error.message","targetType":"msg","x":350,"y":1520,"wires":[]},{"id":"273133a4.0e78ac","type":"inject","z":"af357553.2f0528","name":"Trigger error","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":1580,"wires":[["22f5bdb7.ae4af2"]]},{"id":"22f5bdb7.ae4af2","type":"http request","z":"af357553.2f0528","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"qqqqqq.gg","tls":"","proxy":"","authType":"basic","x":310,"y":1580,"wires":[[]]},{"id":"5de6fd.f9e9d904","type":"trigger","z":"af357553.2f0528","op1":"","op2":"Датчик","op1type":"nul","op2type":"str","duration":"500","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":840,"y":580,"wires":[["2f5cf78e.0ecaa8"]]},{"id":"c0b77985.a306b8","type":"inject","z":"af357553.2f0528","name":"Датчик","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":650,"y":580,"wires":[["5de6fd.f9e9d904"]]},{"id":"2f5cf78e.0ecaa8","type":"debug","z":"af357553.2f0528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1050,"y":580,"wires":[]},{"id":"8a38e14f.4644e","type":"file in","z":"dfb681c3.814b5","name":"subtit.txt","filename":"C:\\Users\\Домашний\\Documents\\subtitr.txt","format":"utf8","chunk":false,"sendError":false,"encoding":"cp1251","x":320,"y":780,"wires":[["cd00ea53.dd0b18"]]},{"id":"cd00ea53.dd0b18","type":"split","z":"dfb681c3.814b5","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":470,"y":860,"wires":[["f701d1.49825e3"]]},{"id":"b65249f0.b9ba18","type":"debug","z":"dfb681c3.814b5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":960,"y":1000,"wires":[]},{"id":"4de02a85.aa8cd4","type":"inject","z":"dfb681c3.814b5","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":320,"y":660,"wires":[["54366116.ddba7"]]},{"id":"c8428cd4.96935","type":"file","z":"dfb681c3.814b5","name":"subtitout.txt","filename":"C:\\Users\\Домашний\\Documents\\subtitoutr.txt","appendNewline":false,"createDir":false,"overwriteFile":"false","encoding":"utf8","x":1000,"y":920,"wires":[["b65249f0.b9ba18"]]},{"id":"f701d1.49825e3","type":"switch","z":"dfb681c3.814b5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"^(\\d{2}:){2}\\d{2}","vt":"str","case":false},{"t":"regex","v":"^\\d{1,4}\\s","vt":"str","case":false},{"t":"regex","v":"^\\s","vt":"str","case":false},{"t":"else"}],"checkall":"true","repair":false,"outputs":4,"x":640,"y":900,"wires":[[],[],[],["d6fa82ea.38e11"]]},{"id":"d6fa82ea.38e11","type":"switch","z":"dfb681c3.814b5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":820,"y":920,"wires":[["c8428cd4.96935"]]},{"id":"54366116.ddba7","type":"file in","z":"dfb681c3.814b5","name":"read","filename":"C:\\Users\\Домашний\\Documents\\subtitoutr.txt","format":"utf8","chunk":false,"sendError":true,"encoding":"none","x":150,"y":720,"wires":[["5a840e5a.c6e56"]]},{"id":"5a840e5a.c6e56","type":"switch","z":"dfb681c3.814b5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":310,"y":720,"wires":[["d9334084.fba29"]]},{"id":"d9334084.fba29","type":"file","z":"dfb681c3.814b5","name":"del","filename":"C:\\Users\\Домашний\\Documents\\subtitoutr.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","encoding":"none","x":470,"y":720,"wires":[["8a38e14f.4644e"]]},{"id":"3e470e08.551302","type":"catch","z":"dfb681c3.814b5","name":"","scope":["54366116.ddba7"],"uncaught":false,"x":210,"y":860,"wires":[["8a38e14f.4644e"]]},{"id":"27a1680d.bcffc8","type":"inject","z":"dfb681c3.814b5","name":"URL every 15 min","topic":"Кунгуров","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"30","x":130,"y":220,"wires":[["623c997f.18c338","73ceb3be.81b2ec","b2ec1e76.7829b"]]},{"id":"3a17cb24.3357e4","type":"nbrowser","z":"dfb681c3.814b5","name":"Кунгуров","methods":[{"name":"gotoURL","func":"goto","params":[{"type":"msg","value":"payload","typeDefault":"str"}]}],"prop":"nbrowser","propout":"site","object":"msg","objectout":"flow","close":true,"show":false,"ssl":true,"outputs":0,"x":420,"y":60,"wires":[]},{"id":"bb60cd4d.f1609","type":"html","z":"dfb681c3.814b5","name":"Select all post","property":"payload","outproperty":"payload","tag":".entry","ret":"attr","as":"multi","x":640,"y":220,"wires":[["377e3ecd.8b5d82"]]},{"id":"ea7fb6d6.276098","type":"change","z":"dfb681c3.814b5","name":"content from site","rules":[{"t":"set","p":"payload","pt":"msg","to":"site","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":300,"wires":[["bb60cd4d.f1609"]]},{"id":"377e3ecd.8b5d82","type":"switch","z":"dfb681c3.814b5","name":"first post select","property":"payload","propertyType":"msg","rules":[{"t":"head","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":640,"y":140,"wires":[["4a91b023.805d7"]]},{"id":"623c997f.18c338","type":"delay","z":"dfb681c3.814b5","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":420,"y":260,"wires":[["ea7fb6d6.276098"]]},{"id":"2ccb4ef3.e6bca2","type":"pushbullet","z":"dfb681c3.814b5","config":"8c00412c.036b5","pushtype":"","title":"Node-Red","chan":"","name":"Node-Red notification","x":980,"y":380,"wires":[]},{"id":"639e1a5b.703724","type":"inject","z":"dfb681c3.814b5","name":"","topic":"","payload":"test pushbullet","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":670,"y":380,"wires":[["2ccb4ef3.e6bca2"]]},{"id":"501d5e52.a16a3","type":"catch","z":"dfb681c3.814b5","name":"site","scope":["377e3ecd.8b5d82","3a17cb24.3357e4"],"uncaught":false,"x":110,"y":60,"wires":[["1bfc3b11.c7a905"]]},{"id":"1bfc3b11.c7a905","type":"delay","z":"dfb681c3.814b5","name":"repit","pauseType":"rate","timeout":"5","timeoutUnits":"minutes","rate":"3","nbRateUnits":"10","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":90,"y":140,"wires":[["623c997f.18c338","d1e36f7e.011e2"]]},{"id":"fcda7b6e.799d38","type":"inject","z":"dfb681c3.814b5","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":420,"y":340,"wires":[["ea7fb6d6.276098"]]},{"id":"51de216e.9e475","type":"change","z":"dfb681c3.814b5","name":"save post","rules":[{"t":"set","p":"#:(file)::post","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":300,"wires":[["2ccb4ef3.e6bca2"]]},{"id":"fcea04a3.df2658","type":"switch","z":"dfb681c3.814b5","name":"compare post","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"#:(file)::post","vt":"flow"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":960,"y":220,"wires":[[],["51de216e.9e475"]]},{"id":"73ceb3be.81b2ec","type":"switch","z":"dfb681c3.814b5","name":"post init","property":"#:(file)::post","propertyType":"flow","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":200,"y":300,"wires":[[],["989c8a2f.d858e8"]]},{"id":"989c8a2f.d858e8","type":"change","z":"dfb681c3.814b5","name":"","rules":[{"t":"set","p":"#:(file)::post","pt":"flow","to":"\" \"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":210,"y":380,"wires":[[]]},{"id":"c3686050.b0f03","type":"inject","z":"dfb681c3.814b5","name":"init post","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":460,"wires":[["989c8a2f.d858e8"]]},{"id":"4a91b023.805d7","type":"change","z":"dfb681c3.814b5","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":140,"wires":[["fcea04a3.df2658"]]},{"id":"b2ec1e76.7829b","type":"function","z":"dfb681c3.814b5","name":"URL","func":"msg.payload = \"https://kungurov.livejournal.com/\"\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":140,"wires":[["3a17cb24.3357e4"]]},{"id":"d1e36f7e.011e2","type":"delay","z":"dfb681c3.814b5","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":280,"y":140,"wires":[["b2ec1e76.7829b"]]},{"id":"aa2132af.0f515","type":"inject","z":"dfb681c3.814b5","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":680,"y":640,"wires":[["ef5282b9.ef9a"]]},{"id":"199c9f89.602a2","type":"debug","z":"dfb681c3.814b5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1030,"y":640,"wires":[]},{"id":"ef5282b9.ef9a","type":"function","z":"dfb681c3.814b5","name":"obj to array","func":"const obj = {one: 1, two: 2, three: 3};\nmsg.payload = (Object.entries(obj));    \nreturn msg;","outputs":1,"noerr":0,"x":850,"y":640,"wires":[["199c9f89.602a2"]]},{"id":"4d7cb4a0.89ba6c","type":"function","z":"dfb681c3.814b5","name":"array","func":"const array = [['one', 1], ['two', 2], ['three', 3]];\nmsg.payload = array;\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":520,"wires":[["d085da2d.b16578","ba633e66.a9001"]]},{"id":"d085da2d.b16578","type":"debug","z":"dfb681c3.814b5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1030,"y":520,"wires":[]},{"id":"e903a22f.4d5f5","type":"inject","z":"dfb681c3.814b5","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":660,"y":520,"wires":[["4d7cb4a0.89ba6c"]]},{"id":"ba633e66.a9001","type":"function","z":"dfb681c3.814b5","name":"array to obj","func":"msg.payload = Object.fromEntries(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":580,"wires":[["e3878a85.672668","ef5282b9.ef9a"]]},{"id":"e3878a85.672668","type":"debug","z":"dfb681c3.814b5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1030,"y":580,"wires":[]},{"id":"edb3b5ec.748168","type":"debug","z":"dfb681c3.814b5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":670,"y":1340,"wires":[]},{"id":"741502f4.9cd7dc","type":"darksky","z":"dfb681c3.814b5","darksky":"d837e845.a0bc08","name":"","lon":"50.192255","lat":"53.248253","date":"","time":"","mode":"message","lang":"ru","units":"si","x":500,"y":1340,"wires":[["edb3b5ec.748168","f23ff1a5.b3c4"]]},{"id":"4b76f384.ab4ebc","type":"inject","z":"dfb681c3.814b5","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":320,"y":1340,"wires":[["741502f4.9cd7dc"]]},{"id":"f23ff1a5.b3c4","type":"function","z":"dfb681c3.814b5","name":"sunrise","func":"function getYoutubeLikeToDisplay(millisec) {\n    var seconds = (millisec / 100000).toFixed(0);\n    var minutes = Math.floor(seconds / 60);\n    var hours = \"\";\n    if (minutes > 59) {\n        hours = Math.floor(minutes / 60);\n        hours = (hours >= 10) ? hours : \"0\" + hours;\n        minutes = minutes - (hours * 60);\n        minutes = (minutes >= 10) ? minutes : \"0\" + minutes;\n    }\n\n    seconds = Math.floor(seconds % 60);\n    seconds = (seconds >= 10) ? seconds : \"0\" + seconds;\n    if (hours !== \"\") {\n        return hours + \":\" + minutes + \":\" + seconds;\n    }\n    return minutes + \":\" + seconds;\n}\nvar sunrise = getYoutubeLikeToDisplay(msg.payload.sunrise);\nmsg.payload = sunrise;\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":1500,"wires":[["58872589.cc492c"]]},{"id":"58872589.cc492c","type":"debug","z":"dfb681c3.814b5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":780,"y":1500,"wires":[]},{"id":"34785986.504006","type":"switch","z":"edd42ef7.16d9c","name":"","property":"payload.type","propertyType":"msg","rules":[{"t":"cont","v":"photo","vt":"str"},{"t":"cont","v":"message","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":750,"y":340,"wires":[["1c869274.a9147e"],["cf01f827.f3b908"],["356e11ec.a7aa4e"]]},{"id":"bceb6ff5.1c06c","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":220,"wires":[["adabe97a.c40058"]]},{"id":"55de2e6f.e30b6","type":"function","z":"edd42ef7.16d9c","name":"send message","func":"msg.payload = {\n    \"chatId\": 123456789,\n    \"messageId\": 2,\n    \"type\": \"message\",\n    \"content\": \"какой то текст\"\n}\n/* type can be one of the following\nphoto\naudio\nvideo\nsticker\nvoice\ndocument\n*/\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":300,"wires":[["fc5e4e8.1756bb","34785986.504006"]]},{"id":"e50214db.b12558","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":300,"wires":[["55de2e6f.e30b6"]]},{"id":"1c869274.a9147e","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":340,"wires":[]},{"id":"cf01f827.f3b908","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":380,"wires":[]},{"id":"356e11ec.a7aa4e","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":420,"wires":[]},{"id":"f673944f.608848","type":"function","z":"edd42ef7.16d9c","name":"send audio","func":"msg.payload = {\n    \"chatId\": 123456789,\n    \"messageId\": 3,\n    \"type\": \"audio\",\n    \"content\": \"audio.mp3\"\n}\n/* type can be one of the following\nphoto\naudio\nvideo\nsticker\nvoice\ndocument\n*/\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":360,"wires":[["fc5e4e8.1756bb","34785986.504006"]]},{"id":"9182b521.e6f788","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":360,"wires":[["f673944f.608848"]]},{"id":"af7a93b2.8f3cf","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.content","targetType":"msg","x":1000,"y":220,"wires":[]},{"id":"c616833f.8e07f","type":"change","z":"edd42ef7.16d9c","name":"content","rules":[{"t":"set","p":"payload","pt":"msg","to":"telega.content","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":60,"wires":[["7c298b10.d521b4"]]},{"id":"fc5e4e8.1756bb","type":"function","z":"edd42ef7.16d9c","name":"switch","func":"if (msg.payload.type === 'photo') {\n    return [msg, null, null];\n} else if (msg.payload.type === 'message') {\n    return [null, msg, null];\n} else \nreturn [null, null, msg];","outputs":3,"noerr":0,"x":750,"y":280,"wires":[["af7a93b2.8f3cf"],["6c85708b.09034"],["42d7282.fe5a4d8"]]},{"id":"3cdb72e9.dfa99e","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":120,"wires":[]},{"id":"6c85708b.09034","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.content","targetType":"msg","x":1000,"y":260,"wires":[]},{"id":"42d7282.fe5a4d8","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.content","targetType":"msg","x":1000,"y":300,"wires":[]},{"id":"337303cf.831c4c","type":"function","z":"edd42ef7.16d9c","name":"add field to flow.obj","func":"var myCount = flow.get(\"telega\");\nmyCount.content = \"New Content\";\nmyCount.newfield = \"new field\";\nflow.set(\"telega\", myCount);\nmsg.payload = flow.get(\"telega\");\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":180,"wires":[["5787d33b.99d25c","3b84bf24.80dc3"]]},{"id":"7c298b10.d521b4","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":60,"wires":[]},{"id":"5787d33b.99d25c","type":"function","z":"edd42ef7.16d9c","name":"Object assign with flow.obj","func":"var myCount = flow.get(\"telega\");\nconst newObj = Object.create(null);\n//const newObj = new Object({});\nnewObj.newDateField = new Date().toLocaleString('en-US', { timeZone: \"Etc/GMT-4\" });\nObject.assign(myCount, newObj)\nflow.set(\"telega\", myCount);\nmsg.payload = flow.get(\"telega\");\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":120,"wires":[["3cdb72e9.dfa99e"]]},{"id":"3b84bf24.80dc3","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":180,"wires":[]},{"id":"64ea268f.8a70c8","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"one","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":480,"wires":[["48c3b90f.ea6238"]]},{"id":"da80157e.62a308","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"three","payload":"{\"data1\":123,\"data2\":567}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":640,"wires":[["8c017dad.64644","ca0bf80e.b6ff58","ecd4fbfa.f67d28","b055297f.60e0e8"]]},{"id":"9212e58c.e15658","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"two","payload":"какое то описание","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":560,"wires":[["8c017dad.64644"]]},{"id":"8c017dad.64644","type":"function","z":"edd42ef7.16d9c","name":"Set field to flow.obj from msg","func":"var myCount = flow.get(\"telega\");\nmyCount[msg.topic] = msg.payload;\nflow.set(\"telega\", myCount);\nmsg.payload = flow.get(\"telega\");\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":480,"wires":[["b01c5ddf.87c7b"]]},{"id":"b01c5ddf.87c7b","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":480,"wires":[]},{"id":"48c3b90f.ea6238","type":"function","z":"edd42ef7.16d9c","name":"convert date","func":"const date = new Date();\ndate.setTime(msg.payload);\nmsg.payload = date.toLocaleString('en-US', { timeZone: \"Etc/GMT-4\" });\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":480,"wires":[["8c017dad.64644"]]},{"id":"ca0bf80e.b6ff58","type":"function","z":"edd42ef7.16d9c","name":"obj to array","func":"const obj = msg.payload;\nmsg.payload = Object.entries(obj);    \nreturn msg;","outputs":1,"noerr":0,"x":650,"y":560,"wires":[["b03e4d75.e3174","cf4b69a9.3fd868"]]},{"id":"b03e4d75.e3174","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":560,"wires":[]},{"id":"cf4b69a9.3fd868","type":"function","z":"edd42ef7.16d9c","name":"new array from data","func":"const msg1 = {payload: msg.payload.map(([,item]) => item)};\nconst msg2 = {payload: msg.payload.map(([key]) => key)};\nreturn [msg1, msg2];","outputs":2,"noerr":0,"x":680,"y":620,"wires":[["5394cc97.9435d4"],["2a68fbc0.8cb0f4"]]},{"id":"5394cc97.9435d4","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":600,"wires":[]},{"id":"bf6534c2.f7ec88","type":"function","z":"edd42ef7.16d9c","name":"sum*2","func":"const transform = (item) => {\n    return item * 2;\n}\n\nconst obj = msg.payload;\nmsg.payload = [...obj].map(transform).reduce((acc, item) => acc + item, 0);    \nreturn msg;\n\n","outputs":1,"noerr":0,"x":630,"y":780,"wires":[["113dd8b6.6ece87"]]},{"id":"113dd8b6.6ece87","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":780,"wires":[]},{"id":"429c271e.1ac4b8","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"12345","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":780,"wires":[["bf6534c2.f7ec88","ce4245b0.419c58","b055297f.60e0e8"]]},{"id":"adabe97a.c40058","type":"function","z":"edd42ef7.16d9c","name":"create obj (send picture)","func":"msg.payload = {\n    \"chatId\": 123456789,\n    \"messageId\": 1,\n    \"type\": \"photo\",\n    \"content\": \"foo.jpeg\"\n}\n/* type can be one of the following\nphoto\naudio\nvideo\nsticker\nvoice\ndocument\n*/\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":220,"wires":[["cde01bd1.a6fbc8","fc5e4e8.1756bb","34785986.504006"]]},{"id":"cde01bd1.a6fbc8","type":"change","z":"edd42ef7.16d9c","name":"set flow.obj","rules":[{"t":"set","p":"telega","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":60,"wires":[["c616833f.8e07f","337303cf.831c4c"]]},{"id":"aec4103.c1de6f","type":"function","z":"edd42ef7.16d9c","name":"2 Object create","func":"const newObj1 = Object.create(null);\nconst newObj2 = new Object({});\nnewObj1.newDateField1 = new Date().toLocaleString('en-US', { timeZone: \"Etc/GMT-4\" });\nnewObj2.newDateField2 = new Date().toLocaleString('en-US', { timeZone: \"Etc/GMT-4\" });\nconst msg1 = { payload: newObj1 };\nconst msg2 = { payload: newObj2 };\nreturn [msg1, msg2];","outputs":2,"noerr":0,"x":660,"y":860,"wires":[["442508ba.fe8438"],["1ef19a4f.29dea6"]]},{"id":"f021c256.aff6d","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":860,"wires":[["aec4103.c1de6f"]]},{"id":"442508ba.fe8438","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":820,"wires":[]},{"id":"1ef19a4f.29dea6","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":860,"wires":[]},{"id":"2a68fbc0.8cb0f4","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":640,"wires":[]},{"id":"ce4245b0.419c58","type":"function","z":"edd42ef7.16d9c","name":"length","func":"const newMsg = { payload: msg.payload.length };\nreturn [msg, newMsg];","outputs":2,"noerr":0,"x":630,"y":820,"wires":[["442508ba.fe8438"],["1ef19a4f.29dea6"]]},{"id":"143f26cf.e25839","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":390,"y":1020,"wires":[["78ebacb3.859124"]]},{"id":"dc50d74.44de328","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":1040,"wires":[]},{"id":"78ebacb3.859124","type":"switch","z":"edd42ef7.16d9c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":1040,"wires":[["dc50d74.44de328"],["dc50d74.44de328"]]},{"id":"6d6b1c1b.9e6644","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":390,"y":1060,"wires":[["78ebacb3.859124"]]},{"id":"877593a5.4d66a","type":"change","z":"edd42ef7.16d9c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.state","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":1160,"wires":[["4529c171.37a21"]]},{"id":"4529c171.37a21","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":950,"y":1160,"wires":[]},{"id":"adc363ba.78488","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"{\"state\":false}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":590,"y":1220,"wires":[["877593a5.4d66a","4529c171.37a21"]]},{"id":"bd56279f.8b6928","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"{\"state\":true}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":590,"y":1100,"wires":[["4529c171.37a21","877593a5.4d66a"]]},{"id":"b98c7ba9.4b36a8","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":1300,"wires":[["97181ea9.777f"]]},{"id":"d26fd132.b2922","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":1300,"wires":[]},{"id":"97181ea9.777f","type":"function","z":"edd42ef7.16d9c","name":"for","func":"for(let i=0; i<10; i++) {\n    node.send({payload:i});\n}\n \n    ","outputs":1,"noerr":0,"x":460,"y":1300,"wires":[["d26fd132.b2922"]]},{"id":"7c942574.26c1fc","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":1440,"wires":[["9689a147.50cd9","c8688f07.c192f"]]},{"id":"688f9b49.bcc9a4","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":1500,"wires":[["9689a147.50cd9","c8688f07.c192f"]]},{"id":"72523555.371b3c","type":"debug","z":"edd42ef7.16d9c","name":"результат","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":980,"y":1560,"wires":[]},{"id":"9689a147.50cd9","type":"function","z":"edd42ef7.16d9c","name":"x = !x (0,1)","func":"if ((typeof msg.payload === 'number') && (msg.payload === 0 || msg.payload === 1 )) {\n    msg.payload = +!msg.payload\n    return [msg, null]\n} else {\n    msg.payload = 'Ошибка данных';\n    return [null, msg]\n}","outputs":2,"noerr":0,"x":810,"y":1660,"wires":[["72523555.371b3c"],["d6344068.b58c5"]]},{"id":"3d97cfd5.7d8de","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":450,"y":1800,"wires":[["9689a147.50cd9","c8688f07.c192f"]]},{"id":"7799c837.7b5f18","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":450,"y":1740,"wires":[["9689a147.50cd9","c8688f07.c192f"]]},{"id":"8c170156.3a7d7","type":"inject","z":"edd42ef7.16d9c","name":"String 0","topic":"","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":450,"y":1860,"wires":[["9689a147.50cd9","c8688f07.c192f"]]},{"id":"d6344068.b58c5","type":"debug","z":"edd42ef7.16d9c","name":"ошибка","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1000,"y":1680,"wires":[]},{"id":"1ec06711.12afd9","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"2","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":450,"y":1680,"wires":[["9689a147.50cd9","c8688f07.c192f"]]},{"id":"cd38e67b.e373d8","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":440,"y":1620,"wires":[["9689a147.50cd9","c8688f07.c192f"]]},{"id":"6827e0d4.6e023","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"1.001","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":450,"y":1920,"wires":[["9689a147.50cd9","c8688f07.c192f"]]},{"id":"5f368809.501f98","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"1.00","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":1560,"wires":[["9689a147.50cd9","c8688f07.c192f"]]},{"id":"c8688f07.c192f","type":"function","z":"edd42ef7.16d9c","name":"if","func":"if (msg.payload) {msg.payload=0;}\nelse {msg.payload=1;}\n\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":1540,"wires":[["72523555.371b3c"]]},{"id":"ecd4fbfa.f67d28","type":"split","z":"edd42ef7.16d9c","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":630,"y":680,"wires":[["6cb8ab31.4bfa34"]]},{"id":"6cb8ab31.4bfa34","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":680,"wires":[]},{"id":"b055297f.60e0e8","type":"function","z":"edd42ef7.16d9c","name":"","func":"msg.payload = [...msg.payload];\n//msg.payload = msg.payload.split(', ')\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":720,"wires":[["13b57fe1.0c8fa"]]},{"id":"13b57fe1.0c8fa","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":720,"wires":[]},{"id":"7a5fc770.0fe678","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"{\"obj1\":{\"data1\":111,\"data2\":222},\"obj2\":{\"data3\":333,\"data4\":444}}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":610,"y":1960,"wires":[["3baf5af2.166e46","1c69fd2f.150eb3"]]},{"id":"3baf5af2.166e46","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1010,"y":1820,"wires":[]},{"id":"1c69fd2f.150eb3","type":"split","z":"edd42ef7.16d9c","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":750,"y":2040,"wires":[["d0334065.46bd4","57b3d745.d9e8f8"]]},{"id":"d0334065.46bd4","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1010,"y":1940,"wires":[]},{"id":"57b3d745.d9e8f8","type":"split","z":"edd42ef7.16d9c","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":2140,"wires":[["6dbc343e.c2379c"]]},{"id":"6dbc343e.c2379c","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1010,"y":2060,"wires":[]},{"id":"581eaa80.ba1924","type":"function","z":"edd42ef7.16d9c","name":"","func":"var a = 0.004790;\nvar b = 23;\nvar c = -37;\nvar d = 90;\nvar e = 70;\nvar f = 0.3;\nvar g = msg.payload;\n\nvar h = (b-g) / (b-c);\n//msg.payload = h;\nvar t = Math.pow(b+0.5*(d-e)*h+0.5*(d+e-2*d)*h, 1/(1+f));\nmsg.payload = t;\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":2320,"wires":[["8fc401fc.4beff"]]},{"id":"8fc401fc.4beff","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1000,"y":2320,"wires":[]},{"id":"1e3e2295.170ded","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"24.19","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":550,"y":2320,"wires":[["581eaa80.ba1924"]]},{"id":"8d7ee637.a31ad8","type":"inject","z":"edd42ef7.16d9c","name":"decrement","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":2220,"wires":[["d75f81df.113cd"]]},{"id":"9c79cdab.1c619","type":"inject","z":"edd42ef7.16d9c","name":"increment","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":2180,"wires":[["5bce7a34.9ef7d4"]]},{"id":"de4af59e.bd6248","type":"inject","z":"edd42ef7.16d9c","name":"reset","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":130,"y":2260,"wires":[["63e5a9cd.5ee3b8"]]},{"id":"5bce7a34.9ef7d4","type":"function","z":"edd42ef7.16d9c","name":"msg object","func":"msg.increment = 2;\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":2180,"wires":[["805bf66a.42ac28"]]},{"id":"63e5a9cd.5ee3b8","type":"function","z":"edd42ef7.16d9c","name":"msg object","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":2260,"wires":[["805bf66a.42ac28"]]},{"id":"d75f81df.113cd","type":"function","z":"edd42ef7.16d9c","name":"msg object","func":"msg.decrement = 1;\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":2220,"wires":[["805bf66a.42ac28"]]},{"id":"805bf66a.42ac28","type":"counter","z":"edd42ef7.16d9c","name":"","init":"0","step":1,"lower":null,"upper":null,"mode":"increment","outputs":"1","x":500,"y":2200,"wires":[["9016220.7ef3be"]]},{"id":"86996da3.b3c9f","type":"inject","z":"edd42ef7.16d9c","name":"normal msg without control parameter","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":230,"y":2140,"wires":[["805bf66a.42ac28"]]},{"id":"9016220.7ef3be","type":"debug","z":"edd42ef7.16d9c","name":"message","active":true,"console":"false","complete":"true","x":660,"y":2200,"wires":[]},{"id":"82446996.b4d518","type":"function","z":"edd42ef7.16d9c","name":"","func":"var now     = new Date(); \nvar hour    = now.getHours();\nvar tPrefix = \"zway/\";\nvar tPostfix = \"/set\";\nif(hour >= 9 && hour < 23 )  \n{\n    if (msg)\n    {   \n        var i = context.get('light_counter')||0;\n        i += 1;\n        if (i >= 100) i = 1;\n        context.set('light_counter', i);\n    }\nmsg =\n    [\n        {topic: tPrefix + \"coldLight\" + tPostfix, payload:i},\n        {topic: tPrefix + \"warmLight\" + tPostfix, payload:100-i}\n    ]; \n   return [msg];\n}","outputs":1,"noerr":0,"x":780,"y":2400,"wires":[["5ca5d8af.b3a2d8"]]},{"id":"5ca5d8af.b3a2d8","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1020,"y":2400,"wires":[]},{"id":"9506b67c.233fa8","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":2400,"wires":[["82446996.b4d518"]]},{"id":"1a8c79da.9cd9c6","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":440,"y":2560,"wires":[["ea0ff19a.4706"]]},{"id":"ea0ff19a.4706","type":"function","z":"edd42ef7.16d9c","name":"counter","func":"var now     = new Date(); \nvar hour    = now.getHours();\n\nif(hour.toString() > 9 && hour.toString() < 18 )  \n{\n    if (msg)\n    {   \n        context.flow.counter = context.flow.counter + 1\n        if (context.flow.counter === 5)\n            {\n                context.flow.counter = 0\n                \n            }\n    }\n    msg.payload = {\"counter\":context.flow.counter, \"hour\":hour.toString()}\n    return msg\n}\n","outputs":1,"noerr":0,"x":660,"y":2560,"wires":[["7e779ef.c12c26"]]},{"id":"7e779ef.c12c26","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":2620,"wires":[]},{"id":"891772ca.76012","type":"function","z":"edd42ef7.16d9c","name":"Init counter global","func":"\n//flow.set(\"counter\", 2);\ncontext.flow.counter = 1;\n//msg.payload = flow.get(\"counter\");//context.flow.counter;\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":2500,"wires":[["40c793f4.34cbcc"]]},{"id":"f922f8ef.ac4628","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":450,"y":2500,"wires":[["891772ca.76012"]]},{"id":"b7312e11.7849b","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":2480,"wires":[]},{"id":"40c793f4.34cbcc","type":"switch","z":"edd42ef7.16d9c","name":"","property":"counter","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":830,"y":2500,"wires":[["b7312e11.7849b"],["bf7f3fe3.ec35d"],["5a3cdf57.58416"]]},{"id":"bf7f3fe3.ec35d","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":2520,"wires":[]},{"id":"4955d567.e015dc","type":"inject","z":"edd42ef7.16d9c","name":"","topic":"","payload":"counter","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":670,"y":2700,"wires":[["30b4603f.3feab"]]},{"id":"30b4603f.3feab","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":900,"y":2700,"wires":[]},{"id":"5a3cdf57.58416","type":"debug","z":"edd42ef7.16d9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":2560,"wires":[]},{"id":"a3f6f70a.4ebdb8","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":80,"wires":[["40efc64a.579b38"]]},{"id":"c7d546e4.6433a8","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":500,"y":80,"wires":[]},{"id":"40efc64a.579b38","type":"function","z":"1635ef5e.c89941","name":"","func":"var start = 80;\nvar end = 20;\nvar i = start;\n\nvar timerId = setInterval(\n    () => {\n        i--;\n        node.send({topic:\"dimmer\", payload: i});\n        if (i == end)\n            clearInterval(timerId);\n    }, \n    200\n);\n\nreturn;","outputs":1,"noerr":0,"x":320,"y":100,"wires":[["c7d546e4.6433a8"]]},{"id":"e0a4a7d5.7886d8","type":"http in","z":"1635ef5e.c89941","name":"","url":"/react","method":"post","upload":false,"swaggerDoc":"","x":500,"y":260,"wires":[["9c74ccb8.a2252","eafe0a68.6a6b28"]]},{"id":"9c74ccb8.a2252","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":760,"y":280,"wires":[]},{"id":"eafe0a68.6a6b28","type":"template","z":"1635ef5e.c89941","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"This is the payload: {{payload}} !","output":"str","x":700,"y":380,"wires":[["e1872acb.76b248","9c74ccb8.a2252"]]},{"id":"e1872acb.76b248","type":"http response","z":"1635ef5e.c89941","name":"","statusCode":"","headers":{},"x":940,"y":380,"wires":[]},{"id":"facf42f0.ee1c9","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":320,"y":540,"wires":[["8da74522.f41d48"]]},{"id":"e628ebd4.0ff828","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":800,"y":680,"wires":[]},{"id":"8da74522.f41d48","type":"function","z":"1635ef5e.c89941","name":"","func":"var columns = [`btn-info`, `btn-info`, `btn-danger`, `btn-info`, `btn-info`];\nvar events = [];\nvar rows = [5, 3, 9, 2, 1];\n\n\nvar result =  rows.map(function(result, field, index) {\n    result[`index ${index} field ${field}`];\n    return result\n  }, {});\n  \nvar resultmap = Object.entries(result) \n\nrows.map((item, index) => {\n    events.push(`index ${item} field ${columns[index]}`)\n    \n})\n\n//events.map(event=><Item key={event.id} title={event.name} />)\n\nmsg.payload = events;\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":620,"wires":[["e628ebd4.0ff828"]]},{"id":"fd289ccb.f979a","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":940,"wires":[["7266f739.fc3eb8"]]},{"id":"96da316c.eb4eb","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":840,"y":860,"wires":[]},{"id":"9948c5e5.db7268","type":"function","z":"1635ef5e.c89941","name":"","func":"msg.payload = msg.payload(1, 2);\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":860,"wires":[["96da316c.eb4eb"]]},{"id":"58a1a7af.7be158","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":670,"y":1040,"wires":[]},{"id":"35ec348e.f43dec","type":"function","z":"1635ef5e.c89941","name":"","func":"msg.payload = (a, b) => ( a + b + 4 );\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":780,"wires":[["9948c5e5.db7268"]]},{"id":"3036f015.8ec08","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":780,"wires":[["35ec348e.f43dec"]]},{"id":"c5d428f7.279b68","type":"function","z":"1635ef5e.c89941","name":"","func":"var sum = new Function(msg.payload[0], msg.payload[1]);\nvar a = 1, b = 2;\nmsg.payload = sum(a, b);\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":940,"wires":[["96da316c.eb4eb"]]},{"id":"7266f739.fc3eb8","type":"function","z":"1635ef5e.c89941","name":"","func":"var sum = [\"a, b\",\" return a + b; \"];\nmsg.payload = sum;\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":940,"wires":[["58a1a7af.7be158","c5d428f7.279b68"]]},{"id":"f73ef93b.0d0678","type":"inject","z":"1635ef5e.c89941","name":"Init 10","topic":"","payload":"10","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":550,"y":1220,"wires":[["47029472.ffdd8c"]]},{"id":"47029472.ffdd8c","type":"function","z":"1635ef5e.c89941","name":"Счетчик","func":"function makeCounter() {\n  var currentCount = 1;\n\n  // возвращаемся к функции\n  function counter() {\n    return currentCount;\n  }\n\n  // ...и добавляем ей методы!\n  counter.set = function(value) {\n    currentCount = value;\n  };\n\n  counter.inc = function() {\n    currentCount++;\n  };\n  \n  counter.dec = function() {\n    currentCount--;\n  };\n  \n  counter.reset = function() {\n    currentCount = 1;\n  };\n\n  return counter;\n}\n\nvar counter =  makeCounter();\ncounter.set(msg.payload);\nflow.set(\"counter\", counter);\n\nmsg.payload = counter();\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":1220,"wires":[["d23ba4c4.3ce758"]]},{"id":"d23ba4c4.3ce758","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":1220,"wires":[]},{"id":"fc87691e.8a9588","type":"inject","z":"1635ef5e.c89941","name":"Inc","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":550,"y":1280,"wires":[["cf9b3079.c0ec"]]},{"id":"cf9b3079.c0ec","type":"function","z":"1635ef5e.c89941","name":"Inc","func":"var counter = flow.get(\"counter\");\ncounter.inc();\nmsg.payload = counter();\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":1280,"wires":[["d23ba4c4.3ce758"]]},{"id":"92442130.8f187","type":"function","z":"1635ef5e.c89941","name":"reset","func":"var counter = flow.get(\"counter\");\ncounter.reset();\nmsg.payload = counter();\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":1400,"wires":[["d23ba4c4.3ce758"]]},{"id":"873df8ce.ef6798","type":"inject","z":"1635ef5e.c89941","name":"Reset","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":550,"y":1400,"wires":[["92442130.8f187"]]},{"id":"a36c57ed.797948","type":"inject","z":"1635ef5e.c89941","name":"Dec","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":550,"y":1340,"wires":[["1eb54bcd.4521f4"]]},{"id":"1eb54bcd.4521f4","type":"function","z":"1635ef5e.c89941","name":"Dec","func":"var counter = flow.get(\"counter\");\ncounter.dec();\nmsg.payload = counter();\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":1340,"wires":[["d23ba4c4.3ce758"]]},{"id":"2e11a4fd.799c0c","type":"ui_template","z":"7d67720.8972e9","group":"c914528f.2793c","name":"css etc","order":10,"width":"0","height":"0","format":"<style>\n\n.cellGreen \n{\nbackground-color: #ffdddd !important;\n}\n\n  .filled { \n      height: 100% !important;\n\n      padding: 0 !important;\n      margin: 0 !important;\n  }\n  .nr-dashboard-template {\n      padding: 0;\n      margin: 0;\n  }\n  \n  .rounded {\n  border-radius: 12px 12px 12px 12px;\n}\n \n   .bigfont {\n  font-size: 18px;\n}\n\n   .smallfont {\n  font-size: 12px;\n}\n \n\n  \n.zui-table {\n    border: solid 1px #DDEEEE;\n    border-collapse: collapse;\n    border-spacing: 0;\n    font: normal 10px Arial, sans-serif;\n    outline: none;\n}\n.zui-table thead th {\n    width: 100%;\n    height:50%;\n    background-color: #99bbff;\n    border: solid 1px #DDEEEE;\n    color: #336B6B;\n    padding: 7px 3px 5px 3px;\n    text-align: center;\n    text-shadow: 1px 1px 1px #fff;\n}\n.zui-table tbody td {\n    width: 100%;\n    height:50%;\n    border: solid 1px #333;\n    color: #333;\n    text-align: center;\n    padding: 6px 3px 9px 3px;\n    text-shadow: 1px 1px 1px #fff;\n}\n.zui-table-rounded {\n    border: none;\n}\n.zui-table-rounded thead th {\n    background-color: #77aaff;\n    border: none;\n    text-shadow: 1px 1px 1px #ccc;\n    color: #333;\n}\n.zui-table-rounded thead th:first-child {\n    border-radius: 10px 0 0 0;\n}\n.zui-table-rounded thead th:last-child {\n    border-radius: 10px 10px 0px 0px;\n}\n.zui-table-rounded tbody td {\n    border: none;\n    border-top: solid 1px #957030;\n    background-color: #aaddff;\n}\n.zui-table-rounded tbody tr:last-child td:first-child {\n    border-radius: 10px 10px 0 0;\n}\n.zui-table-rounded tbody tr:last-child td:last-child {\n    border-radius: 0 0 10px 10px;\n}  \n</style>\n\n<script>\nvar current=1;\n\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),50);\n    navigator.vibrate(80);\n    });\n    \n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":580,"y":140,"wires":[[]]},{"id":"20ff6130.502e3e","type":"ui_template","z":"7d67720.8972e9","group":"c914528f.2793c","name":"Settings page","order":2,"width":"6","height":"6","format":"<style>\n.thedays { vertical-align:bottom; height:48px; }\n.the2px  { background-color:black; height:2px; }\n.theblocks {width:100%; height:0%; background-color:green; }\n.greybuttons { background-color:#dddddd !important; width:48px; }\n.thetemps { font-size:70%; color:#888888 !important; }\n.smallheadings { color:black; font-size:80%; }\n\n</style>\n\n<script>\nvar thedays = [\"SUNDAY\", \"MONDAY\", \"TUESDAY\", \"WEDNESDAY\", \"THURSDAY\", \"FRIDAY\", \"SATURDAY\"];\n\nvar last = 1;\n\nfunction bar(mm, val) {\n  if (val == 14) {\n    $(mm).height(\"12%\");\n    $(mm).css('background-color', '#6666ff');\n  } //blue\n  if (val == 15) {\n    $(mm).height(\"16%\");\n    $(mm).css('background-color', '#5577ff');\n  }\n  if (val == 16) {\n    $(mm).height(\"20%\");\n    $(mm).css('background-color', '#5599ff');\n  }\n  if (val == 17) {\n    $(mm).height(\"24%\");\n    $(mm).css('background-color', '#55ccdd');\n  } // cyan\n  if (val == 18) {\n    $(mm).height(\"28%\");\n    $(mm).css('background-color', '#55ddaa');\n  }\n  if (val == 19) {\n    $(mm).height(\"32%\");\n    $(mm).css('background-color', '#55dd55');\n  }\n  if (val == 20) {\n    $(mm).height(\"36%\");\n    $(mm).css('background-color', '#55dd55');\n  } // green\n  if (val == 21) {\n    $(mm).height(\"40%\");\n    $(mm).css('background-color', '#55dd55');\n  }\n  if (val == 22) {\n    $(mm).height(\"44%\");\n    $(mm).css('background-color', '#aadd55');\n  }\n  if (val == 23) {\n    $(mm).height(\"48%\");\n    $(mm).css('background-color', '#dddd55');\n  } // yellow\n  if (val == 24) {\n    $(mm).height(\"52%\");\n    $(mm).css('background-color', '#ffaa55');\n  }\n  if (val == 25) {\n    $(mm).height(\"56%\");\n    $(mm).css('background-color', '#ff8855');\n  }\n  if (val == 26) {\n    $(mm).height(\"60%\");\n    $(mm).css('background-color', '#ff7777');\n  } // red\n\n}\n\nfunction stat(text) {\n  $(\"#info\").text(text);\n  var tm = setTimeout(function() {\n    $(\"#info\").text(\"Ok\");\n    clearTimeout(tm);\n  }, 3000);\n}\n\nfunction selec(val, sta) {\n  var w = \"#td\" + val;\n  if (sta) $(w).css('background-color', 'magenta');\n  else $(w).css('background-color', 'black');\n}\n\n(function(scope) {\n  scope.$watch('msg', function(msg) {\n    selec(last, 0);\n    last = msg.selector;\n    selec(last, 1);\n    for (var x = 0; x < 24; x++) {\n      var w = \"#t\" + x;\n      bar(w, msg.timing[((msg.days - 1) * 24) + x]);\n      var v = \"#v\" + x;\n      $(v).text(msg.timing[((msg.days - 1) * 24) + x] + \"C\")\n    }\n    for (var x = 0; x < 2; x++) {\n      var w = \"#s\" + x;\n      $(w).text(msg.timing[168 + x] + \"C\");\n    }\n    $(\"#d0\").text(thedays[msg.days - 1]);\n    if ((last > 4) && (last < 29))\n      $(\"#current\").text(msg.timing[((msg.days - 1) * 24) + last - 5] + \"C\");\n    else\n      $(\"#current\").text(\"-\");\n\n    if (msg.foryou != \"\") {\n      stat(msg.foryou);\n    }\n\n\n  });\n\n})(scope);\n\n</script>\n<table width=\"100%\">\n  <tr style=\"height:2px\">\n    <td colspan=12 style=\"background-color:black;height:5px;\"></td>\n  </tr>\n\n  <tr>\n    <td colspan=6>\n      <center><span class=\"smallheadings\">Day</span></center>\n    </td>\n    <td colspan=3>\n      <center><span class=\"smallheadings\">Frost</span></center>\n    </td>\n    <td colspan=3>\n      <center><span class=\"smallheadings\">Away</span></center>\n    </td>\n  </tr>\n\n  <tr>\n    <td ng-click=\"send({payload: '29'})\" colspan=6>\n      <center><span id=\"d0\" style=\"color:blue;font-size:120%\">MONDAY</span></center>\n    </td>\n    <td ng-click=\"send({payload: '1'})\" colspan=3>\n      <center><span id=\"s0\" style=\"color:blue;font-size:120%\">14</span></center>\n    </td>\n    <td ng-click=\"send({payload: '2'})\" colspan=3>\n      <center><span id=\"s1\" style=\"color:blue;font-size:120%\">20</span></center>\n    </td>\n  </tr>\n\n  <tr style=\"height:2px\">\n    <td id=\"td29\" colspan=6 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"td1\" colspan=3 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"td2\" colspan=3 style=\"background-color:black;height:2px;\"></td>\n  </tr>\n\n  <tr>\n    <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"v0\" class=\"thetemps\"></span>\n      <div id=\"t0\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"v1\" class=\"thetemps\"></span>\n      <div id=\"t1\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"v2\" class=\"thetemps\"></span>\n      <div id=\"t2\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"v3\" class=\"thetemps\"></span>\n      <div id=\"t3\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"v4\" class=\"thetemps\"></span>\n      <div id=\"t4\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"v5\" class=\"thetemps\"></span>\n      <div id=\"t5\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"v6\" class=\"thetemps\"></span>\n      <div id=\"t6\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"v7\" class=\"thetemps\"></span>\n      <div id=\"t7\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"v8\" class=\"thetemps\"></span>\n      <div id=\"t8\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"v9\" class=\"thetemps\"></span>\n      <div id=\"t9\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"v10\" class=\"thetemps\"></span>\n      <div id=\"t10\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"v11\" class=\"thetemps\"></span>\n      <div id=\"t11\" class=\"theblocks\"></div>\n    </td>\n  </tr>\n\n  <tr style=\"height:2px\">\n    <td id=\"td5\" class=\"the2px\"></td>\n    <td id=\"td6\" class=\"the2px\"></td>\n    <td id=\"td7\" class=\"the2px\"></td>\n    <td id=\"td8\" class=\"the2px\"></td>\n    <td id=\"td9\" class=\"the2px\"></td>\n    <td id=\"td10\" class=\"the2px\"></td>\n    <td id=\"td11\" class=\"the2px\"></td>\n    <td id=\"td12\" class=\"the2px\"></td>\n    <td id=\"td13\" class=\"the2px\"></td>\n    <td id=\"td14\" class=\"the2px\"></td>\n    <td id=\"td15\" class=\"the2px\"></td>\n    <td id=\"td16\" class=\"the2px\"></td>\n  </tr>\n\n  <tr>\n    <td>0</td>\n    <td>1</td>\n    <td>2</td>\n    <td>3</td>\n    <td>4</td>\n    <td>5</td>\n    <td>6</td>\n    <td>7</td>\n    <td>8</td>\n    <td>9</td>\n    <td>10</td>\n    <td>11</td>\n  </tr>\n\n  <tr>\n    <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"v12\" class=\"thetemps\"></span>\n      <div id=\"t12\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"v13\" class=\"thetemps\"></span>\n      <div id=\"t13\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"v14\" class=\"thetemps\"></span>\n      <div id=\"t14\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"v15\" class=\"thetemps\"></span>\n      <div id=\"t15\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"v16\" class=\"thetemps\"></span>\n      <div id=\"t16\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"v17\" class=\"thetemps\"></span>\n      <div id=\"t17\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"v18\" class=\"thetemps\"></span>\n      <div id=\"t18\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"v19\" class=\"thetemps\"></span>\n      <div id=\"t19\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"v20\" class=\"thetemps\"></span>\n      <div id=\"t20\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"v21\" class=\"thetemps\"></span>\n      <div id=\"t21\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"v22\" class=\"thetemps\"></span>\n      <div id=\"t22\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"v23\" class=\"thetemps\"></span>\n      <div id=\"t23\" class=\"theblocks\"></div>\n    </td>\n  </tr>\n\n  <tr style=\"height:2px\">\n    <td id=\"td17\" class=\"the2px\"></td>\n    <td id=\"td18\" class=\"the2px\"></td>\n    <td id=\"td19\" class=\"the2px\"></td>\n    <td id=\"td20\" class=\"the2px\"></td>\n    <td id=\"td21\" class=\"the2px\"></td>\n    <td id=\"td22\" class=\"the2px\"></td>\n    <td id=\"td23\" class=\"the2px\"></td>\n    <td id=\"td24\" class=\"the2px\"></td>\n    <td id=\"td25\" class=\"the2px\"></td>\n    <td id=\"td26\" class=\"the2px\"></td>\n    <td id=\"td27\" class=\"the2px\"></td>\n    <td id=\"td28\" class=\"the2px\"></td>\n  </tr>\n\n  <tr>\n    <td>12</td>\n    <td>13</td>\n    <td>14</td>\n    <td>15</td>\n    <td>16</td>\n    <td>17</td>\n    <td>18</td>\n    <td>19</td>\n    <td>20</td>\n    <td>21</td>\n    <td>22</td>\n    <td>23</td>\n  </tr>\n\n  <tr height=\"20px\">\n    <td colspan=2 bgcolor=\"#dddddd\"><span class=\"smallheadings\">&nbsp;Status:</span></td>\n\n    <td colspan=10 bgcolor=\"#dddddd\">\n      <center><span id=\"info\" class=\"smallheadings\">OK</span></center>\n    </td>\n  </tr>\n\n  <tr height=\"10px\">\n    <td colspan=\"12\"></td>\n  </tr>\n\n  <tr style=\"height:48px\">\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-left-double-2.png':'/myicons/png/48x48/actions/arrow-left-double-2.png'}}\" height=\"36px\" />\n      </md-button>\n    </td>\n\n    <td colspan=2>\n      <center><span id=\"current\" style=\"color:black;font-size:120%\">-</span></center>\n    </td>\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-right-double-2.png':'/myicons/png/48x48/actions/arrow-right-double-2.png'}}\" height=\"36px\" />\n      </md-button>\n    </td>\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/edit-copy-4.png':'/myicons/png/48x48/actions/edit-copy-4.png'}}\" height=\"36px\" />\n      </md-button>\n    </td>\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/document-save-5.png':'/myicons/png/48x48/actions/document-save-5.png'}}\" height=\"36px\" />\n      </md-button>\n    </td>\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'c'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/dialog-cancel-5.png':'/myicons/png/48x48/actions/dialog-cancel-5.png'}}\" height=\"36px\" />\n      </md-button>\n    </td>\n    <td colspan=1></td>\n  </tr>\n\n</table>\n","storeOutMessages":false,"fwdInMessages":false,"x":760,"y":140,"wires":[["dc1545a6.1af8c8"]]},{"id":"dc1545a6.1af8c8","type":"function","z":"7d67720.8972e9","name":"Process controls","func":"if ( typeof context.days == 'undefined' ) context.days=1;\nif ( typeof context.selector == 'undefined' ) context.selector=1;\nif ( typeof context.saving == 'undefined' ) context.saving=0;\nif ( typeof context.global.incomingTemperature == 'undefined' ) context.global.incomingTemperature=0;\nif ( typeof context.global.incomingHumidity == 'undefined' ) context.global.incomingHumidity=0;\nif ( typeof context.global.hold == 'undefined' ) context.global.hold=0;\nif ( typeof context.global.away == 'undefined' ) context.global.away=0;\nif ( typeof context.global.manual == 'undefined' ) context.global.manual=0;\nif ( typeof context.global.setTemperature == 'undefined' ) context.global.setTemperature=0;\nif ( typeof context.global.manualTimer == 'undefined' ) context.global.manualTimer=0;\nif ( typeof context.global.timing == 'undefined' ) \n    {\n        context.global.timing=[\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        8,14\n                        ];\n        context.saving=0;  \n        msg.payload=\"anything\";  msg.foryou=\"Restoring\"; return([null,null,msg]);\n    }\nvar timing=global.get(\"timing\");\n\nswitch (msg.payload)\n    {\n    case \"u\" :  if ((context.selector>4)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5]++; \n                    if (timing[((context.days-1)*24)+context.selector-5]>26) timing[((context.days-1)*24)+context.selector-5]=26;\n                    msg.foryou=\"Incremented temperature\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Incremented frost setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==2) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Incremented away setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==29) { if (context.days<7) { context.days++; msg.foryou=\"Forward one day\";} else msg.foryou=\"End of days!!\"; }\n                break;\n    case \"d\" :  if ((context.selector>4)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5]--; \n                    if (timing[((context.days-1)*24)+context.selector-5]<14) timing[((context.days-1)*24)+context.selector-5]=14;\n                    msg.foryou=\"Decremented temperature\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]>8) { timing[168+(context.selector-1)]--; msg.foryou=\"Decremented frost setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==2) { if (timing[168+(context.selector-1)]>8) { timing[168+(context.selector-1)]--; msg.foryou=\"Decremented away setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==29) { if (context.days>1) { context.days--;  msg.foryou=\"Backward one day\";} else msg.foryou=\"Beginning of days!!\";  }\n                break;\n    case 'r' :  if ((context.selector>=5)&&(context.selector<28))\n                        {\n                         timing[((context.days-1)*24)+context.selector-4]=timing[((context.days-1)*24)+context.selector-5];   \n                         context.selector++;\n                         msg.foryou=\"Copied settings to the next hour slot\";\n                        }\n                if ((context.selector==29)&&(context.days<7))\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                             timing[((context.days)*24)+a]=timing[((context.days-1)*24)+a];   \n                            }\n                         context.days++;\n                         msg.foryou=\"Copied a complete day's settings\";\n                        }\n                break;\n    case 's': context.saving=0;  msg.foryou=\"Settings saved to disk\"; break;\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '14':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29': context.selector=parseInt(msg.payload);\n               if (msg.payload=='1') msg.foryou=\"Frost temperature selection\"; \n               else if (msg.payload=='2') msg.foryou=\"Away temperature selection\";\n               else if (msg.payload=='29') msg.foryou=\"Day selection\";\n               else  msg.foryou=\"Selected hour period \" + (parseInt(msg.payload)-4);\n    break;\n    case 'c' : msg.payload=\"anything\";  msg.foryou=\"Changes cancelled\"; node.send([null,null,msg]);\n    }\n\nmsg.temperatures=context.temperatures;\nmsg.timing=timing;\nmsg.days=context.days;\nmsg.selector=context.selector;\n\nnode.send([msg,null,null]);\n\nif (context.saving===0) \n    { \n       msg.topic=\"\";\n        msg.timing=\"\";\n        msg.payload=JSON.stringify(timing);\n        node.send([null,msg,null]); \n        context.saving=1;\n    }\n    msg.foryou=\"\"","outputs":"3","noerr":0,"x":690,"y":200,"wires":[["20ff6130.502e3e"],["6a7a324.3e18dcc"],["f4c0d66.f256628"]]},{"id":"39df918b.31b6ee","type":"inject","z":"7d67720.8972e9","name":"Once only","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":480,"y":260,"wires":[["dc1545a6.1af8c8","f4c0d66.f256628"]]},{"id":"2deea991.1a2ff6","type":"inject","z":"7d67720.8972e9","name":"Every minute","topic":"","payload":"","payloadType":"str","repeat":"60","crontab":"","once":false,"x":480,"y":320,"wires":[["baeb215d.f93b8","17445113.4835ff"]]},{"id":"baeb215d.f93b8","type":"function","z":"7d67720.8972e9","name":"Process heat","func":"var timing=global.get(\"timing\");\nvar now = new Date();\nmsg.payload=timing[(now.getDay()*24)+now.getHours()];\nmsg.frost=timing[168];\nmsg.away=timing[169];\n\nmsg.temperature=global.get(\"incomingTemperature\");\nmsg.humidity=global.get(\"incomingHumidity\");\nmsg.set=msg.payload;\nif (global.get(\"manualTimer\")) global.set(\"manualTimer\",global.get(\"manualTimer\")-1);\nelse global.set(\"manual\",0);\nmsg.desired=msg.set;\nglobal.set(\"setTemperature\",msg.desired);\nmsg.desired+=global.get(\"manual\");\nif (global.get(\"frost\")) { msg.desired=global.get(\"timing\")[168]; global.set(\"frost\",global.get(\"frost\")-1); }\nif (global.get(\"away\")) { msg.desired=global.get(\"timing\")[169]; global.set(\"away\",global.get(\"away\")-1); }\nif (msg.desired>msg.temperature) msg.relay=1; else msg.relay=0;\n\nmsg.payload=global.get(\"incomingTemperature\");\n\nnode.status({fill:\"blue\",shape:\"dot\",text:\"Set point \" + msg.desired + \"c - Actual \" + msg.temperature +\"c\"});\n\nnode.send([msg,null]);\nmsg.payload=msg.relay;\nnode.send([null,msg]);\n\n\n\n\n","outputs":"2","noerr":0,"x":710,"y":340,"wires":[["c454deae.e77a9","f6b80709.8dae78"],["6f4f6d35.12b7e4"]]},{"id":"6a7a324.3e18dcc","type":"file","z":"7d67720.8972e9","name":"backup","filename":"/home/pi/petesstatlog.log","appendNewline":true,"createDir":true,"overwriteFile":"true","x":920,"y":260,"wires":[[]]},{"id":"f4c0d66.f256628","type":"file in","z":"7d67720.8972e9","name":"Restore","filename":"/home/pi/petesstatlog.log","format":"utf8","x":920,"y":200,"wires":[["50a7b6b3.479048"]]},{"id":"50a7b6b3.479048","type":"function","z":"7d67720.8972e9","name":"Restore data from SD","func":"context.global.timing=JSON.parse(msg.payload);\nmsg.payload=\"\";\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":280,"wires":[["dc1545a6.1af8c8"]]},{"id":"1e446284.41a8fd","type":"inject","z":"7d67720.8972e9","name":"incoming temperature 18c","topic":"","payload":"18","payloadType":"str","repeat":"","crontab":"","once":false,"x":150,"y":140,"wires":[["64b6757f.02acec"]]},{"id":"6b13044c.76db0c","type":"inject","z":"7d67720.8972e9","name":"incoming temperature 20c","topic":"","payload":"20","payloadType":"str","repeat":"","crontab":"","once":false,"x":150,"y":180,"wires":[["64b6757f.02acec"]]},{"id":"eaa96340.11d52","type":"inject","z":"7d67720.8972e9","name":"incoming temperature 26c","topic":"","payload":"26","payloadType":"str","repeat":"","crontab":"","once":false,"x":150,"y":220,"wires":[["64b6757f.02acec"]]},{"id":"2a24e758.135c98","type":"inject","z":"7d67720.8972e9","name":"incoming humidity 40%","topic":"","payload":"40","payloadType":"str","repeat":"","crontab":"","once":false,"x":140,"y":260,"wires":[["297c0779.ad71d8"]]},{"id":"f1a14e62.67b33","type":"inject","z":"7d67720.8972e9","name":"incoming humidity 50%","topic":"","payload":"50","payloadType":"str","repeat":"","crontab":"","once":false,"x":140,"y":300,"wires":[["297c0779.ad71d8"]]},{"id":"64b6757f.02acec","type":"function","z":"7d67720.8972e9","name":"Store temperature","func":"global.set(\"incomingTemperature\",msg.payload);","outputs":"0","noerr":0,"x":410,"y":180,"wires":[]},{"id":"297c0779.ad71d8","type":"function","z":"7d67720.8972e9","name":"Store humidity","func":"global.set(\"incomingHumidity\",msg.payload);","outputs":"0","noerr":0,"x":400,"y":220,"wires":[]},{"id":"d7c02934.3d3b88","type":"inject","z":"7d67720.8972e9","name":"Test \"Away\" 2 minutes","topic":"","payload":"2","payloadType":"str","repeat":"","crontab":"","once":false,"x":140,"y":340,"wires":[["6769fe88.e97bc"]]},{"id":"88f756ed.0d1838","type":"inject","z":"7d67720.8972e9","name":"Test \"Away\" clear","topic":"","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"x":120,"y":380,"wires":[["6769fe88.e97bc"]]},{"id":"28b9d8ef.f45738","type":"inject","z":"7d67720.8972e9","name":"Test \"Frost\" 2 minutes","topic":"","payload":"2","payloadType":"str","repeat":"","crontab":"","once":false,"x":140,"y":420,"wires":[["61173c18.8fc974"]]},{"id":"4256a1c4.eea93","type":"inject","z":"7d67720.8972e9","name":"Test \"Frost\" clear","topic":"","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"x":120,"y":460,"wires":[["61173c18.8fc974"]]},{"id":"61173c18.8fc974","type":"function","z":"7d67720.8972e9","name":"Store \"Hold\"","func":"global.set(\"frost\",msg.payload);","outputs":"0","noerr":0,"x":390,"y":420,"wires":[]},{"id":"6769fe88.e97bc","type":"function","z":"7d67720.8972e9","name":"Store \"Away\"","func":"global.set(\"away\",msg.payload);","outputs":"0","noerr":0,"x":390,"y":380,"wires":[]},{"id":"4d5c9296.f749bc","type":"inject","z":"7d67720.8972e9","name":"sample forecast","topic":"","payload":"Dry, 2c with chance of snow","payloadType":"str","repeat":"","crontab":"","once":false,"x":120,"y":500,"wires":[["647bdb71.415564"]]},{"id":"9175cf76.eff6f","type":"inject","z":"7d67720.8972e9","name":"Sample forecast","topic":"","payload":"Wet, 12c, possibly rain tonight","payloadType":"str","repeat":"","crontab":"","once":false,"x":120,"y":540,"wires":[["647bdb71.415564"]]},{"id":"647bdb71.415564","type":"function","z":"7d67720.8972e9","name":"Store forecast","func":"global.set(\"forecast\",msg.payload);","outputs":"0","noerr":0,"x":400,"y":500,"wires":[]},{"id":"6f4f6d35.12b7e4","type":"function","z":"7d67720.8972e9","name":"Pretend relay","func":"if (msg.payload==1)\nnode.status({fill:\"red\",shape:\"dot\",text:\"Relay ON\"});\nelse\nnode.status({fill:\"black\",shape:\"dot\",text:\"Relay OFF\"});\n","outputs":"0","noerr":0,"x":960,"y":300,"wires":[]},{"id":"9024405.64ed3c","type":"function","z":"7d67720.8972e9","name":"Handle SET","func":"// here we set manual override controls - valid for 60 minutes after last change.\n\n\nif (global.get(\"away\")===0)\n{\n    if (msg.payload==\"u\") { global.set(\"manualTimer\",60); if (global.get(\"manual\")<12) global.set(\"manual\",global.get(\"manual\")+1); }\n    if (msg.payload==\"d\") { global.set(\"manualTimer\",60); if (global.get(\"manual\")>-12) global.set(\"manual\",global.get(\"manual\")-1); }\n    if (msg.payload==\"a\") { global.set(\"manualTimer\",0); global.set(\"manual\",0); }\n}\n\nvar x= msg.desired=global.get(\"setTemperature\") + global.get(\"manual\");\nmsg.desired=x;\n\nif (global.get(\"manual\")===0) msg.colour=\"#aaddff\"; else msg.colour=\"#aaffaa\";\n\nif (global.get(\"frost\")) { msg.desired=global.get(\"timing\")[168]; msg.colour=\"#ffbbbb\"; }\nif (global.get(\"away\"))  { msg.desired=global.get(\"timing\")[169];msg.colour=\"#ffbbbb\";  }\n\nmsg.payload=msg.desired;\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":440,"wires":[["f6b80709.8dae78","c454deae.e77a9"]]},{"id":"9ef323f1.dd80a","type":"ui_template","z":"7d67720.8972e9","group":"c914528f.2793c","name":"up","order":4,"width":"1","height":"1","format":"  <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-right-2.png':'/myicons/png/48x48/actions/arrow-right-2.png'}}\" \n                              height=\"36px\"\n                />\n</md-button> ","storeOutMessages":false,"fwdInMessages":false,"x":570,"y":400,"wires":[["9024405.64ed3c","3ac93aca.f94886"]]},{"id":"e8dc4cfe.71e55","type":"ui_template","z":"7d67720.8972e9","group":"c914528f.2793c","name":"down","order":3,"width":"1","height":"1","format":"  <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-down-2.png':'/myicons/png/48x48/actions/arrow-left-2.png'}}\" \n                              height=\"36px\"\n                />\n</md-button> ","storeOutMessages":false,"fwdInMessages":false,"x":570,"y":440,"wires":[["9024405.64ed3c","3ac93aca.f94886"]]},{"id":"677ecc23.3bb134","type":"function","z":"7d67720.8972e9","name":"Handle AWAY","func":"// here we set manual override controls - valid for 60 minutes after last change.\nif (msg.payload==\"u\") {  global.set(\"away\",global.get(\"away\")+1); }\nif (msg.payload==\"uu\") { global.set(\"away\",global.get(\"away\")+24); }\nif (msg.payload==\"a\") { global.set(\"away\",0);  }\nmsg.away=global.get(\"away\");\n\nif (global.get(\"away\")===0) msg.colour=\"#aaddff\"; else msg.colour=\"#aaffaa\";\n\nvar t=parseInt(msg.away);\nif (t>23) t=((t/24).toFixed(1))+\"d\"; else t=t+\"h\";\nmsg.away=t;\n  \nmsg.payload=\"\";\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":520,"wires":[["9024405.64ed3c","d6fcefc8.49615"]]},{"id":"252fa355.f598dc","type":"ui_template","z":"7d67720.8972e9","group":"c914528f.2793c","name":"more","order":6,"width":"1","height":"1","format":"  <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-right-2.png':'/myicons/png/48x48/actions/arrow-right-2.png'}}\" \n                              height=\"36px\"\n                />\n</md-button> ","storeOutMessages":false,"fwdInMessages":false,"x":570,"y":520,"wires":[["677ecc23.3bb134","3ac93aca.f94886"]]},{"id":"b62ed3e9.490ca","type":"ui_template","z":"7d67720.8972e9","group":"c914528f.2793c","name":"mmore","order":7,"width":"1","height":"1","format":"  <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'uu'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-left-double-2.png':'/myicons/png/48x48/actions/arrow-right-double-2.png'}}\" \n                              height=\"36px\"\n                />\n</md-button> ","storeOutMessages":false,"fwdInMessages":false,"x":580,"y":560,"wires":[["677ecc23.3bb134","3ac93aca.f94886"]]},{"id":"c454deae.e77a9","type":"ui_template","z":"7d67720.8972e9","group":"c914528f.2793c","name":"newergauge","order":1,"width":"3","height":"3","format":"<script type=\"text/javascript\" src=\"/myjs/gauge.min.js\"></script>\n<script>\n\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n           gauge.value=msg.payload;\n           // if (msg.units!=\"\") gauge.units=msg.units;\n        });\n \n    })(scope);\nvar gauge = new RadialGauge({\n    renderTo: 'canvas-id',\n    width: 160,\n    height: 160,\n    units: \"Degrees C\",\n    title: \"Thermometer\",\n    minValue: 10,\n    maxValue: 30,\n    majorTicks: [\n        '10',\n        '15',\n        '20',\n        '25',\n        '30'\n    ],\n    minorTicks: 5,\n    strokeTicks: true,\n   highlights  : [\n        { from : 10,  to : 15, color : '#8888ff' },\n        { from : 15, to : 20, color :  '#88ff88' },\n        { from : 20, to : 25, color :  '#ffff00' },\n        { from : 25, to : 30, color :  '#ff8888' }\n    ],\n\n    colorPlate: \"#fff\",\n    borderShadowWidth: 0,\n    borders: true,\n    needleType: \"arrow\",\n    valueInt: 2,\n    valueDec:0,\n    needleWidth: 2,\n    fontTitleSize: 42,\n    needleCircleSize: 14,\n    needleCircleOuter: true,\n    needleCircleInner: false,\n    animationDuration: 500,\n    animationRule: \"linear\"\n}).draw();\n\ngauge.value = 18;\n\n</script>\n<canvas style=\"outline: none;\" ng-click=\"send({payload: ' '})\" id=\"canvas-id\">\n\n</canvas>","storeOutMessages":false,"fwdInMessages":false,"x":990,"y":360,"wires":[["baeb215d.f93b8","e12fab99.647d68"]]},{"id":"f6b80709.8dae78","type":"ui_template","z":"7d67720.8972e9","group":"c914528f.2793c","name":"SET","order":5,"width":"1","height":"1","format":"<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n             if (msg.desired!=\"\") $(\"#infor\").text(msg.desired+\"C\");\n             if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n        });\n \n    })(scope);\n</script>\n<table  ng-click=\"send({payload: 'a'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>SET</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr >\n            <td id=\"infor\"></td>\n        </tr>\n\n    </tbody>\n</table>\n","storeOutMessages":false,"fwdInMessages":false,"x":970,"y":420,"wires":[["9024405.64ed3c","3ac93aca.f94886"]]},{"id":"d6fcefc8.49615","type":"ui_template","z":"7d67720.8972e9","group":"c914528f.2793c","name":"AWAY","order":8,"width":"1","height":"1","format":"<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n             if (msg.away!=\"\") $(\"#awaytable\").text(msg.away);\n             if (msg.colour!=\"\") $(\"#awaytable\").css(\"background-color\",msg.colour);\n        });\n \n    })(scope);\n</script>\n\n<table ng-click=\"send({payload: 'a'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>AWAY</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td id=\"awaytable\"></td>\n    \n        </tr>\n\n    </tbody>\n</table>","storeOutMessages":false,"fwdInMessages":false,"x":970,"y":480,"wires":[["677ecc23.3bb134","3ac93aca.f94886"]]},{"id":"48974cd2.5ed0b4","type":"ui_template","z":"7d67720.8972e9","group":"c914528f.2793c","name":"STATUS","order":9,"width":"3","height":"1","format":"<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n             if (msg.topic!=\"\") $(\"#hdr1\").text(msg.topic);\n             if (msg.payload!=\"\") $(\"#bod1\").text(msg.payload);\n        });\n    })(scope);\n</script>\n\n<table ng-click=\"send({payload: 'a'})\" width=100% height=100% class=\"zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th id=\"hdr1\">></th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td id=\"bod1\"></td>\n    \n        </tr>\n\n    </tbody>\n</table>","storeOutMessages":false,"fwdInMessages":false,"x":1000,"y":580,"wires":[[]]},{"id":"17445113.4835ff","type":"function","z":"7d67720.8972e9","name":"show humidity","func":"function theNewDate()\n{\n   var d = new Date(),\n    minutes = d.getMinutes().toString().length == 1 ? '0'+d.getMinutes() : d.getMinutes();\n    hours = d.getHours().toString().length == 1 ? '0'+d.getHours() : d.getHours();\n    ampm = d.getHours() >= 12 ? 'pm' : 'am';\n    months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\n    var m= days[d.getDay()]+' '+months[d.getMonth()]+' '+d.getDate()+' '+d.getFullYear()+' '+hours+':'+minutes+ampm;\n    return m;\n}\n\nmsg.topic=theNewDate();\nmsg.payload=\"Humidity: \" + global.get(\"incomingHumidity\") +\"%\" ;\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":580,"wires":[["48974cd2.5ed0b4"]]},{"id":"3ac93aca.f94886","type":"function","z":"7d67720.8972e9","name":"Showing settings","func":"msg.payload=\"Showing settings\";\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":620,"wires":[["48974cd2.5ed0b4"]]},{"id":"e12fab99.647d68","type":"function","z":"7d67720.8972e9","name":"Showing actual","func":"msg.payload=\"Showing actual\";\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":660,"wires":[["48974cd2.5ed0b4"]]},{"id":"55df3e99.c04fd","type":"ui_template","z":"84e1670a.31e198","group":"e24986b9.6965d8","name":"css etc","order":4,"width":"0","height":"0","format":"<style>\n  .filled { \n      height: 100% !important;\n\n      padding: 0 !important;\n      margin: 0 !important;\n  }\n  .nr-dashboard-template {\n      padding: 0;\n      margin: 0;\n  }\n  \n  .rounded {\n  border-radius: 12px 12px 12px 12px;\n}\n \n   .bigfont {\n  font-size: 18px;\n}\n\n   .smallfont {\n  font-size: 12px;\n}\n  \n</style>\n\n<script>\nvar current=1;\n\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),50);\n    navigator.vibrate(80);\n    });\n    \n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":180,"y":120,"wires":[[]]},{"id":"d5edbef6.88fa8","type":"ui_template","z":"84e1670a.31e198","group":"e24986b9.6965d8","name":"Settings page","order":3,"width":"6","height":"6","format":"<style>\n.thedays { vertical-align:bottom; height:48px; }\n.the2px  { background-color:black; height:2px; }\n.theblocks {width:100%; height:0%; background-color:green; }\n.greybuttons { background-color:#dddddd !important; width:48px; }\n.thetemps { font-size:70%; color:#888888 !important; }\n.smallheadings { color:black; font-size:80%; }\n\n</style>\n\n<script>\nvar thedays=[\"SUNDAY\",\"MONDAY\",\"TUESDAY\",\"WEDNESDAY\",\"THURSDAY\",\"FRIDAY\",\"SATURDAY\"];\n\nvar last=1;\n\nfunction bar(mm,val)\n{\nif (val==14) { $(mm).height(\"12%\"); $(mm).css('background-color', '#0000ff'); } //blue\nif (val==15) { $(mm).height(\"16%\"); $(mm).css('background-color', '#0055ff'); }\nif (val==16) { $(mm).height(\"20%\"); $(mm).css('background-color', '#00aaff'); } \nif (val==17) { $(mm).height(\"24%\"); $(mm).css('background-color', '#00dddd'); } // cyan\nif (val==18) { $(mm).height(\"28%\"); $(mm).css('background-color', '#00ffaa'); }\nif (val==19) { $(mm).height(\"32%\"); $(mm).css('background-color', '#00ff55'); } \nif (val==20) { $(mm).height(\"36%\"); $(mm).css('background-color', '#00ff00'); } // green\nif (val==21) { $(mm).height(\"40%\"); $(mm).css('background-color', '#55ff00'); }\nif (val==22) { $(mm).height(\"44%\"); $(mm).css('background-color', '#aaff00'); }\nif (val==23) { $(mm).height(\"48%\"); $(mm).css('background-color', '#dddd00'); } // yellow\nif (val==24) { $(mm).height(\"52%\"); $(mm).css('background-color', '#ffaa00'); }\nif (val==25) { $(mm).height(\"56%\"); $(mm).css('background-color', '#ff5500'); }\nif (val==26) { $(mm).height(\"60%\"); $(mm).css('background-color','#ff0000'); } // red\n    \n}\n\nfunction stat(text)\n{\n$(\"#info\").text(text);\nvar tm=setTimeout(function(){ $(\"#info\").text(\"Ok\"); clearTimeout(tm);}, 3000);\n}\n\nfunction selec(val,sta)\n{\nvar w=\"#td\"+val;\n if (sta) $(w).css('background-color','magenta'); else $(w).css('background-color','black');\n}\n\n    (function(scope){\n        scope.$watch('msg', function(msg) {\n            selec(last,0); last=msg.selector; selec(last,1);\n            for (var x=0; x<24; x++) \n                { \n                    var w=\"#t\"+x; bar(w,msg.timing[((msg.days-1)*24)+x]); \n                    var v=\"#v\"+x; $(v).text(msg.timing[((msg.days-1)*24)+x]+\"c\")\n                } \n            for (var x=0; x<2; x++) { var w=\"#s\"+x; $(w).text(msg.timing[168+x]); }\n             $(\"#d0\").text(thedays[msg.days-1]);\n             if ((last>4) &&(last<29))\n                 $(\"#current\").text(msg.timing[((msg.days-1)*24)+last-5] + \"c\");\n             else\n                 $(\"#current\").text(\"-\");\n                 \n            if (msg.foryou!=\"\") { stat(msg.foryou);  }\n            \n             \n        });\n \n    })(scope);\n      \n\n</script>\n<table width=\"100%\">\n    \n    <tr>\n        <td colspan=6><center><span class=\"smallheadings\" >Day</span></center></td>\n        <td colspan=3><center><span class=\"smallheadings\">Frost</span></center></td>\n        <td colspan=3><center><span class=\"smallheadings\">Away</span></center></td>\n    </tr>\n   \n    <tr>\n        <td ng-click=\"send({payload: '29'})\" colspan=6><center><span id=\"d0\" style=\"color:blue;font-size:120%\">MONDAY</span></center></td>\n        <td ng-click=\"send({payload: '1'})\" colspan=3><center><span id=\"s0\" style=\"color:blue;font-size:120%\">14</span></center></td>\n        <td ng-click=\"send({payload: '2'})\" colspan=3><center><span id=\"s1\" style=\"color:blue;font-size:120%\">20</span></center></td>\n    </tr>\n    \n    <tr style=\"height:2px\">\n        <td id=\"td29\" colspan=6 style=\"background-color:black;height:2px;\"></td>        \n        <td id=\"td1\" colspan=3 style=\"background-color:black;height:2px;\"></td>\n        <td id=\"td2\" colspan=3 style=\"background-color:black;height:2px;\"></td>\n    </tr>  \n\n    <tr>\n        <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"v0\" class=\"thetemps\"></span><div id=\"t0\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"v1\" class=\"thetemps\"></span><div id=\"t1\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"v2\" class=\"thetemps\"></span><div id=\"t2\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"v3\" class=\"thetemps\"></span><div id=\"t3\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"v4\" class=\"thetemps\"></span><div id=\"t4\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"v5\" class=\"thetemps\"></span><div id=\"t5\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"v6\" class=\"thetemps\"></span><div id=\"t6\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"v7\" class=\"thetemps\"></span><div id=\"t7\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"v8\" class=\"thetemps\"></span><div id=\"t8\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"v9\" class=\"thetemps\"></span><div id=\"t9\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"v10\" class=\"thetemps\"></span><div id=\"t10\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"v11\" class=\"thetemps\"></span><div id=\"t11\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"td5\" class=\"the2px\"></td>\n        <td id=\"td6\" class=\"the2px\"></td>\n        <td id=\"td7\" class=\"the2px\"></td>\n        <td id=\"td8\" class=\"the2px\"></td>\n        <td id=\"td9\" class=\"the2px\"></td>\n        <td id=\"td10\" class=\"the2px\"></td>\n        <td id=\"td11\" class=\"the2px\"></td>\n        <td id=\"td12\" class=\"the2px\"></td>\n        <td id=\"td13\" class=\"the2px\"></td>\n        <td id=\"td14\" class=\"the2px\"></td>\n        <td id=\"td15\" class=\"the2px\"></td>\n        <td id=\"td16\" class=\"the2px\"></td>\n    </tr>   \n    \n    <tr>\n        <td>0</td>\n        <td>1</td>\n        <td>2</td>\n        <td>3</td>\n        <td>4</td>\n        <td>5</td>\n        <td>6</td>\n        <td>7</td>\n        <td>8</td>\n        <td>9</td>\n        <td>10</td>\n        <td>11</td>\n    </tr> \n    \n    <tr>\n        <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"v12\" class=\"thetemps\"></span><div id=\"t12\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"v13\" class=\"thetemps\"></span><div id=\"t13\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"v14\" class=\"thetemps\"></span><div id=\"t14\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"v15\" class=\"thetemps\"></span><div id=\"t15\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"v16\" class=\"thetemps\"></span><div id=\"t16\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"v17\" class=\"thetemps\"></span><div id=\"t17\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"v18\" class=\"thetemps\"></span><div id=\"t18\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"v19\" class=\"thetemps\"></span><div id=\"t19\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"v20\" class=\"thetemps\"></span><div id=\"t20\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"v21\" class=\"thetemps\"></span><div id=\"t21\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"v22\" class=\"thetemps\"></span><div id=\"t22\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"v23\" class=\"thetemps\"></span><div id=\"t23\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"td17\" class=\"the2px\"></td>\n        <td id=\"td18\" class=\"the2px\"></td>\n        <td id=\"td19\" class=\"the2px\"></td>\n        <td id=\"td20\" class=\"the2px\"></td>\n        <td id=\"td21\" class=\"the2px\"></td>\n        <td id=\"td22\" class=\"the2px\"></td>\n        <td id=\"td23\" class=\"the2px\"></td>\n        <td id=\"td24\" class=\"the2px\"></td>\n        <td id=\"td25\" class=\"the2px\"></td>\n        <td id=\"td26\" class=\"the2px\"></td>\n        <td id=\"td27\" class=\"the2px\"></td>\n        <td id=\"td28\" class=\"the2px\"></td>\n    </tr>  \n    \n    <tr>\n        <td>12</td>\n        <td>13</td>\n        <td>14</td>\n        <td>15</td>\n        <td>16</td>\n        <td>17</td>\n        <td>18</td>\n        <td>19</td>\n        <td>20</td>\n        <td>21</td>\n        <td>22</td>\n        <td>23</td>\n    </tr> \n    \n    <tr height=\"20px\">\n        <td colspan=2 bgcolor=\"#dddddd\" class=\"smallheadings\">Status:</td>\n\n        <td colspan=10 bgcolor=\"#dddddd\"><center><span id=\"info\" class=\"smallheadings\" >Ok</span></center></td>\n\n    </tr>\n    \n    <tr height=\"10px\">\n        <td colspan=\"12\"></td>\n    </tr>\n\n    <tr style=\"height:48px\">\n        <td colspan=2>\n            <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-left-double-2.png':'/myicons/png/48x48/actions/arrow-left-double-2.png'}}\" \n                              height=\"36px\"\n                />\n            </md-button> \n        </td>\n        \n        <td colspan=2><center><span id=\"current\" style=\"color:black;font-size:120%\">-</span></center></td>\n\n        <td colspan=2>\n            <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-right-double-2.png':'/myicons/png/48x48/actions/arrow-right-double-2.png'}}\" \n                              height=\"36px\"\n                />\n            </md-button> \n        </td>\n\n        <td colspan=2>\n            <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/edit-copy-4.png':'/myicons/png/48x48/actions/edit-copy-4.png'}}\" \n                              height=\"36px\"\n                />\n            </md-button> \n        </td>\n\n\n        <td colspan=2>\n            <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/document-save-5.png':'/myicons/png/48x48/actions/document-save-5.png'}}\" \n                              height=\"36px\"\n                />\n            </md-button> \n        </td>\n\n        <td colspan=2>\n            <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\"  ng-click=\"send({payload: 'c'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/dialog-cancel-5.png':'/myicons/png/48x48/actions/dialog-cancel-5.png'}}\" \n                              height=\"36px\"\n                />\n            </md-button> \n        </td>\n        <td colspan=1></td>\n    </tr>\n\n</table>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":400,"y":60,"wires":[["f365c4e6.baa378"]]},{"id":"f365c4e6.baa378","type":"function","z":"84e1670a.31e198","name":"Process controls","func":"if ( typeof context.days == 'undefined' ) context.days=1;\nif ( typeof context.selector == 'undefined' ) context.selector=1;\nif ( typeof context.saving == 'undefined' ) context.saving=0;\nif ( typeof context.global.timing == 'undefined' ) \n    {\n        context.global.timing=[\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        6,14\n                        ];\n        context.saving=0;                    \n    }\nvar timing=global.get(\"timing\");\n\nswitch (msg.payload)\n    {\n    case \"u\" :  if ((context.selector>4)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5]++; \n                    if (timing[((context.days-1)*24)+context.selector-5]>26) timing[((context.days-1)*24)+context.selector-5]=26;\n                    msg.foryou=\"Incremented temperature\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Incremented frost setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==2) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Incremented away setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==29) { if (context.days<7) { context.days++; msg.foryou=\"Forward one day\";} else msg.foryou=\"End of days!!\"; }\n                break;\n    case \"d\" :  if ((context.selector>4)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5]--; \n                    if (timing[((context.days-1)*24)+context.selector-5]<14) timing[((context.days-1)*24)+context.selector-5]=14;\n                    msg.foryou=\"Decremented temperature\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]>12) { timing[168+(context.selector-1)]--; msg.foryou=\"Decremented frost setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==2) { if (timing[168+(context.selector-1)]>12) { timing[168+(context.selector-1)]--; msg.foryou=\"Decremented away setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==29) { if (context.days>1) { context.days--;  msg.foryou=\"Backward one day\";} else msg.foryou=\"Beginning of days!!\";  }\n                break;\n    case 'r' :  if ((context.selector>=5)&&(context.selector<28))\n                        {\n                         timing[((context.days-1)*24)+context.selector-4]=timing[((context.days-1)*24)+context.selector-5];   \n                         context.selector++;\n                         msg.foryou=\"Copied settings to the next hour slot\";\n                        }\n                if ((context.selector==29)&&(context.days<7))\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                             timing[((context.days)*24)+a]=timing[((context.days-1)*24)+a];   \n                            }\n                         context.days++;\n                         msg.foryou=\"Copied a complete day's settings\";\n                        }\n                break;\n    case 's': context.saving=0;  msg.foryou=\"Settings saved to disk\"; break;\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '14':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29': context.selector=parseInt(msg.payload);\n               if (msg.payload=='1') msg.foryou=\"Frost temperature selection\"; \n               else if (msg.payload=='2') msg.foryou=\"Away temperature selection\";\n               else if (msg.payload=='29') msg.foryou=\"Day selection\";\n               else  msg.foryou=\"Selected hour period \" + (parseInt(msg.payload)-4);\n    break;\n    case 'c' : msg.payload=\"anything\";  msg.foryou=\"Changes cancelled\"; node.send([null,null,msg]);\n    }\n\nmsg.temperatures=context.temperatures;\nmsg.timing=timing;\nmsg.days=context.days;\nmsg.selector=context.selector;\n\nnode.send([msg,null,null]);\n\nif (context.saving===0) \n    { \n       msg.topic=\"\";\n        msg.timing=\"\";\n        msg.payload=JSON.stringify(timing);\n        node.send([null,msg,null]); \n        context.saving=1;\n    }\n    msg.foryou=\"\"","outputs":"3","noerr":0,"x":410,"y":179,"wires":[["d5edbef6.88fa8"],["a5084f66.8e9d4"],["18fcbc16.ee06a4"]]},{"id":"9dae3b76.aef5f8","type":"inject","z":"84e1670a.31e198","name":"Once only","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":130,"y":180,"wires":[["f365c4e6.baa378","18fcbc16.ee06a4"]]},{"id":"a0e6ed9c.b963a","type":"inject","z":"84e1670a.31e198","name":"Every minute","topic":"","payload":"","payloadType":"str","repeat":"60","crontab":"","once":false,"onceDelay":"","x":140,"y":440,"wires":[["b6f77b17.c86f68"]]},{"id":"b6f77b17.c86f68","type":"function","z":"84e1670a.31e198","name":"Process heat","func":"var timing=global.get(\"timing\");\nvar now = new Date();\nmsg.payload=timing[(now.getDay()*24)+now.getHours()];\nmsg.frost=timing[168];\nmsg.away=timing[169];\nnode.status({fill:\"blue\",shape:\"dot\",text:\"Set point \" + msg.payload + \"c\"});\nreturn msg;\n\n","outputs":1,"noerr":0,"x":370,"y":440,"wires":[[]]},{"id":"a5084f66.8e9d4","type":"file","z":"84e1670a.31e198","name":"backup","filename":"/home/pi/petesstatlog.log","appendNewline":true,"createDir":true,"overwriteFile":"true","x":780,"y":180,"wires":[[]]},{"id":"18fcbc16.ee06a4","type":"file in","z":"84e1670a.31e198","name":"Restore","filename":"/home/pi/petesstatlog.log","format":"utf8","x":300,"y":340,"wires":[["8deaca60.aee508"]]},{"id":"8deaca60.aee508","type":"function","z":"84e1670a.31e198","name":"Restore data from SD","func":"context.global.timing=JSON.parse(msg.payload);\nmsg.payload=\"\";\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":340,"wires":[["f365c4e6.baa378"]]},{"id":"e6fcff07.1882f","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":580,"y":520,"wires":[["156278b0.a81057"]]},{"id":"681a62dc.65038c","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":520,"wires":[]},{"id":"156278b0.a81057","type":"function","z":"1635ef5e.c89941","name":"n = !n","func":"flow.set(\"state\", !flow.get(\"state\") || false);\nmsg.payload = flow.get(\"state\");\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":520,"wires":[["681a62dc.65038c"]]},{"id":"2411d7a8.c2d728","type":"ui_template","z":"1635ef5e.c89941","group":"71ca3875.78c3d8","name":"OPEN-CLOSED SIGN","order":0,"width":"6","height":"2","format":"<md-button class=\"vibrate filled touched bigfont rounded\" style=\"background-color:#333333\" ng-click=\"send({payload: msg.payload })\"> \n\n\n<svg  width=\"260px\" height=\"90px\" version=\"1.1\" viewBox=\"0 0 800 200\">\n <g id=\"Button_Long\">\n  \n  <rect fill=\"#333333\" width=\"800\" height=\"200\"/>\n  <g ng-style=\"{fill: (msg.payload.set) ? 'lime' : 'red'}\">\n    <rect width=\"800\" height=\"200\" rx=\"80\" ry=\"80\"/>\n  </g>\n  \n  <rect fill=\"#333333\" x=\"11\" y=\"10\" width=\"778\" height=\"180\" rx=\"90\" ry=\"90\"/>\n  <g ng-style=\"{fill: (msg.payload.set) ? 'lime' : 'red'}\">\n      \n    <text x=\"400\" y=\"125\" style=\"text-anchor:middle\"  font-weight=\"bold\" font-size=\"80\" font-family=\"Arial\">{{msg.payload.set ? msg.payload.on : msg.payload.off}} </text>\n    </g>\n  </g>\n</svg>\n\n\n</md-button>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":600,"y":1680,"wires":[["83704243.0ed8a"]]},{"id":"83704243.0ed8a","type":"function","z":"1635ef5e.c89941","name":"n = !n","func":"flow.set(\"state\", !flow.get(\"state\") || false);\nmsg.payload = {...msg.payload, set: flow.get(\"state\")};\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":1600,"wires":[["4057a5d1.f39b4c","2411d7a8.c2d728"]]},{"id":"d18366da.a24188","type":"function","z":"1635ef5e.c89941","name":"set text button","func":"msg.payload = {\n    \"on\": \"Открыто\",\n    \"off\": \"Закрыто\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":1600,"wires":[["83704243.0ed8a"]]},{"id":"4057a5d1.f39b4c","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.set","targetType":"msg","x":820,"y":1600,"wires":[]},{"id":"40bcbc5d.47a764","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":1600,"wires":[["d18366da.a24188"]]},{"id":"330073fd.69e0dc","type":"function","z":"1635ef5e.c89941","name":"n = !n","func":"flow.set(\"state\", !flow.get(\"state\") || false);\nmsg.payload = flow.get(\"state\");\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":1480,"wires":[[]]},{"id":"d348ad2.8c7fb5","type":"function","z":"1635ef5e.c89941","name":"n = !n","func":"flow.set(\"state\", !flow.get(\"state\") || false);\n//Object.assign(msg.payload, {\"set\": flow.get(\"state\")})\nmsg.payload = {...msg.payload, set: flow.get(\"state\")};\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":1480,"wires":[[]]},{"id":"631b079a.0cfda8","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":1760,"wires":[["56c3bda0.e91d44"]]},{"id":"1720467b.363c9a","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":1800,"wires":[]},{"id":"924a2fcd.505e3","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":1880,"wires":[]},{"id":"2f2bdd55.54c102","type":"function","z":"1635ef5e.c89941","name":"spread","func":"msg.payload = {...msg.payload, set: 100};\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":1840,"wires":[["924a2fcd.505e3"]]},{"id":"56c3bda0.e91d44","type":"function","z":"1635ef5e.c89941","name":"create obj (send picture)","func":"msg.payload = {\n    \"chatId\": 123456789,\n    \"messageId\": 1,\n    \"type\": \"photo\",\n    \"content\": \"foo.jpeg\"\n}\n/* type can be one of the following\nphoto\naudio\nvideo\nsticker\nvoice\ndocument\n*/\n\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1800,"wires":[["2f2bdd55.54c102","1720467b.363c9a"]]},{"id":"1fb8488e.442757","type":"http request","z":"a8befc30.c457","name":"","method":"GET","ret":"bin","paytoqs":false,"url":"http://192.168.1.99/cgi-bin/snapshot.cgi","tls":"","proxy":"","authType":"basic","x":330,"y":60,"wires":[["970d2765.550a48"]]},{"id":"a67bf397.83501","type":"ui_template","z":"a8befc30.c457","group":"eb7f92d0.0d7fc","name":"Display image","order":1,"width":"0","height":"0","format":"<img width=\"816\" height=\"612\" alt=\"mjpeg test...\" src=\"data:image/jpg;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":712.3645515441895,"y":60.60416030883789,"wires":[[]]},{"id":"970d2765.550a48","type":"base64","z":"a8befc30.c457","name":"Encode","action":"","property":"payload","x":532.3645515441895,"y":60.60416030883789,"wires":[["a67bf397.83501"]]},{"id":"254fcc0c.9c10f4","type":"inject","z":"a8befc30.c457","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":112.36455154418945,"y":60.60416030883789,"wires":[["1fb8488e.442757"]]},{"id":"6eac677d.37b618","type":"http request","z":"7d67720.8972e9","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.8.1/api/webserver/SesTokInfo","tls":"","proxy":"","authType":"basic","x":190,"y":840,"wires":[["ccf54528.859688"]]},{"id":"36704bdf.cf2b64","type":"debug","z":"7d67720.8972e9","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":970,"y":820,"wires":[]},{"id":"ccf54528.859688","type":"xml","z":"7d67720.8972e9","name":"","property":"payload","attr":"","chr":"","x":330,"y":840,"wires":[["d596f964.fc6378"]]},{"id":"ab0b72a3.70f6d","type":"http request","z":"7d67720.8972e9","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.8.1/api/device/signal","tls":"","proxy":"","authType":"basic","x":550,"y":940,"wires":[["e1e4fc50.1043"]]},{"id":"d596f964.fc6378","type":"change","z":"7d67720.8972e9","name":"Cookies","rules":[{"t":"set","p":"cookies","pt":"msg","to":"payload.response.SesInfo[0]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":840,"wires":[["7aa9bde3.844254"]]},{"id":"3762b894.c6b598","type":"function","z":"7d67720.8972e9","name":"","func":"//var md5 = global.get('md5');\n//var sha256 = global.get('sha256');\n\n//var pass=sha256(msg.headers[\"x-ndm-challenge\"]+\n//md5(\"admin\"+\":\"+msg.headers[\"x-ndm-realm\"]+\":\"+\"xxx\"));\n\n//var headers={};\n//headers[\"__RequestVerificationToken\"]=(msg.payload.response.TokInfo[0]);\n//headers[\"Content-Type\"]=\"text/xml; charset=UTF-8\";\n\n//var cookies=msg.payload.response.SesInfo[0];\n//var cookies={};\n//cookies[\"SessionID\"][\"Path\"]=\"/\";\n//cookies[\"SessionID\"][\"Value\"].value=msg.payload.response.SesInfo[0].substring(10);\n\n//payload:{login:\"admin\", password:\"\"pass\"\"},\n//msg.payload.response.SesInfo[0]\n\nif(flow.get(\"session\")){\n    }else{\n        flow.set(\"session\",\"123\");\n}\n\nnewmsg={ \n    headers:{\n//        \"__RequestVerificationToken\": msg.payload.response.TokInfo[0],\n        \"Content-Type\":\"text/xml; charset=UTF-8\",\n        \"cookie\":flow.get(\"session\")\n        \n    },\npayload:\"\",\n //   cookies:{\"SessionID\":{\"Path\":\"/\",\"Value\":msg.payload.response.SesInfo[0].substring(10,147)}}\n\n}\n\nreturn newmsg;\n","outputs":1,"noerr":0,"x":350,"y":940,"wires":[["36704bdf.cf2b64","ab0b72a3.70f6d"]]},{"id":"bcb436bc.c35838","type":"xml","z":"7d67720.8972e9","name":"","property":"payload","attr":"","chr":"","x":870,"y":940,"wires":[[]]},{"id":"7aa9bde3.844254","type":"change","z":"7d67720.8972e9","name":"","rules":[{"t":"set","p":"session","pt":"flow","to":"msg.payload.response.SesInfo[0]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":840,"wires":[[]]},{"id":"e1e4fc50.1043","type":"switch","z":"7d67720.8972e9","name":"Error","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"error","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":940,"wires":[["36704bdf.cf2b64","6eac677d.37b618"],["bcb436bc.c35838"]]},{"id":"3c3afd4f.b3a7f2","type":"inject","z":"7d67720.8972e9","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":190,"y":940,"wires":[["3762b894.c6b598"]]},{"id":"2a56d36a.05052c","type":"function","z":"1635ef5e.c89941","name":"","func":"var o = { then: function(){return 5} };\n// связать `v` через `[[Prototype]]` с `o`\nvar v = Object.create( o );\nv.someStuff = \"cool\";\n\nv.otherStuff = \"not so cool\";\n\n\nmsg.payload = v.then();\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":2080,"wires":[["e640feb9.a3898"]]},{"id":"e640feb9.a3898","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":860,"y":2080,"wires":[]},{"id":"1dc2f1da.15c51e","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":440,"y":2080,"wires":[["2a56d36a.05052c"]]},{"id":"24302885.abf958","type":"http in","z":"a8befc30.c457","name":"","url":"/products","method":"get","upload":false,"swaggerDoc":"","x":82.36455154418945,"y":200.6041603088379,"wires":[["bdf1042b.f0a278"]]},{"id":"63b86b28.c6a6e4","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":782.3645515441895,"y":200.6041603088379,"wires":[]},{"id":"bdf1042b.f0a278","type":"file in","z":"a8befc30.c457","name":"products","filename":"C:\\OpenServer\\domains\\react\\primer-api\\products\\products.data","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":292.36455154418945,"y":200.6041603088379,"wires":[["3fe357bc.ee53d8"]]},{"id":"3fe357bc.ee53d8","type":"json","z":"a8befc30.c457","name":"","property":"payload","action":"","pretty":false,"x":462.36455154418945,"y":200.6041603088379,"wires":[["63b86b28.c6a6e4","b37d79fb.6e6848"]]},{"id":"b37d79fb.6e6848","type":"http response","z":"a8befc30.c457","name":"","statusCode":"","headers":{},"x":782.3645515441895,"y":140.6041603088379,"wires":[]},{"id":"8e30e19a.34e2a","type":"http in","z":"a8befc30.c457","name":"","url":"/hello-form","method":"get","upload":false,"swaggerDoc":"","x":92.36455154418945,"y":280.6041603088379,"wires":[["3befc5dc.6641ea"]]},{"id":"1f0ea173.c32b3f","type":"http in","z":"a8befc30.c457","name":"","url":"/hello-form","method":"post","swaggerDoc":"","x":92.36455154418945,"y":360.6041603088379,"wires":[["94fc7661.cd71c8"]]},{"id":"3befc5dc.6641ea","type":"template","z":"a8befc30.c457","name":"page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n    <head></head>\n    <body>\n        <h1>Hello {{ payload.name }}!</h1>\n        <form id=\"form\" action=\"http://localhost:1880/hello-form\" method=\"post\">\n            <input id=\"a1\" name=\"name\" value={{ payload.name }}>\n            <button>Say hello</button>\n        </form>\n    </body>\n</html>","x":502.36455154418945,"y":360.6041603088379,"wires":[["e741bf87.5a50e"]]},{"id":"e741bf87.5a50e","type":"http response","z":"a8befc30.c457","name":"","x":722.3645515441895,"y":360.6041603088379,"wires":[]},{"id":"94fc7661.cd71c8","type":"function","z":"a8befc30.c457","name":"stupid","func":"msg.payload.name = \"stupid \" + msg.payload.name\nreturn msg;","outputs":1,"noerr":0,"x":282.36455154418945,"y":360.6041603088379,"wires":[["3befc5dc.6641ea"]]},{"id":"a012e4ca.1e6318","type":"template","z":"a8befc30.c457","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<form id=\"formElem\">\n  <input type=\"text\" name=\"name\" value=\"John\">\n  <input type=\"text\" name=\"surname\" value=\"Smith\">\n  <input type=\"submit\">\n</form>\n\n<script>\nformElem.onsubmit = async (e) => { \n    e.preventDefault(); \nlet response = await fetch('/post/user', {\n    method: 'POST',\n    contentType : \"application/json\",\n    body: new FormData(formElem)\n});\n\nreturn await response.json()}\n</script>\n\n","output":"str","x":492.36455154418945,"y":460.6041603088379,"wires":[["5086eca8.debae4"]]},{"id":"c075de0d.23fe7","type":"http in","z":"a8befc30.c457","name":"","url":"/form","method":"get","upload":false,"swaggerDoc":"","x":272.36455154418945,"y":460.6041603088379,"wires":[["a012e4ca.1e6318"]]},{"id":"5086eca8.debae4","type":"http response","z":"a8befc30.c457","name":"","statusCode":"","headers":{},"x":742.3645515441895,"y":460.6041603088379,"wires":[]},{"id":"bdb4fbcd.be8308","type":"http in","z":"a8befc30.c457","name":"","url":"/post/user","method":"post","upload":false,"swaggerDoc":"","x":492.36455154418945,"y":540.6041603088379,"wires":[["5086eca8.debae4","14e1bb47.7bcee5"]]},{"id":"b7d004b3.0a12d8","type":"nbrowser","z":"a8befc30.c457","name":"","methods":[{"name":"gotoURL","func":"goto","params":[{"type":"msg","value":"payload","typeDefault":"str"}]},{"name":"wait","func":"wait","params":[{"type":"str","value":"3","typeDefault":"str"}]},{"name":"select","func":"select","params":[{"type":"str","value":"#formElem > input[type=text]:nth-child(1)","typeDefault":"str"},{"type":"str","value":"","typeDefault":"str"}]},{"name":"insert","func":"insert","params":[{"type":"str","value":"#formElem > input[type=text]:nth-child(1)","typeDefault":"str"},{"type":"str","value":"Garry","typeDefault":"str"}]},{"name":"wait","func":"wait","params":[{"type":"str","value":"1","typeDefault":"str"}]},{"name":"select","func":"select","params":[{"type":"str","value":"#formElem > input[type=text]:nth-child(2)","typeDefault":"str"},{"type":"str","value":"","typeDefault":"str"}]},{"name":"insert","func":"insert","params":[{"type":"str","value":"#formElem > input[type=text]:nth-child(2)","typeDefault":"str"},{"type":"str","value":"Potter","typeDefault":"str"}]},{"name":"click","func":"click","params":[{"type":"str","value":"#formElem > input[type=submit]:nth-child(3)","typeDefault":"str"}]},{"name":"wait","func":"wait","params":[{"type":"str","value":"5","typeDefault":"str"}]}],"prop":"nbrowser","propout":"payload","object":"msg","objectout":"msg","close":true,"show":true,"ssl":false,"outputs":0,"x":700,"y":700,"wires":[]},{"id":"5d55f12c.6e17","type":"inject","z":"a8befc30.c457","name":"","topic":"","payload":"http://localhost:1880/form","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":700,"wires":[["b7d004b3.0a12d8"]]},{"id":"14e1bb47.7bcee5","type":"split","z":"a8befc30.c457","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":702.3645515441895,"y":540.6041603088379,"wires":[["36d28905.ec7e36"]]},{"id":"36d28905.ec7e36","type":"switch","z":"a8befc30.c457","name":"","property":"payload","propertyType":"msg","rules":[{"t":"index","v":"3","vt":"num","v2":"3","v2t":"num"},{"t":"index","v":"7","vt":"num","v2":"7","v2t":"num"}],"checkall":"true","repair":false,"outputs":2,"x":462.36455154418945,"y":620.6041603088379,"wires":[["faccdf7c.fb6f2"],["faccdf7c.fb6f2"]]},{"id":"ebd2e167.9e7c","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":922.3645515441895,"y":620.6041603088379,"wires":[]},{"id":"faccdf7c.fb6f2","type":"function","z":"a8befc30.c457","name":"Buffer","func":"msg.payload = Buffer.from(msg.payload);\nmsg.payload = msg.payload.toString().trim();\nreturn msg;\n","outputs":1,"noerr":0,"x":702.3645515441895,"y":620.6041603088379,"wires":[["ebd2e167.9e7c"]]},{"id":"ad3f74cc.9729b8","type":"color-convert","z":"a8befc30.c457","input":"hsv","output":"rgb","outputType":"object","scaleInput":false,"x":610,"y":840,"wires":[["e389f6db.d41ab8","e50e7777.49e4e8"]]},{"id":"236d176e.ef5c78","type":"inject","z":"a8befc30.c457","name":"","topic":"","payload":"{\"h\":6,\"s\":80,\"v\":100}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":960,"wires":[["7944dc5d.1922c4","817b7d94.32efa"]]},{"id":"e389f6db.d41ab8","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":990,"y":840,"wires":[]},{"id":"7944dc5d.1922c4","type":"function","z":"a8befc30.c457","name":"new array from data","func":"var msg1 = {payload: Object.entries(msg.payload).map(([,item]) => item)};\nreturn msg1;","outputs":1,"noerr":0,"x":400,"y":840,"wires":[["ad3f74cc.9729b8"]]},{"id":"e50e7777.49e4e8","type":"function","z":"a8befc30.c457","name":"split RGB","func":"let red = { payload: msg.payload.red };\nlet green = { payload: msg.payload.green };\nlet blue = { payload: msg.payload.blue };\nreturn [red, green, blue];","outputs":3,"noerr":0,"x":620,"y":960,"wires":[["2114d77e.7cea28"],["7d8e27a5.cad1f8"],["ce6b6632.8140f8"]]},{"id":"7566731a.24aa2c","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":900,"wires":[]},{"id":"6b8c53d7.f0545c","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":960,"wires":[]},{"id":"d020f59d.c59378","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":1020,"wires":[]},{"id":"ce6b6632.8140f8","type":"function","z":"a8befc30.c457","name":"BLUE","func":"msg.payload = Math.round(msg.payload/2.55);\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":1020,"wires":[["d020f59d.c59378"]]},{"id":"2114d77e.7cea28","type":"function","z":"a8befc30.c457","name":"RED","func":"msg.payload = Math.round(msg.payload/2.55);\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":900,"wires":[["7566731a.24aa2c"]]},{"id":"7d8e27a5.cad1f8","type":"function","z":"a8befc30.c457","name":"GREEN","func":"msg.payload = Math.round(msg.payload/2.55);\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":960,"wires":[["6b8c53d7.f0545c"]]},{"id":"817b7d94.32efa","type":"function","z":"a8befc30.c457","name":"","func":"msg.payload = Array.from({x:1,y:2,z:3})\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":1100,"wires":[["6f1979ee.ffc6c8"]]},{"id":"6f1979ee.ffc6c8","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1000,"y":1120,"wires":[]},{"id":"504bcd0f.461304","type":"batch","z":"a8befc30.c457","name":"","mode":"concat","count":10,"overlap":0,"interval":10,"allowEmptySequence":false,"topics":[{"topic":"1"},{"topic":"2"}],"x":610,"y":1300,"wires":[["d567d99.1d7ea28"]]},{"id":"4985f42a.a7da1c","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":1240,"wires":[]},{"id":"944ebba5.04e198","type":"split","z":"a8befc30.c457","name":"","splt":"1","spltType":"len","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":490,"y":1240,"wires":[["504bcd0f.461304"]]},{"id":"db7c531.48ac1b","type":"join","z":"a8befc30.c457","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":"false","timeout":"","count":"","reduceRight":false,"x":850,"y":1300,"wires":[["4985f42a.a7da1c"]]},{"id":"d567d99.1d7ea28","type":"sort","z":"a8befc30.c457","name":"","order":"ascending","as_num":true,"target":"","targetType":"seq","msgKey":"","msgKeyType":"elem","seqKey":"payload","seqKeyType":"msg","x":730,"y":1240,"wires":[["db7c531.48ac1b"]]},{"id":"93586062.7988a","type":"change","z":"a8befc30.c457","name":"6239","rules":[{"t":"set","p":"topic","pt":"msg","to":"2","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"6239","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":1280,"wires":[["944ebba5.04e198"]]},{"id":"b96149b6.b195a8","type":"change","z":"a8befc30.c457","name":"51784","rules":[{"t":"set","p":"topic","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"51784","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":1200,"wires":[["944ebba5.04e198"]]},{"id":"befb0ddc.31f47","type":"inject","z":"a8befc30.c457","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":1240,"wires":[["b96149b6.b195a8","93586062.7988a"]]},{"id":"15f3ec80.6983f4","type":"exec","z":"a8befc30.c457","command":"\"C:/Program Files/MKVToolNix\\mkvmerge.exe\"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"mkvtoolnix","x":810,"y":1680,"wires":[["9a4e3334.c9a64"],[],[]]},{"id":"104a8927.1b2f27","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":470,"y":1540,"wires":[]},{"id":"9d99293.a3741d8","type":"template","z":"a8befc30.c457","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"--ui-language ru --output ^\"C:\\\\home\\\\{{payload}}^\" --no-audio --language 0:und ^\"^(^\" ^\"C:\\\\home\\\\00_Трейлер^(1^).mp4^\" ^\"^)^\"","output":"str","x":700,"y":2020,"wires":[["744e9b19.362dd4"]]},{"id":"62f4a37d.cff73c","type":"watch","z":"a8befc30.c457","name":"","files":"C:\\\\home","recursive":"","x":100,"y":1500,"wires":[["937c57c4.918928"]]},{"id":"70dc72fc.a2220c","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":470,"y":1600,"wires":[]},{"id":"937c57c4.918928","type":"function","z":"a8befc30.c457","name":"select name","func":"const reg = /([^\\\\]+$)/;\nvar msg1, msg2;\nif (flow.get(\"nameFile\") === msg.payload) {\n    msg1 = { payload: \"load\"};\n    msg2 = { payload: msg.payload.match(reg)[0]};\n} \nelse flow.set(\"nameFile\", msg.payload)\nreturn [msg, msg1, msg2];","outputs":3,"noerr":0,"x":230,"y":1600,"wires":[["104a8927.1b2f27"],["70dc72fc.a2220c"],["68e75151.9e906","38294a8f.c00e06","282c27ea.0bca38"]]},{"id":"68e75151.9e906","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":470,"y":1660,"wires":[]},{"id":"744e9b19.362dd4","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":930,"y":2020,"wires":[]},{"id":"9a4e3334.c9a64","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1040,"y":1700,"wires":[]},{"id":"151b9371.6d09dd","type":"split","z":0,"name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":230,"y":180,"wires":[["35b2653e.efdfba"]]},{"id":"39d59c22.c1d154","type":"inject","z":0,"name":"","topic":"","payload":"{\"script\":\"espdata\",\"idesp\":\"ESP826600d30a89\",\"hostname\":\"Power\",\"dhtt1\":\"27.7\",\"dhth1\":\"66.5\",\"pmv\":\"206.6\",\"pmc\":\"1.14\",\"pmw\":\"219\",\"pmwh\":\"3025526\",\"uptime\":\"53700\",\"errconn\":\"2\",\"wanip\":\"192.168.1.204\",\"freemem\":\"34768\",\"ver\":\"0.1.1_23:59:46_26.05.2018\",\"vdd\":\"3330\",\"rssi\":\"-55\",\"gpio4\":\"1\",\"gpio12\":\"1\",\"gpio13\":\"0\",\"gpioint1\":\"0\",\"gpioint2\":\"0\",\"gpioint3\":\"0\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":100,"wires":[["151b9371.6d09dd"]]},{"id":"9375657f.e38318","type":"debug","z":0,"name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":910,"y":180,"wires":[]},{"id":"35b2653e.efdfba","type":"change","z":0,"name":"Ставим топик на место","rules":[{"t":"set","p":"topic","pt":"msg","to":"parts.key","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":180,"wires":[["3988213f.655bfe"]]},{"id":"3988213f.655bfe","type":"change","z":0,"name":"Добавляем мыло и имя","rules":[{"t":"set","p":"topic","pt":"msg","to":"'мыло/имя/что-угодно/' & topic","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":180,"wires":[["9375657f.e38318"]]},{"id":"f0458d46.3bfeb","type":"split","z":0,"name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"topic","x":410,"y":320,"wires":[["a0e70be8.e0dc88"]]},{"id":"a4e24d19.2e243","type":"inject","z":0,"name":"","topic":"","payload":"{\"script\":\"espdata\",\"idesp\":\"ESP826600d30a89\",\"hostname\":\"Power\",\"dhtt1\":\"27.7\",\"dhth1\":\"66.5\",\"pmv\":\"206.6\",\"pmc\":\"1.14\",\"pmw\":\"219\",\"pmwh\":\"3025526\",\"uptime\":\"53700\",\"errconn\":\"2\",\"wanip\":\"192.168.1.204\",\"freemem\":\"34768\",\"ver\":\"0.1.1_23:59:46_26.05.2018\",\"vdd\":\"3330\",\"rssi\":\"-55\",\"gpio4\":\"1\",\"gpio12\":\"1\",\"gpio13\":\"0\",\"gpioint1\":\"0\",\"gpioint2\":\"0\",\"gpioint3\":\"0\"}","payloadType":"json","repeat":"","crontab":"","once":false,"x":279,"y":319.99999713897705,"wires":[["f0458d46.3bfeb"]]},{"id":"a0e70be8.e0dc88","type":"change","z":0,"name":"Добавляем мыло и имя","rules":[{"t":"set","p":"topic","pt":"msg","to":"'мыло/имя/что-угодно/' & topic","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":599.9999923706055,"y":320.9998960494995,"wires":[["cb4a319e.d3a05"]]},{"id":"cb4a319e.d3a05","type":"debug","z":0,"name":"","active":true,"console":false,"complete":"payload","x":823.9999923706055,"y":320.9998960494995,"wires":[]},{"id":"bdf1a946.99b858","type":"inject","z":0,"name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"x":150,"y":420,"wires":[["6c76a4d2.14cfbc"]]},{"id":"c603f94c.444dc8","type":"change","z":0,"name":"!payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"$not(payload)\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":420,"wires":[["e662a403.7ad878"]]},{"id":"2c840e01.772242","type":"debug","z":0,"name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":420,"wires":[]},{"id":"e662a403.7ad878","type":"change","z":0,"name":"","rules":[{"t":"set","p":"trigger","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":420,"wires":[["2c840e01.772242"]]},{"id":"6c76a4d2.14cfbc","type":"change","z":0,"name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"trigger","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":420,"wires":[["c603f94c.444dc8"]]},{"id":"8cbbfbcc.151b68","type":"inject","z":0,"name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"x":270,"y":500,"wires":[["4cd2d491.aba4bc"]]},{"id":"4cd2d491.aba4bc","type":"change","z":0,"name":"trigger","rules":[{"t":"set","p":"trigger","pt":"flow","to":"$not($flowContext(\"trigger\"))\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":500,"wires":[["772abef5.df75a"]]},{"id":"93c6daa7.cb64d8","type":"debug","z":0,"name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":950,"y":500,"wires":[]},{"id":"772abef5.df75a","type":"change","z":0,"name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"trigger","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":500,"wires":[["93c6daa7.cb64d8"]]},{"id":"a852332d.cc854","type":"change","z":"a8befc30.c457","name":"","rules":[{"t":"set","p":"names","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":1840,"wires":[["6dfa48ab.db57d8"]]},{"id":"87bbdbad.81d288","type":"inject","z":"a8befc30.c457","name":"","topic":"","payload":"[\"Первый\",\"Второй\"]","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":1680,"wires":[["a852332d.cc854"]]},{"id":"abdc7979.e1e558","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":1920,"wires":[]},{"id":"a8511e42.cb6f","type":"switch","z":"a8befc30.c457","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"name","vt":"flow"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":490,"y":1940,"wires":[["abdc7979.e1e558"],["4ead8fed.80cf","9d99293.a3741d8"]]},{"id":"6dfa48ab.db57d8","type":"split","z":"a8befc30.c457","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":430,"y":1840,"wires":[["a8511e42.cb6f"]]},{"id":"4ead8fed.80cf","type":"debug","z":"a8befc30.c457","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":1960,"wires":[]},{"id":"38294a8f.c00e06","type":"change","z":"a8befc30.c457","name":"","rules":[{"t":"set","p":"name","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":1760,"wires":[[]]},{"id":"282c27ea.0bca38","type":"delay","z":"a8befc30.c457","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":240,"y":1760,"wires":[["a852332d.cc854"]]},{"id":"dccd95e8.92be68","type":"function","z":"cd14cf16.4492f","name":"Input","func":"//Input\nvar typeInput0=msg.payload.linked_peri[msg.topic].inputs[0].type;\nvar typeInput1=msg.payload.linked_peri[msg.topic].inputs[1].type;\nvar typeInput2=msg.payload.linked_peri[msg.topic].inputs[2].type;\nvar typeInput3=msg.payload.linked_peri[msg.topic].inputs[3].type;\n\nif (typeInput0==\"DIGITAL\")\n{\n global.set(\"P\"+msg.topic+\"_In0\",msg.payload.linked_peri[msg.topic].inputs[0].raw_value)   \n}\nif (typeInput1==\"DIGITAL\")\n{\n global.set(\"P\"+msg.topic+\"_In0\",msg.payload.linked_peri[msg.topic].inputs[1].raw_value)   \n}\nif (typeInput2==\"DIGITAL\")\n{\n global.set(\"P\"+msg.topic+\"_In0\",msg.payload.linked_peri[msg.topic].inputs[2].raw_value)   \n}\nif (typeInput3==\"DIGITAL\")\n{\n global.set(\"P\"+msg.topic+\"_In0\",msg.payload.linked_peri[msg.topic].inputs[3].raw_value)   \n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":140,"wires":[[]]},{"id":"71baa958.bda0b8","type":"exec","z":"1b3418b8.8a5b07","command":"service rfpi status","addpay":false,"append":"","useSpawn":"false","timer":"5","oldrc":false,"name":"","x":210,"y":200,"wires":[[],[],["28d7f8cb.72b7f8"]]},{"id":"1ba5116e.8951df","type":"comment","z":"1b3418b8.8a5b07","name":"Diagnostica demone","info":"0 comando eseguito, servizio in run\n3 comando non eseguito, servizio dead","x":390,"y":60,"wires":[]},{"id":"1297b6f1.fddfd9","type":"function","z":"cd14cf16.4492f","name":"Output","func":"//Output\nglobal.set(\"P\"+msg.topic+\"_Out0\",msg.payload.linked_peri[msg.topic].outputs[0].raw_value)\nglobal.set(\"P\"+msg.topic+\"_Out1\",msg.payload.linked_peri[msg.topic].outputs[1].raw_value)\n\n","outputs":1,"noerr":0,"x":470,"y":200,"wires":[[]]},{"id":"955b9539.3d10d8","type":"function","z":"cd14cf16.4492f","name":"General","func":"//General Data\nglobal.set(\"P\"+msg.topic+\"_Name\",msg.payload.linked_peri[msg.topic].name)\nglobal.set(\"P\"+msg.topic+\"_Address\",msg.payload.linked_peri[msg.topic].hex_address)\nglobal.set(\"P\"+msg.topic+\"_Fw\",msg.payload.linked_peri[msg.topic].fw_version)\nglobal.set(\"P\"+msg.topic+\"_StatusLink\",msg.payload.linked_peri[msg.topic].status_link)\n","outputs":1,"noerr":0,"x":480,"y":80,"wires":[[]]},{"id":"7f9f1df1.275cd4","type":"file in","z":"3878b8f7.1c3218","name":"","filename":"/etc/rfpi/fifo/fifoperipheraljson","format":"utf8","chunk":false,"sendError":false,"x":360,"y":160,"wires":[["b34178b3.57c888"]]},{"id":"b34178b3.57c888","type":"json","z":"3878b8f7.1c3218","name":"","property":"payload","action":"","pretty":false,"x":590,"y":160,"wires":[[]]},{"id":"b62714f6.3c08c8","type":"catch","z":"3878b8f7.1c3218","name":"","scope":["7f9f1df1.275cd4","b34178b3.57c888"],"x":590,"y":240,"wires":[[]]},{"id":"575f68a5.1aad88","type":"file","z":"47939922.b824d8","name":"","filename":"/etc/rfpi/fifo/fifoguicmd","appendNewline":false,"createDir":false,"overwriteFile":"true","x":780,"y":160,"wires":[[]]},{"id":"d9fa8e71.2b0a8","type":"catch","z":"47939922.b824d8","name":"","scope":[],"x":510,"y":220,"wires":[[]]},{"id":"f0c798fc.d3aaf8","type":"function","z":"47939922.b824d8","name":"Cmd","func":"if (msg.topic==\"rename\")\n{\nmsg.payload= \"NAME PERI \"+msg.payload+\" \"+msg.address+\" \"\n}\nif (msg.topic==\"Out0\")\n{\nmsg.payload= \"PERIOUT \"+msg.address+\" 0 \"+msg.payload+\" \"\n}\nif (msg.topic==\"Out1\")\n{\nmsg.payload= \"PERIOUT \"+msg.address+\" 1 \"+msg.payload+\" \"\n}\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":160,"wires":[["575f68a5.1aad88"]]},{"id":"bd5d8129.03a88","type":"delay","z":"47939922.b824d8","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"0.1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":160,"wires":[["f0c798fc.d3aaf8"]]},{"id":"28d7f8cb.72b7f8","type":"switch","z":"1b3418b8.8a5b07","name":"","property":"payload.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":390,"y":220,"wires":[["e006e4af.053618"],["5cf78393.9e69ec"]]},{"id":"5cf78393.9e69ec","type":"change","z":"1b3418b8.8a5b07","name":"","rules":[{"t":"set","p":"DemoneStatus","pt":"global","to":"inactive","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":280,"wires":[[]]},{"id":"e006e4af.053618","type":"change","z":"1b3418b8.8a5b07","name":"","rules":[{"t":"set","p":"DemoneStatus","pt":"global","to":"active","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":160,"wires":[[]]},{"id":"9c0b5132.2249a","type":"switch","z":"47939922.b824d8","name":"","property":"DemoneStatus","propertyType":"global","rules":[{"t":"eq","v":"active","vt":"str"},{"t":"eq","v":"inactive","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":170,"y":160,"wires":[["bd5d8129.03a88"],["bd5d8129.03a88"]]},{"id":"4935f050.8baea","type":"inject","z":"67731296.6f183c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":220,"wires":[["159c0c70.36de54"]]},{"id":"4bc746cb.b79ef8","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":750,"y":220,"wires":[]},{"id":"4438a79c.82c768","type":"complete","z":"67731296.6f183c","name":"","scope":["4bc746cb.b79ef8"],"uncaught":false,"x":340,"y":360,"wires":[["b1e6408.dcdd6c","a8e46313.3c1ef"]]},{"id":"6ce441d6.141d5","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":790,"y":440,"wires":[]},{"id":"159c0c70.36de54","type":"trigger","z":"67731296.6f183c","op1":"1","op2":"0","op1type":"num","op2type":"num","duration":"5","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":480,"y":180,"wires":[["4bc746cb.b79ef8"]]},{"id":"b1e6408.dcdd6c","type":"function","z":"67731296.6f183c","name":"+10","func":"msg.payload = +msg.payload + 10;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":400,"wires":[["6ce441d6.141d5"]]},{"id":"a8e46313.3c1ef","type":"rbe","z":"67731296.6f183c","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":560,"y":540,"wires":[["fa1bdf0a.ffe17"]]},{"id":"fa1bdf0a.ffe17","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":780,"y":600,"wires":[]},{"id":"23b5f0ac.1c0d4","type":"inject","z":"67731296.6f183c","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":520,"wires":[["a8e46313.3c1ef"]]},{"id":"75397d66.0f3934","type":"inject","z":"67731296.6f183c","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":580,"wires":[["a8e46313.3c1ef"]]},{"id":"7d86ef2a.d33d","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":700,"wires":[]},{"id":"a7fcfc79.cd53","type":"change","z":"67731296.6f183c","name":"+1","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":700,"wires":[["f12d1bad.eff588","a787a59b.fa9118","5960bda6.e03424"]]},{"id":"5dc3de04.5e2ec","type":"inject","z":"67731296.6f183c","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":700,"wires":[["a7fcfc79.cd53","25e9ac4e.4f16e4"]]},{"id":"25e9ac4e.4f16e4","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":350,"y":840,"wires":[]},{"id":"f12d1bad.eff588","type":"change","z":"67731296.6f183c","name":"+1","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":700,"wires":[["7d86ef2a.d33d"]]},{"id":"a787a59b.fa9118","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":840,"wires":[]},{"id":"c0cd5178.d7cf8","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":780,"wires":[]},{"id":"5960bda6.e03424","type":"change","z":"67731296.6f183c","name":"+1","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":780,"wires":[["c0cd5178.d7cf8"]]},{"id":"2581601f.a8f0c","type":"change","z":"67731296.6f183c","name":"","rules":[{"t":"set","p":"payload","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":1120,"wires":[["1e511f62.22bfc1","6d7d48ac.9ed428","76d76af7.49ad44"]]},{"id":"24e6188f.98a178","type":"inject","z":"67731296.6f183c","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":1120,"wires":[["2581601f.a8f0c","10634731.927759"]]},{"id":"10634731.927759","type":"debug","z":"67731296.6f183c","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":380,"y":1220,"wires":[]},{"id":"1e511f62.22bfc1","type":"debug","z":"67731296.6f183c","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":590,"y":1220,"wires":[]},{"id":"d1a02082.62156","type":"debug","z":"67731296.6f183c","name":"4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":950,"y":1080,"wires":[]},{"id":"f7de701f.2b351","type":"debug","z":"67731296.6f183c","name":"3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":950,"y":1160,"wires":[]},{"id":"6d7d48ac.9ed428","type":"change","z":"67731296.6f183c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1160,"wires":[["f7de701f.2b351"]]},{"id":"76d76af7.49ad44","type":"change","z":"67731296.6f183c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":1080,"wires":[["e6cb982d.d48e08","daff6899.15c088"]]},{"id":"41954133.74a5","type":"change","z":"67731296.6f183c","name":"set 30","rules":[{"t":"set","p":"payload","pt":"flow","to":"30","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":1400,"wires":[["55be892d.a31aa8","f95115.4d42fee8"]]},{"id":"3af47a74.23e896","type":"inject","z":"67731296.6f183c","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":1400,"wires":[["74184a00.963e84","41954133.74a5"]]},{"id":"74184a00.963e84","type":"debug","z":"67731296.6f183c","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":270,"y":1500,"wires":[]},{"id":"1ef4ad6a.c470e3","type":"debug","z":"67731296.6f183c","name":"3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":910,"y":1440,"wires":[]},{"id":"b873b147.0f2d3","type":"debug","z":"67731296.6f183c","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":910,"y":1360,"wires":[]},{"id":"e6cb982d.d48e08","type":"change","z":"67731296.6f183c","name":"+1","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":1080,"wires":[["d1a02082.62156"]]},{"id":"a77cdc89.eef69","type":"change","z":"67731296.6f183c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1360,"wires":[["b873b147.0f2d3"]]},{"id":"5740ea68.9bd194","type":"change","z":"67731296.6f183c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1440,"wires":[["1ef4ad6a.c470e3"]]},{"id":"daff6899.15c088","type":"debug","z":"67731296.6f183c","name":"Last","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":690,"y":980,"wires":[]},{"id":"93012d16.98b7d","type":"change","z":"67731296.6f183c","name":"+1","rules":[{"t":"set","p":"payload","pt":"msg","to":"$flowContext(\"payload\")\t+ 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":1640,"wires":[["89e690a9.ef5e3"]]},{"id":"d84f81c.5a8ea8","type":"inject","z":"67731296.6f183c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":440,"y":1640,"wires":[["93012d16.98b7d"]]},{"id":"9d52ca6f.5f4968","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":950,"y":1640,"wires":[]},{"id":"89e690a9.ef5e3","type":"change","z":"67731296.6f183c","name":"+1","rules":[{"t":"set","p":"payload","pt":"flow","to":"$flowContext(\"payload\")\t+ 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":1640,"wires":[["9d52ca6f.5f4968"]]},{"id":"f95115.4d42fee8","type":"change","z":"67731296.6f183c","name":"+1","rules":[{"t":"set","p":"payload","pt":"flow","to":"$flowContext(\"payload\")\t+ 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":1440,"wires":[["5740ea68.9bd194"]]},{"id":"55be892d.a31aa8","type":"change","z":"67731296.6f183c","name":"+1","rules":[{"t":"set","p":"payload","pt":"flow","to":"$flowContext(\"payload\")\t+ 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":1360,"wires":[["a77cdc89.eef69"]]},{"id":"765028f0.6e3498","type":"http in","z":"6378da21.c9a314","name":"","url":"/translate","method":"get","upload":false,"swaggerDoc":"","x":130,"y":140,"wires":[["14fb0646.ebb6ca"]]},{"id":"f9e5d8d4.47e958","type":"http response","z":"6378da21.c9a314","name":"","statusCode":"","headers":{"Access-Control-Allow-Origin":"*"},"x":610,"y":140,"wires":[]},{"id":"f02b5eff.4da6e","type":"inject","z":"6378da21.c9a314","name":"","topic":"","payload":"{\"text\":\"[1+2]\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":240,"wires":[["14fb0646.ebb6ca"]]},{"id":"c7d01b9c.7562b8","type":"debug","z":"6378da21.c9a314","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":240,"wires":[]},{"id":"14fb0646.ebb6ca","type":"Blockly","z":"6378da21.c9a314","language":"en","func":"var message;\n\n\nmessage = (msg['payload']['text']);\n// Remove [ and/or ]\nif (message.charAt(0) == '[') {\n  message = message.slice(1, message.length);\n}\nif (message.slice(-1) == ']') {\n  message = message.slice(0, message.length - 1);\n}\n// Use eval to process the message\nmessage = String(eval(message));\n// Re-package result to pass back to Scratch 3\nmessage = ['{\"result\":\"',message,'\"}'].join('');\nmsg['payload'] = message;\nreturn msg;\n","workspaceXml":"<xml xmlns=\"http://www.w3.org/1999/xhtml\"><variables><variable type=\"\" id=\"tRt)J6ju,#c{x[U1pP.I\">message</variable></variables><block type=\"variables_set\" id=\"1#8[z=8c+=_~=Q0ULr#K\" x=\"-462\" y=\"-212\"><field name=\"VAR\" id=\"tRt)J6ju,#c{x[U1pP.I\" variabletype=\"\">message</field><value name=\"VALUE\"><block type=\"node_object_get\" id=\"}Lha(ev5jipd*2wwf|9t\"><mutation action=\"GET\"></mutation><field name=\"action\">GET</field><value name=\"object\"><shadow type=\"node_msg\" id=\"?5)PeuSYW/w|6npl8soI\"></shadow></value><value name=\"field_name\"><shadow type=\"text\" id=\"+?KfAUp_a6($,t/G+LYe\"><field name=\"TEXT\">payload.text</field></shadow></value></block></value><next><block type=\"misc_comment\" id=\"WIRVzXH+hmlI*+.9d@KW\"><value name=\"TEXT\"><shadow type=\"text\" id=\"G-BR-,XLXr{67lem9w#q\"><field name=\"TEXT\">Remove [ and/or ]</field></shadow></value><next><block type=\"controls_if\" id=\"KUOuZO+imQGNU3(xJB[!\"><value name=\"IF0\"><block type=\"logic_compare\" id=\"@$Ud+/EKOZn9QqlZ%5Ak\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"text_charAt\" id=\"EiPm~/*k27j{Sc|M{^FJ\"><mutation at=\"false\"></mutation><field name=\"WHERE\">FIRST</field><value name=\"VALUE\"><block type=\"variables_get\" id=\".uh:5ru_m0//-%tNx!,O\"><field name=\"VAR\" id=\"tRt)J6ju,#c{x[U1pP.I\" variabletype=\"\">message</field></block></value></block></value><value name=\"B\"><block type=\"text\" id=\"qq]Q`wDc5-~cIFGEKL-c\"><field name=\"TEXT\">[</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\" id=\"CQVibNOb9ME$!PIRvzb;\"><field name=\"VAR\" id=\"tRt)J6ju,#c{x[U1pP.I\" variabletype=\"\">message</field><value name=\"VALUE\"><block type=\"text_getSubstring\" id=\"x}/1BSlZSQNp~79,NQXJ\"><mutation at1=\"true\" at2=\"false\"></mutation><field name=\"WHERE1\">FROM_START</field><field name=\"WHERE2\">LAST</field><value name=\"STRING\"><block type=\"variables_get\" id=\"@S?i8O{S=;P7b$4J::sp\"><field name=\"VAR\" id=\"tRt)J6ju,#c{x[U1pP.I\" variabletype=\"\">message</field></block></value><value name=\"AT1\"><block type=\"math_number\" id=\"@)t-J;cEnYs_-$9CLP!c\"><field name=\"NUM\">2</field></block></value></block></value></block></statement><next><block type=\"controls_if\" id=\"|!@53E@~Z~5Prk)S^$JJ\"><value name=\"IF0\"><block type=\"logic_compare\" id=\"*t/tA0Mfw?ddyac*0Fv5\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"text_charAt\" id=\"KQ?:{LT2aPn-rbd?uS-h\"><mutation at=\"false\"></mutation><field name=\"WHERE\">LAST</field><value name=\"VALUE\"><block type=\"variables_get\" id=\"Chy1ta2u|LVv`Amvc{@l\"><field name=\"VAR\" id=\"tRt)J6ju,#c{x[U1pP.I\" variabletype=\"\">message</field></block></value></block></value><value name=\"B\"><block type=\"text\" id=\"0kMv[heEgcW}`Z.5j+lr\"><field name=\"TEXT\">]</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\" id=\"?fhsb}acBq%{Zf1rQtfp\"><field name=\"VAR\" id=\"tRt)J6ju,#c{x[U1pP.I\" variabletype=\"\">message</field><value name=\"VALUE\"><block type=\"text_getSubstring\" id=\"^z%Dflr1)K1=HJF7**3X\"><mutation at1=\"false\" at2=\"true\"></mutation><field name=\"WHERE1\">FIRST</field><field name=\"WHERE2\">FROM_END</field><value name=\"STRING\"><block type=\"variables_get\" id=\"g,wc2-M{/!4ZCUM.~C`|\"><field name=\"VAR\" id=\"tRt)J6ju,#c{x[U1pP.I\" variabletype=\"\">message</field></block></value><value name=\"AT2\"><block type=\"math_number\" id=\"Y/bQQ.a*EM!h@~m~DKtD\"><field name=\"NUM\">2</field></block></value></block></value></block></statement><next><block type=\"misc_comment\" id=\"pL$%3)!S*F*h/uyFFWfL\"><value name=\"TEXT\"><shadow type=\"text\" id=\"KbV6=2]L9vIQ$,?|K(OU\"><field name=\"TEXT\">Use eval to process the message</field></shadow></value><next><block type=\"misc_javascript\" id=\"[:eX51yxUnbyhl7-cz$m\"><value name=\"STATEMENT\"><shadow type=\"text\" id=\"1t?Vp%SuQ@bN2~$M3J]L\"><field name=\"TEXT\">message = String(eval(message))</field></shadow></value><next><block type=\"misc_comment\" id=\"(]5Y3@2N/E%w#4UqgDI}\"><value name=\"TEXT\"><shadow type=\"text\" id=\"c|R*SbW396,l}$_7g9,~\"><field name=\"TEXT\">Re-package result to pass back to Scratch 3</field></shadow></value><next><block type=\"variables_set\" id=\"nRdt[H56mc#x$jb_m6tH\"><field name=\"VAR\" id=\"tRt)J6ju,#c{x[U1pP.I\" variabletype=\"\">message</field><value name=\"VALUE\"><block type=\"text_join\" id=\"{5aa^yGeaA}e#+mHhiEw\" inline=\"true\"><mutation items=\"3\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"g9y^B`=d6]Fq^D+n.{ts\"><field name=\"TEXT\">{\"result\":\"</field></block></value><value name=\"ADD1\"><block type=\"variables_get\" id=\"@7lQ*N}w.49T,9~Zbu*5\"><field name=\"VAR\" id=\"tRt)J6ju,#c{x[U1pP.I\" variabletype=\"\">message</field></block></value><value name=\"ADD2\"><block type=\"text\" id=\";XB3H60nOwE:#%=pC%@M\"><field name=\"TEXT\">\"}</field></block></value></block></value><next><block type=\"node_object_set\" id=\"TtY/%g}HQ.thV[!)[)+?\" inline=\"true\"><value name=\"object_field\"><shadow type=\"node_msg\" id=\"M).kpUd-=P`$-@}AiR47\"></shadow></value><value name=\"field_name\"><shadow type=\"text\" id=\"$8B#TMu?Jk,_S~VWy{2L\"><field name=\"TEXT\">payload</field></shadow></value><value name=\"value_field\"><shadow type=\"text\" id=\"l%C_@co}{eglIH!)%.D[\"><field name=\"TEXT\"></field></shadow><block type=\"variables_get\" id=\"`(1IxXS^hiy;uAiLtNRT\"><field name=\"VAR\" id=\"tRt)J6ju,#c{x[U1pP.I\" variabletype=\"\">message</field></block></value><next><block type=\"node_return_message\" id=\"*bbcmWYcM1SuE^[3$)+_\"><field name=\"OUTPUT_NR\">1</field><value name=\"MESSAGE_INPUT\"><shadow type=\"node_msg\" id=\"SYNR|[0}wO3nN5A(,1yq\"></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></xml>","outputs":1,"name":"","x":360,"y":140,"wires":[["f9e5d8d4.47e958","c7d01b9c.7562b8"]]},{"id":"4cc9cfde.567c7","type":"delay","z":"67731296.6f183c","name":"","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":540,"y":1880,"wires":[["d49c091.e10c8f8"]]},{"id":"58a853d1.02aabc","type":"inject","z":"67731296.6f183c","name":"","topic":"msg.delay","payload":"2","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":1760,"wires":[["39ca8b3c.3b5774"]]},{"id":"d49c091.e10c8f8","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":720,"y":1880,"wires":[]},{"id":"2a6eebf6.2415d4","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":720,"y":1820,"wires":[]},{"id":"39ca8b3c.3b5774","type":"change","z":"67731296.6f183c","name":"","rules":[{"t":"set","p":"delay","pt":"msg","to":"payload * 1000","tot":"jsonata"},{"t":"set","p":"topic","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":1820,"wires":[["4cc9cfde.567c7","2a6eebf6.2415d4"]]},{"id":"d685cb0f.e01058","type":"inject","z":"67731296.6f183c","name":"","topic":"msg.delay","payload":"4","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":1820,"wires":[["39ca8b3c.3b5774"]]},{"id":"8de749d2.be3948","type":"inject","z":"67731296.6f183c","name":"JSON","topic":"","payload":"{\"system\":{\"hostname\":\"ssensor\",\"uptime\":5208,\"rssi\":-54,\"freemem\":30208},\"sensors\":{},\"gpio\":{\"4\":1}}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":2040,"wires":[["ef3c94a0.b30db8","8a36114d.638ed"]]},{"id":"ef3c94a0.b30db8","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":2040,"wires":[]},{"id":"926f4bbe.105408","type":"debug","z":"67731296.6f183c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":2140,"wires":[]},{"id":"8a36114d.638ed","type":"change","z":"67731296.6f183c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.gpio[\"4\"]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":2140,"wires":[["926f4bbe.105408"]]},{"id":"2b0323e1.8ed6dc","type":"http in","z":"6378da21.c9a314","name":"","url":"/html","method":"get","upload":false,"swaggerDoc":"","x":100,"y":460,"wires":[["aa61d780.628268"]]},{"id":"4164b363.e25ddc","type":"http in","z":"6378da21.c9a314","name":"","url":"/mysit","method":"post","upload":false,"swaggerDoc":"","x":270,"y":540,"wires":[["e514aa1c.3e61f8","1f7df934.df3d47"]]},{"id":"aa61d780.628268","type":"function","z":"6378da21.c9a314","name":"msg.url = \"mysitepost\";","func":"msg.url = \"mysit\";\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":460,"wires":[["f82a83a6.53ba"]]},{"id":"e514aa1c.3e61f8","type":"debug","z":"6378da21.c9a314","name":"mysitepost","active":false,"console":"false","complete":"payload","x":920,"y":540,"wires":[]},{"id":"a22281db.0d95","type":"http response","z":"6378da21.c9a314","name":"","x":940,"y":500,"wires":[]},{"id":"892de59c.aeade8","type":"template","z":"6378da21.c9a314","name":"CSS","field":"payload.style","fieldType":"msg","format":"css","syntax":"mustache","template":"input[type=text], select {\n    width: 100%;\n    padding: 12px 20px;\n    margin: 8px 0;\n    display: inline-block;\n    border: 1px solid #ccc;\n    border-radius: 4px;\n    box-sizing: border-box;\n}\n\ninput[type=submit] {\n    width: 100%;\n    background-color: #4CAF50;\n    color: white;\n    padding: 14px 20px;\n    margin: 8px 0;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n}\n\ninput[type=submit]:hover {\n    background-color: #45a049;\n}\n\ndiv {\n    border-radius: 5px;\n    background-color: #f2f2f2;\n    padding: 20px;\n}","x":660,"y":460,"wires":[["97db5c95.05a75"]]},{"id":"f82a83a6.53ba","type":"template","z":"6378da21.c9a314","name":"JavaScript","field":"payload.script","fieldType":"msg","format":"javascript","syntax":"plain","template":"$(document).ready(function(e) {\n    $(\"form[ajax=true]\").submit(function(e) {\n       e.preventDefault();\n        var form_data = $(this).serialize();\n        var form_url = $(this).attr(\"action\");\n        var form_method = $(this).attr(\"method\").toUpperCase();\n        $(\"#loadingimg\").show();\n        $.ajax({\n            url: form_url, \n            type: form_method,      \n            data: form_data,     \n            cache: false,\n            success: function(returnhtml){                          \n                $(\"#result\").html(returnhtml); \n                $(\"#loadingimg\").hide();                    \n            }           \n        });\n    });\n});","x":500,"y":460,"wires":[["892de59c.aeade8"]]},{"id":"25bf70aa.4a9ce","type":"http response","z":"6378da21.c9a314","name":"","x":940,"y":460,"wires":[]},{"id":"97db5c95.05a75","type":"template","z":"6378da21.c9a314","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<html>\n  <head>\n    <title>Node-red</title>\n    <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no\">\n    <meta charset=\"utf-8\">\n    <script src=\"http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js\"></script>\n    <style>{{{payload.style}}}</style>\n  </head>\n  \n\n    <h2>Пример написания Сайта на Node-RED</h2>\n    <h4><a href=\"http://nodered.flymon.net:1880/#\">nodered.flymon.net</a></h4>\n\n<div>\n<form method=\"post\" action=\"/{{url}}\" ajax=\"true\">\n    <label for=\"fname\">Логин</label>\n    <input type=\"text\" id=\"fname\" name=\"firstname\"><label for=\"lname\">Пароль</label>\n    <input type=\"text\" id=\"lname\" name=\"lastname\"> <label for=\"country\">Страна</label>\n    \n    <select id=\"country\" name=\"country\">\n      <option value=\"rus\">Россия</option>  \n      <option value=\"uk\">Украина</option>\n    </select>\n    \n    <input type=\"submit\" value=\"Submit\">\n  </form>\n</div>\n<div>\n    <span id=\"result\"></span>\n</div>\n\n</body>\n</html>\n<script>{{{payload.script}}}</script>","x":800,"y":460,"wires":[["25bf70aa.4a9ce"]]},{"id":"1159bb47.6a4315","type":"function","z":"6378da21.c9a314","name":"return msg.payload to client","func":"msg.payload = 'А это ответ:'+msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":500,"wires":[["a22281db.0d95"]]},{"id":"1f7df934.df3d47","type":"json","z":"6378da21.c9a314","name":"","property":"payload","action":"","pretty":false,"x":480,"y":500,"wires":[["1159bb47.6a4315"]]},{"id":"efec44d7.9c7708","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"{\"state\":\"ON\",\"power\":0,\"voltage\":null,\"consumption\":57.1,\"temperature\":45,\"linkquality\":70}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":1960,"wires":[["7db682f.ae91b7c","63c658b6.90bc48","a3f664b5.d2dd38"]]},{"id":"63c658b6.90bc48","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":790,"y":1960,"wires":[]},{"id":"7db682f.ae91b7c","type":"function","z":"1635ef5e.c89941","name":"rest","func":"const {temperature, ...rest} = msg.payload;\nmsg.payload = rest;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":2000,"wires":[["63c658b6.90bc48"]]},{"id":"ecc11d83.47eb6","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"[1,2,3,4,5]","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":2200,"wires":[["cf46e900.a637a8","a3bd6c5b.04f13"]]},{"id":"a3bd6c5b.04f13","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":2200,"wires":[]},{"id":"cf46e900.a637a8","type":"function","z":"1635ef5e.c89941","name":"rest","func":"const [test, ...rest] = msg.payload;\nmsg.payload = rest;\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":2240,"wires":[["a3bd6c5b.04f13"]]},{"id":"a3f664b5.d2dd38","type":"change","z":"1635ef5e.c89941","name":"delete temperatute","rules":[{"t":"delete","p":"payload.temperature","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":1920,"wires":[["63c658b6.90bc48"]]},{"id":"c3aab23a.06a55","type":"inject","z":"1635ef5e.c89941","name":"make request","topic":"","payload":"Node-Red","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"100","x":130,"y":2360,"wires":[["7baa76dc.479028"]]},{"id":"7baa76dc.479028","type":"http request","z":"1635ef5e.c89941","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"https://www.npmjs.com/package/node-red","tls":"","persist":false,"proxy":"","authType":"","x":330,"y":2360,"wires":[["c4f8d2a0.b34a3"]]},{"id":"c4f8d2a0.b34a3","type":"html","z":"1635ef5e.c89941","name":"select version NR","property":"","outproperty":"","tag":"#top > div.w-100.ph0-l.ph3.ph4-m > span:nth-child(2)","ret":"text","as":"single","x":530,"y":2360,"wires":[["2dd427d7.aaf038"]]},{"id":"8ed6c4ce.8c1a18","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":2360,"wires":[]},{"id":"2dd427d7.aaf038","type":"change","z":"1635ef5e.c89941","name":"select 5 simbols","rules":[{"t":"set","p":"payload","pt":"msg","to":"$substring(payload[0], 0, 5)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":2360,"wires":[["8ed6c4ce.8c1a18"]]},{"id":"e1123cc2.b55d","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"{\"Brightness\":100}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":2480,"wires":[["bd7a637b.a9266"]]},{"id":"78f3c402.1dcecc","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"{\"Brightness\":50}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":2540,"wires":[["bd7a637b.a9266"]]},{"id":"cdf919bf.f5f158","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"{\"On\":false}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":2660,"wires":[["9b7671f.02bd49"]]},{"id":"1382eb9d.b0cb64","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"{\"On\":true}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":2720,"wires":[["9b7671f.02bd49"]]},{"id":"9e43141f.a381c8","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"{\"Brightness\":0}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":2600,"wires":[["bd7a637b.a9266"]]},{"id":"abf2b780.70b5f8","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1050,"y":2600,"wires":[]},{"id":"28c8e8c9.9714b8","type":"change","z":"1635ef5e.c89941","name":"Brightness: 0","rules":[{"t":"set","p":"payload.Brightness","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":2660,"wires":[["abf2b780.70b5f8"]]},{"id":"bd7a637b.a9266","type":"change","z":"1635ef5e.c89941","name":"","rules":[{"t":"set","p":"Brightness","pt":"flow","to":"payload.Brightness","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":2540,"wires":[["b6ee678d.1f0d08"]]},{"id":"5d61edf1.78d814","type":"change","z":"1635ef5e.c89941","name":"set Brightness","rules":[{"t":"set","p":"payload.Brightness","pt":"msg","to":"Brightness","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":2540,"wires":[["abf2b780.70b5f8"]]},{"id":"9b7671f.02bd49","type":"change","z":"1635ef5e.c89941","name":"","rules":[{"t":"set","p":"On","pt":"flow","to":"payload.On","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":2660,"wires":[["b6ee678d.1f0d08"]]},{"id":"b6ee678d.1f0d08","type":"switch","z":"1635ef5e.c89941","name":"On","property":"On","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":650,"y":2600,"wires":[["5d61edf1.78d814"],["28c8e8c9.9714b8"]]},{"id":"29877013.a6c8e","type":"change","z":"1635ef5e.c89941","name":"set On false","rules":[{"t":"set","p":"On","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":2480,"wires":[[]]},{"id":"76a2b0b2.eb177","type":"switch","z":"1635ef5e.c89941","name":"if Brightness = 0","property":"Brightness","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":440,"y":2480,"wires":[["29877013.a6c8e"]]},{"id":"47e447d5.ae6cf8","type":"http in","z":"1635ef5e.c89941","name":"","url":"/hell","method":"get","upload":false,"swaggerDoc":"","x":180,"y":2940,"wires":[["c04ac374.b1154"]]},{"id":"be4824c5.b0edf8","type":"template","z":"1635ef5e.c89941","name":"page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n    <head></head>\n    <body>\n        <h1>\n            <ul>\n                {{#payload}}\n                  <li>{{.}}</li>\n                {{/payload}}\n            </ul>\n        </h1>\n    </body>\n</html>","x":570,"y":2940,"wires":[["9a6592c7.f8b4c","aa15bbd4.f8e678"]]},{"id":"9a6592c7.f8b4c","type":"http response","z":"1635ef5e.c89941","name":"","x":770,"y":2940,"wires":[]},{"id":"aa15bbd4.f8e678","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":2840,"wires":[]},{"id":"c04ac374.b1154","type":"change","z":"1635ef5e.c89941","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[\"Nick\", \"Dave\", \"Claire\"]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":2940,"wires":[["be4824c5.b0edf8"]]},{"id":"3b17392c.98d2c6","type":"inject","z":"1635ef5e.c89941","name":"","topic":"","payload":"2","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":3100,"wires":[["c0d23169.31aa4","e1b7b300.cad39"]]},{"id":"950231e5.51c72","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":3100,"wires":[]},{"id":"c0d23169.31aa4","type":"function","z":"1635ef5e.c89941","name":"","func":"msg.payload = +msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":3100,"wires":[["950231e5.51c72"]]},{"id":"e1b7b300.cad39","type":"debug","z":"1635ef5e.c89941","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":550,"y":3040,"wires":[]}]